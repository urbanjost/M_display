<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="display small matrices in row-column order">
    
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>M_display.f90 &ndash; M_display</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">M_display </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../lists/programs.html">Programs</a></li>
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>M_display.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="91.3% of total for source files.">2770 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/M_display.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">M_display.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/putstrmodule.html">PUTSTRMODULE</a>
      
      <a class="list-group-item" href="../module/m_display_util.html">M_display_UTIL</a>
      
      <a class="list-group-item" href="../module/m_display.html">M_display</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/m_display.f90.html#src">M_display.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
      
      

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/putstrmodule.html">PUTSTRMODULE</a>
      
      <a class="list-group-item" href="../module/m_display_util.html">M_display_UTIL</a>
      
      <a class="list-group-item" href="../module/m_display.html">M_display</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/m_display.f90.html#src">M_display.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!&gt;</span>
<a name="ln-2"></a><span class="c">!!</span>
<a name="ln-3"></a><span class="c">!!   M_display, A FORTRAN 95 MODULE FOR PRETTY-PRINTING MATRICES.</span>
<a name="ln-4"></a><span class="c">!!</span>
<a name="ln-5"></a><span class="c">!!    o  Version number 1.02 6-Sept-2008</span>
<a name="ln-6"></a><span class="c">!!    o  Version number 2.00 31-Oct-2017, f2003 version; John S. Urban</span>
<a name="ln-7"></a><span class="c">!!</span>
<a name="ln-8"></a><span class="c">!!   Copyright (c) 2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-9"></a><span class="c">!!   Iceland (jonasson@hi.is). This software is free. For details see the file README.</span>
<a name="ln-10"></a><span class="c">!!</span>
<a name="ln-11"></a><span class="c">!!##AUTHOR</span>
<a name="ln-12"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-13"></a><span class="c">!!   Version number 1.02 6-Sept-2008,</span>
<a name="ln-14"></a><span class="c">!!   Kristjan Jonasson, Department of Computer Science,</span>
<a name="ln-15"></a><span class="c">!!   School of Science and Engineering, University of Iceland,</span>
<a name="ln-16"></a><span class="c">!!   Hjardarhaga 4, 107 Reykjavik, Iceland (jonasson@hi.is).</span>
<a name="ln-17"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-18"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-19"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-20"></a><span class="k">MODULE </span><span class="n">PUTSTRMODULE</span> <span class="c">! DUMMY VERSION</span>
<a name="ln-21"></a>  <span class="c">! An auxiliary module that accompanies M_display. This module contains dummy versions of the</span>
<a name="ln-22"></a>  <span class="c">! subroutines putstr and putnl that do nothing. It is needed to avoid an &quot;undefined symbol&quot; link</span>
<a name="ln-23"></a>  <span class="c">! error for these. In addition it defines the named constant (or parameter) DEFAULT_UNIT = -3,</span>
<a name="ln-24"></a>  <span class="c">! which makes the asterisk unit (usually the screen) the default to display on.</span>
<a name="ln-25"></a>  <span class="c">!</span>
<a name="ln-26"></a>  <span class="c">! The purpose of having this module is to make displaying possible in situations where ordinary</span>
<a name="ln-27"></a>  <span class="c">! print- and write-statements do not work. Then this module should be replaced by one defining</span>
<a name="ln-28"></a>  <span class="c">! functional versions of putstr and putnl. An example is given by the commented out PUTSTRMODULE</span>
<a name="ln-29"></a>  <span class="c">! for Matlab mex files below.</span>
<a name="ln-30"></a>  <span class="c">!</span>
<a name="ln-31"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DEFAULT_UNIT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<a name="ln-32"></a>  <span class="c">!</span>
<a name="ln-33"></a><span class="k">CONTAINS</span>
<a name="ln-34"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-35"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-36"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-37"></a>  <span class="k">subroutine </span><span class="n">putstr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-38"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-39"></a>    <span class="kt">integer </span><span class="n">ldummy</span><span class="p">,</span> <span class="n">ldummy1</span>  <span class="c">! these variables exist to avoid unused variable warnings</span>
<a name="ln-40"></a>    <span class="n">ldummy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-41"></a>    <span class="n">ldummy1</span> <span class="o">=</span> <span class="n">ldummy</span>
<a name="ln-42"></a>    <span class="n">ldummy</span> <span class="o">=</span> <span class="n">ldummy1</span>
<a name="ln-43"></a>  <span class="k">end subroutine </span><span class="n">putstr</span>
<a name="ln-44"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-45"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-46"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-47"></a>  <span class="k">subroutine </span><span class="n">putnl</span><span class="p">()</span>
<a name="ln-48"></a>  <span class="k">end subroutine </span><span class="n">putnl</span>
<a name="ln-49"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-50"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-51"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-52"></a><span class="k">END MODULE </span><span class="n">PUTSTRMODULE</span>
<a name="ln-53"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-54"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-55"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-56"></a><span class="c">! MODULE PUTSTRMODULE  ! for Matlab mex files.</span>
<a name="ln-57"></a><span class="c">!   ! This module contains functional versions of subroutines putstr and putnl. It also sets</span>
<a name="ln-58"></a><span class="c">!   ! DEFAULT_UNIT = -2, which makes putstr/putnl the default to display with. Using this module,</span>
<a name="ln-59"></a><span class="c">!   ! instead of the dummy module above allows M_display to be used with Matlab mex files.</span>
<a name="ln-60"></a><span class="c">!   ! used (commented in) instead of the one above (which should then be commented out), then</span>
<a name="ln-61"></a><span class="c">!   ! M_display can be used with Matlab mex files. A shorter version (given in the user manual)</span>
<a name="ln-62"></a><span class="c">!   ! may be used with g95, but the one below works for both g95 and gfortran.</span>
<a name="ln-63"></a><span class="c">!   !</span>
<a name="ln-64"></a><span class="c">!   use, intrinsic :: ISO_C_BINDING</span>
<a name="ln-65"></a><span class="c">!   integer, parameter :: default_unit = -2</span>
<a name="ln-66"></a><span class="c">!   interface</span>
<a name="ln-67"></a><span class="c">!     subroutine mexprintf(s) bind(C, name = &#39;mexPrintf&#39;)</span>
<a name="ln-68"></a><span class="c">!       import c_char</span>
<a name="ln-69"></a><span class="c">!       character(kind=c_char) s(*)</span>
<a name="ln-70"></a><span class="c">!     end subroutine mexprintf</span>
<a name="ln-71"></a><span class="c">!   end interface</span>
<a name="ln-72"></a><span class="c">! CONTAINS</span>
<a name="ln-73"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-74"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-75"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-76"></a><span class="c">!   subroutine putstr(s)</span>
<a name="ln-77"></a><span class="c">!     character(*), intent(in) :: s</span>
<a name="ln-78"></a><span class="c">!     call mexprintf(s//char(0))</span>
<a name="ln-79"></a><span class="c">!   end subroutine putstr</span>
<a name="ln-80"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-81"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-82"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-83"></a><span class="c">!   subroutine putnl()</span>
<a name="ln-84"></a><span class="c">!     call mexprintf(char(10)//char(0))</span>
<a name="ln-85"></a><span class="c">!   end subroutine putnl</span>
<a name="ln-86"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-87"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-88"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-89"></a><span class="c">! END MODULE PUTSTRMODULE</span>
<a name="ln-90"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-91"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-92"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-93"></a><span class="c">!&gt;</span>
<a name="ln-94"></a><span class="c">!!##NAME</span>
<a name="ln-95"></a><span class="c">!!      M_display(3f) - [M_display] module for pretty-printing matrices</span>
<a name="ln-96"></a><span class="c">!!</span>
<a name="ln-97"></a><span class="c">!!##INTRODUCTION</span>
<a name="ln-98"></a><span class="c">!!</span>
<a name="ln-99"></a><span class="c">!! M_display is a standard Fortran 95 module for quick and easy displaying of numbers, vectors or</span>
<a name="ln-100"></a><span class="c">!! matrices using default or specified format. It can be useful for debugging purposes, for</span>
<a name="ln-101"></a><span class="c">!! preliminary display of numerical results, and even for final display of such results in cases when</span>
<a name="ln-102"></a><span class="c">!! carefully formatted tables are not needed. It is comparable to the automatic matrix printing of</span>
<a name="ln-103"></a><span class="c">!! Matlab, S and R, but offers substantially more control over the format used.</span>
<a name="ln-104"></a><span class="c">!!</span>
<a name="ln-105"></a><span class="c">!! The module can handle the standard Fortran data types integer, single precision, double precision,</span>
<a name="ln-106"></a><span class="c">!! complex, logical and character. Integer, real, complex and logical data of other than default kind</span>
<a name="ln-107"></a><span class="c">!! are supported with add-on modules. The module contains the following public procedures:</span>
<a name="ln-108"></a><span class="c">!!</span>
<a name="ln-109"></a><span class="c">!!       Subroutine DISP                  The main procedure used for displaying items</span>
<a name="ln-110"></a><span class="c">!!       Subroutine DISP_SET              Used to change default settings for DISP</span>
<a name="ln-111"></a><span class="c">!!       Subroutine DISP_SET_FACTORY      Restores DISP-settings to original (factory) default</span>
<a name="ln-112"></a><span class="c">!!       Function DISP_GET                Returns a structure with current DISP-settings</span>
<a name="ln-113"></a><span class="c">!!       Function TOSTRING                Returns a string representation of a scalar or vector</span>
<a name="ln-114"></a><span class="c">!!       Subroutine TOSTRING_SET          Used to change default settings for TOSTRING</span>
<a name="ln-115"></a><span class="c">!!       Subroutine TOSTRING_SET_FACTORY  Restores TOSTRING-settings to original default</span>
<a name="ln-116"></a><span class="c">!!</span>
<a name="ln-117"></a><span class="c">!! In addition the module defines a public derived type, DISP_SETTINGS, used for saving and restoring</span>
<a name="ln-118"></a><span class="c">!! settings for DISP. The procedures DISP and TOSTRING have a generic interface and optional</span>
<a name="ln-119"></a><span class="c">!! arguments, so the same subroutine / function name, is used to display items of different data</span>
<a name="ln-120"></a><span class="c">!! types and ranks, with or without labels, and using default or specified format. Similarly DISP_SET</span>
<a name="ln-121"></a><span class="c">!! is generic and can be used both to change individual settings and to restore previously saved</span>
<a name="ln-122"></a><span class="c">!! settings.</span>
<a name="ln-123"></a><span class="c">!!</span>
<a name="ln-124"></a><span class="c">!! The most basic calling syntax for displaying is CALL DISP(expression) which will display the</span>
<a name="ln-125"></a><span class="c">!! expression with default format. The format may be specified with CALL DISP(expression, edit-</span>
<a name="ln-126"></a><span class="c">!! descriptor), and CALL DISP(title, expression) will label the displayed item with a title. Examples</span>
<a name="ln-127"></a><span class="c">!! are CALL DISP(A), CALL DISP(A,&#39;F9.3&#39;), CALL DISP(&#39;A=&#39;,A) and CALL DISP(&#39;A=&#39;,A,&#39;F9.3&#39;), the last</span>
<a name="ln-128"></a><span class="c">!! one specifying both title and format. If aij = exp(i + j - 1), i, j = 1,...,4, then</span>
<a name="ln-129"></a><span class="c">!! CALL DISP(&#39;A = &#39;, A) writes out:</span>
<a name="ln-130"></a><span class="c">!!</span>
<a name="ln-131"></a><span class="c">!!      &gt; A =  2.72    7.39   20.09    54.60</span>
<a name="ln-132"></a><span class="c">!!      &gt;      7.39   20.09   54.60   148.41</span>
<a name="ln-133"></a><span class="c">!!      &gt;     20.09   54.60  148.41   403.43</span>
<a name="ln-134"></a><span class="c">!!      &gt;     54.60  148.41  403.43  1096.63</span>
<a name="ln-135"></a><span class="c">!!</span>
<a name="ln-136"></a><span class="c">!! and if bij = exp(i*j) the result of CALL DISP(B) is:</span>
<a name="ln-137"></a><span class="c">!!</span>
<a name="ln-138"></a><span class="c">!!      &gt; 2.71828E+0  7.38906E+0  2.00855E+1  5.45981E+1</span>
<a name="ln-139"></a><span class="c">!!      &gt; 7.38906E+0  5.45981E+1  4.03429E+2  2.98096E+3</span>
<a name="ln-140"></a><span class="c">!!      &gt; 2.00855E+1  4.03429E+2  8.10308E+3  1.62755E+5</span>
<a name="ln-141"></a><span class="c">!!      &gt; 5.45981E+1  2.98096E+3  1.62755E+5  8.88611E+6.</span>
<a name="ln-142"></a><span class="c">!!</span>
<a name="ln-143"></a><span class="c">!! It is also possible to number the rows and columns: CALL DISP(A, STYLE=&#39;NUMBER&#39;) will give:</span>
<a name="ln-144"></a><span class="c">!!</span>
<a name="ln-145"></a><span class="c">!!      &gt;      1       2       3        4</span>
<a name="ln-146"></a><span class="c">!!      &gt; 1   2.72    7.39   20.09    54.60</span>
<a name="ln-147"></a><span class="c">!!      &gt; 2   7.39   20.09   54.60   148.41</span>
<a name="ln-148"></a><span class="c">!!      &gt; 3  20.09   54.60  148.41   403.43</span>
<a name="ln-149"></a><span class="c">!!      &gt; 4  54.60  148.41  403.43  1096.63.</span>
<a name="ln-150"></a><span class="c">!!</span>
<a name="ln-151"></a><span class="c">!! The selection between F and E editing depends on the size of the largest displayed element as</span>
<a name="ln-152"></a><span class="c">!! discussed in section 3.2 below. Among the settings that may be controlled is the spacing between</span>
<a name="ln-153"></a><span class="c">!! columns, the number of significant digits, the placement of the label, and the file unit where the</span>
<a name="ln-154"></a><span class="c">!! output goes. Items can in addition be displayed side by side, for example:</span>
<a name="ln-155"></a><span class="c">!!</span>
<a name="ln-156"></a><span class="c">!!      &gt; CALL DISP(&#39;X = &#39;, X, ADVANCE=&#39;NO&#39;)</span>
<a name="ln-157"></a><span class="c">!!      &gt; CALL DISP(&#39;Y = &#39;, Y)</span>
<a name="ln-158"></a><span class="c">!!</span>
<a name="ln-159"></a><span class="c">!! which might output:</span>
<a name="ln-160"></a><span class="c">!!</span>
<a name="ln-161"></a><span class="c">!!      &gt; X = 7  8  3   Y = 11</span>
<a name="ln-162"></a><span class="c">!!      &gt;     4  0  2        2</span>
<a name="ln-163"></a><span class="c">!!      &gt;     1  3  6        7</span>
<a name="ln-164"></a><span class="c">!!</span>
<a name="ln-165"></a><span class="c">!! Complex numbers are formatted as illustrated by:</span>
<a name="ln-166"></a><span class="c">!!</span>
<a name="ln-167"></a><span class="c">!!      &gt; COMPLEX C(3,3)</span>
<a name="ln-168"></a><span class="c">!!      &gt; FORALL(I=1:3, K=1:3) C(I,K)=LOG(CMPLX(-I*K))**K</span>
<a name="ln-169"></a><span class="c">!!      &gt; CALL DISP(&#39;C = &#39;, C, &#39;F0.3&#39;)</span>
<a name="ln-170"></a><span class="c">!!</span>
<a name="ln-171"></a><span class="c">!! which will display</span>
<a name="ln-172"></a><span class="c">!!</span>
<a name="ln-173"></a><span class="c">!!      &gt; C = 0.000 + 3.142i   -9.389 +  4.355i   -31.203 - 19.631i</span>
<a name="ln-174"></a><span class="c">!!      &gt;     0.693 + 3.142i   -7.948 +  8.710i   -47.300 -  0.749i</span>
<a name="ln-175"></a><span class="c">!!      &gt;     1.099 + 3.142i   -6.659 + 11.258i   -54.449 + 14.495i</span>
<a name="ln-176"></a><span class="c">!!</span>
<a name="ln-177"></a><span class="c">!! infinite and not-a-number real values are supported and displayed as nan, +inf or -inf.</span>
<a name="ln-178"></a><span class="c">!!</span>
<a name="ln-179"></a><span class="c">!! the remaining sections in this user manual contain detailed information on using the module.</span>
<a name="ln-180"></a><span class="c">!! section 2 discusses the basics of using the module, including use statements, compiling and</span>
<a name="ln-181"></a><span class="c">!! linking, and add-on modules supporting non-default kinds of data. section 3 gives a detailed</span>
<a name="ln-182"></a><span class="c">!! description of the generic subroutine disp. all the possible arguments are listed and the purpose</span>
<a name="ln-183"></a><span class="c">!! of each one described. section 4 describes how to change various settings that control how items</span>
<a name="ln-184"></a><span class="c">!! are displayed with disp. section 5 describes the function tostring which may be used to change</span>
<a name="ln-185"></a><span class="c">!! numbers to strings. finally testing of the module is discussed in section 6.</span>
<a name="ln-186"></a><span class="c">!!</span>
<a name="ln-187"></a><span class="c">!!##OVERVIEW OF MODULES</span>
<a name="ln-188"></a><span class="c">!!</span>
<a name="ln-189"></a><span class="c">!! The file M_display.f90 actually begins with two auxiliary</span>
<a name="ln-190"></a><span class="c">!! modules, PUTSTRMODULE and M_display_UTIL. The first one contains two dummy subroutines, PUTSTR</span>
<a name="ln-191"></a><span class="c">!! and PUTNL, which do nothing, but must be incorporated to avoid an &quot;undefined symbol&quot; link error.</span>
<a name="ln-192"></a><span class="c">!! In addition it defines the named constant (parameter) DEFAULT_UNIT = -3, which makes the asterisk</span>
<a name="ln-193"></a><span class="c">!! unit (usually the screen) the default to display on.</span>
<a name="ln-194"></a><span class="c">!!</span>
<a name="ln-195"></a><span class="c">!! Alternatively the user can write his own PUTSTRMODULE as described below. An</span>
<a name="ln-196"></a><span class="c">!! example is near the beginning of M_display.f90 (commented out) and also in the file</span>
<a name="ln-197"></a><span class="c">!! putstrmodule_mex.f90, enclosed with the package. It may be used (commented in instead of the</span>
<a name="ln-198"></a><span class="c">!! default one) to allow Matlab mex files to display in the Matlab command window.</span>
<a name="ln-199"></a><span class="c">!!</span>
<a name="ln-200"></a><span class="c">!!##AN EXAMPLE PROGRAM</span>
<a name="ln-201"></a><span class="c">!!</span>
<a name="ln-202"></a><span class="c">!! Following is a short example program that uses the package:</span>
<a name="ln-203"></a><span class="c">!!</span>
<a name="ln-204"></a><span class="c">!!       program example</span>
<a name="ln-205"></a><span class="c">!!         use M_display</span>
<a name="ln-206"></a><span class="c">!!         real :: a(3) = [ 1.2345, 2.3456, 3.4567 ]</span>
<a name="ln-207"></a><span class="c">!!         call disp(&#39;A = &#39;, A, SEP=&#39;, &#39;, ORIENT = &#39;ROW&#39;)</span>
<a name="ln-208"></a><span class="c">!!       end program example</span>
<a name="ln-209"></a><span class="c">!!</span>
<a name="ln-210"></a><span class="c">!! The program should write out &quot;A = 1.23450, 2.34560, 3.45670&quot;.</span>
<a name="ln-211"></a><span class="c">!!</span>
<a name="ln-212"></a><span class="c">!! A longer example program:</span>
<a name="ln-213"></a><span class="c">!!</span>
<a name="ln-214"></a><span class="c">!!    program demo_M_display</span>
<a name="ln-215"></a><span class="c">!!    use M_display</span>
<a name="ln-216"></a><span class="c">!!    implicit none</span>
<a name="ln-217"></a><span class="c">!!    integer, parameter :: rk = selected_real_kind(6), n = 3</span>
<a name="ln-218"></a><span class="c">!!    real(rk) :: a(n,n), b(n,n), x</span>
<a name="ln-219"></a><span class="c">!!    integer i, j, k(5)</span>
<a name="ln-220"></a><span class="c">!!      call disp_set(advance = &#39;double&#39;)</span>
<a name="ln-221"></a><span class="c">!!      forall(i=1:n, j=1:n)</span>
<a name="ln-222"></a><span class="c">!!        a(i,j) = exp(real(i+j-1, rk))</span>
<a name="ln-223"></a><span class="c">!!        b(i,j) = exp(real(i**j, rk))</span>
<a name="ln-224"></a><span class="c">!!      end forall</span>
<a name="ln-225"></a><span class="c">!!      call disp(&#39;A = &#39;, a)</span>
<a name="ln-226"></a><span class="c">!!      call disp(b)</span>
<a name="ln-227"></a><span class="c">!!      call disp(a(1:2,:),&#39;f0.5&#39;)</span>
<a name="ln-228"></a><span class="c">!!      call disp(&#39;MATRIX&#39;, a, style=&#39;UNDERLINE &amp; NUMBER&#39;, unit=-3, digmax=4)</span>
<a name="ln-229"></a><span class="c">!!      k = [-3,0,12,14,0]</span>
<a name="ln-230"></a><span class="c">!!      call disp(&#39;K&#39;, k, style=&#39;pad&#39;, orient=&#39;row&#39;, sep=&#39; &#39;, zeroas=&#39;.&#39;)</span>
<a name="ln-231"></a><span class="c">!!      x = 1.5</span>
<a name="ln-232"></a><span class="c">!!      call disp(&#39;The square of &#39;//tostring(x)//&#39; is &#39;//tostring(x*x))</span>
<a name="ln-233"></a><span class="c">!!      call disp_set(matsep = &#39; | &#39;)</span>
<a name="ln-234"></a><span class="c">!!      call disp([11,12,13], advance=&#39;no&#39;)</span>
<a name="ln-235"></a><span class="c">!!      call disp([.true., .false., .true.], advance=&#39;no&#39;)</span>
<a name="ln-236"></a><span class="c">!!      call disp([&#39;A&#39;,&#39;B&#39;,&#39;C&#39;])</span>
<a name="ln-237"></a><span class="c">!!    end program demo_M_display</span>
<a name="ln-238"></a><span class="c">!!</span>
<a name="ln-239"></a><span class="c">!! Expected results:</span>
<a name="ln-240"></a><span class="c">!!</span>
<a name="ln-241"></a><span class="c">!!    A =  2.718   7.389   20.086</span>
<a name="ln-242"></a><span class="c">!!         7.389  20.086   54.598</span>
<a name="ln-243"></a><span class="c">!!        20.086  54.598  148.413</span>
<a name="ln-244"></a><span class="c">!!</span>
<a name="ln-245"></a><span class="c">!!    2.71828E+00  2.71828E+00  2.71828E+00</span>
<a name="ln-246"></a><span class="c">!!    7.38906E+00  5.45982E+01  2.98096E+03</span>
<a name="ln-247"></a><span class="c">!!    2.00855E+01  8.10308E+03  5.32048E+11</span>
<a name="ln-248"></a><span class="c">!!</span>
<a name="ln-249"></a><span class="c">!!    2.71828   7.38906  20.08554</span>
<a name="ln-250"></a><span class="c">!!    7.38906  20.08554  54.59815</span>
<a name="ln-251"></a><span class="c">!!</span>
<a name="ln-252"></a><span class="c">!!           MATRIX</span>
<a name="ln-253"></a><span class="c">!!    --------------------</span>
<a name="ln-254"></a><span class="c">!!         1     2      3</span>
<a name="ln-255"></a><span class="c">!!    1   2.7   7.4   20.1</span>
<a name="ln-256"></a><span class="c">!!    2   7.4  20.1   54.6</span>
<a name="ln-257"></a><span class="c">!!    3  20.1  54.6  148.4</span>
<a name="ln-258"></a><span class="c">!!</span>
<a name="ln-259"></a><span class="c">!!    ------K-----</span>
<a name="ln-260"></a><span class="c">!!    -3 . 12 14 .</span>
<a name="ln-261"></a><span class="c">!!</span>
<a name="ln-262"></a><span class="c">!!    The square of 1.5 is 2.25</span>
<a name="ln-263"></a><span class="c">!!</span>
<a name="ln-264"></a><span class="c">!!    11 | T | A</span>
<a name="ln-265"></a><span class="c">!!    12 | F | B</span>
<a name="ln-266"></a><span class="c">!!    13 | T | C</span>
<a name="ln-267"></a><span class="c">!!</span>
<a name="ln-268"></a><span class="c">!!##AUTHOR</span>
<a name="ln-269"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-270"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-271"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-272"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-273"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-274"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-275"></a><span class="k">MODULE </span><span class="n">M_display_UTIL</span>
<a name="ln-276"></a>  <span class="c">! M_display_util contains utilities that are used by M_display, and the add-on modules</span>
<a name="ln-277"></a>  <span class="c">! disp_i1mod, disp_i2mod,..., disp_l1mod and disp_r16mod. Note that the entities that are</span>
<a name="ln-278"></a>  <span class="c">! declared public below are not exported to the user. The private statements in M_display and</span>
<a name="ln-279"></a>  <span class="c">! the add-on modules prevent that from happening.</span>
<a name="ln-280"></a>
<a name="ln-281"></a>  <span class="k">use </span><span class="n">putstrmodule</span>
<a name="ln-282"></a>  <span class="k">implicit none</span>
<a name="ln-283"></a>
<a name="ln-284"></a><span class="c">! ident_1=&quot;@(#)M_display(3fm): module for pretty-printing matrices&quot;</span>
<a name="ln-285"></a>
<a name="ln-286"></a>  <span class="c">! ***************** PUBLIC ENTITIES (ONLY PUBLIC TO M_display, NOT TO USER PROGRAMS) ***************</span>
<a name="ln-287"></a>  <span class="k">private</span>
<a name="ln-288"></a><span class="k">  public </span><span class="n">disp_settings</span><span class="p">,</span> <span class="n">defset</span><span class="p">,</span> <span class="n">factory_settings</span><span class="p">,</span> <span class="n">tosset</span><span class="p">,</span> <span class="n">tosfac</span><span class="p">,</span> <span class="n">errormsg</span><span class="p">,</span> <span class="n">tostring_settings</span>
<a name="ln-289"></a>  <span class="k">public </span><span class="n">nnblk</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">readfmt</span><span class="p">,</span> <span class="n">replace_w</span><span class="p">,</span> <span class="n">trim_real</span><span class="p">,</span> <span class="n">get_SE</span><span class="p">,</span> <span class="n">preparebox</span><span class="p">,</span> <span class="n">copytobox</span><span class="p">,</span> <span class="n">boxlist</span><span class="p">,</span> <span class="n">boxnode</span>
<a name="ln-290"></a>  <span class="k">public </span><span class="n">copyseptobox</span><span class="p">,</span> <span class="n">finishbox</span><span class="p">,</span> <span class="n">tostring_get_complex</span><span class="p">,</span> <span class="n">disp_errmsg</span><span class="p">,</span> <span class="n">tostring_get</span><span class="p">,</span> <span class="n">find_editdesc_real</span>
<a name="ln-291"></a>  <span class="k">public </span><span class="n">check_settings</span><span class="p">,</span> <span class="n">tostring_check_settings</span><span class="p">,</span> <span class="n">replace_zeronaninf</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">trim_s_real</span>
<a name="ln-292"></a>
<a name="ln-293"></a>  <span class="c">! *********************************** GENERAL DECLARATIONS ********************************************</span>
<a name="ln-294"></a>  <span class="k">type </span><span class="n">disp_settings</span>
<a name="ln-295"></a>    <span class="c">! Settings used by subroutine disp and the utility procedures.</span>
<a name="ln-296"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">advance</span>     <span class="o">=</span> <span class="s1">&#39;YES&#39;</span>
<a name="ln-297"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">matsep</span>      <span class="o">=</span> <span class="s1">&#39;   &#39;</span>
<a name="ln-298"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">orient</span>      <span class="o">=</span> <span class="s1">&#39;COL&#39;</span>
<a name="ln-299"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sep</span>         <span class="o">=</span> <span class="s1">&#39;  &#39;</span>
<a name="ln-300"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="kd">::</span> <span class="n">style</span>       <span class="o">=</span> <span class="s1">&#39;LEFT&#39;</span>
<a name="ln-301"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">trim</span>        <span class="o">=</span> <span class="s1">&#39;AUTO&#39;</span>
<a name="ln-302"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zeroas</span>      <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-303"></a>    <span class="kt">integer</span>      <span class="kd">::</span> <span class="n">digmax</span>      <span class="o">=</span> <span class="mi">6</span>
<a name="ln-304"></a>    <span class="kt">integer</span>      <span class="kd">::</span> <span class="n">matseplen</span>   <span class="o">=</span> <span class="mi">3</span>
<a name="ln-305"></a>    <span class="kt">integer</span>      <span class="kd">::</span> <span class="n">seplen</span>      <span class="o">=</span> <span class="mi">2</span>
<a name="ln-306"></a>    <span class="kt">integer</span>      <span class="kd">::</span> <span class="n">unit</span>        <span class="o">=</span> <span class="n">DEFAULT_UNIT</span>
<a name="ln-307"></a>    <span class="kt">integer</span>      <span class="kd">::</span> <span class="n">zaslen</span>      <span class="o">=</span> <span class="mi">0</span>
<a name="ln-308"></a>  <span class="k">end type </span><span class="n">disp_settings</span>
<a name="ln-309"></a>
<a name="ln-310"></a>  <span class="k">type </span><span class="n">tostring_settings</span>
<a name="ln-311"></a>    <span class="c">! Settings used by function tostring.</span>
<a name="ln-312"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ifmt</span> <span class="o">=</span> <span class="s1">&#39;I0&#39;</span>
<a name="ln-313"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rfmt</span> <span class="o">=</span> <span class="s1">&#39;1PG12.5&#39;</span>  <span class="c">! &#39;SP,1P,G20.11E3&#39; has length 14 and is about max</span>
<a name="ln-314"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span>
<a name="ln-315"></a>    <span class="kt">integer</span>       <span class="kd">::</span> <span class="n">seplen</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-316"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">trimb</span> <span class="o">=</span> <span class="s1">&#39;YES&#39;</span>
<a name="ln-317"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">trimz</span> <span class="o">=</span> <span class="s1">&#39;G&#39;</span>
<a name="ln-318"></a>  <span class="k">end type </span><span class="n">tostring_settings</span>
<a name="ln-319"></a>
<a name="ln-320"></a>  <span class="k">type </span><span class="n">settings</span>
<a name="ln-321"></a>    <span class="c">! Settings used (privately) by disp and the utility procedures, in the variable SE.</span>
<a name="ln-322"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="n">ed</span>
<a name="ln-323"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="n">sep</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">zas</span>
<a name="ln-324"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">tch</span>
<a name="ln-325"></a>    <span class="kt">integer </span><span class="n">lun</span><span class="p">,</span> <span class="n">dmx</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">lsep</span><span class="p">,</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">adv</span>
<a name="ln-326"></a>    <span class="kt">logical </span><span class="n">trm</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">gedit</span>
<a name="ln-327"></a>  <span class="k">end type </span><span class="n">settings</span>
<a name="ln-328"></a>
<a name="ln-329"></a>  <span class="k">type</span><span class="p">(</span><span class="n">disp_settings</span><span class="p">),</span> <span class="k">save</span> <span class="kd">::</span> <span class="n">DEFSET</span><span class="p">,</span> <span class="p">&amp;</span>        <span class="c">! Current default settings for disp</span>
<a name="ln-330"></a>       <span class="p">&amp;</span>                       <span class="n">FACTORY_SETTINGS</span> <span class="c">! Original (factory) settings for disp</span>
<a name="ln-331"></a>  <span class="k">type</span><span class="p">(</span><span class="n">tostring_settings</span><span class="p">),</span> <span class="k">save</span> <span class="kd">::</span> <span class="n">tosset</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">! Current settings for tostring</span>
<a name="ln-332"></a>       <span class="p">&amp;</span>                           <span class="n">tosfac</span>    <span class="c">! Factory settings for tostring</span>
<a name="ln-333"></a>
<a name="ln-334"></a>  <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">errormsg</span> <span class="o">=</span> <span class="s1">&#39;Illegal format&#39;</span>
<a name="ln-335"></a>
<a name="ln-336"></a>  <span class="c">! ********************* BOX-PACKAGE DECLARATIONS (SEE EXPLANATION ABOUT BOX-PACKAGE BELOW) *****************</span>
<a name="ln-337"></a>  <span class="k">type </span><span class="n">boxnode</span>
<a name="ln-338"></a>    <span class="c">! A box is the character representation of a printed item</span>
<a name="ln-339"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span>     <span class="kd">::</span> <span class="n">box</span><span class="p">(:,:)</span>
<a name="ln-340"></a>    <span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">nextbox</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-341"></a>  <span class="k">end type </span><span class="n">boxnode</span>
<a name="ln-342"></a>  <span class="c">!</span>
<a name="ln-343"></a>  <span class="k">type </span><span class="n">boxlist</span>
<a name="ln-344"></a>    <span class="c">! There is one list of boxes associated with each logical unit</span>
<a name="ln-345"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">unit</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-346"></a>    <span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">firstbox</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-347"></a>    <span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">lastbox</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-348"></a>    <span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">nextboxlist</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-349"></a>  <span class="k">end type </span><span class="n">boxlist</span>
<a name="ln-350"></a>  <span class="c">!</span>
<a name="ln-351"></a>  <span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">firstboxlist</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-352"></a>  <span class="c">! ************************ END OF BOX-PACKAGE DECLARATIONS ******************************</span>
<a name="ln-353"></a>
<a name="ln-354"></a><span class="k">CONTAINS</span>
<a name="ln-355"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-356"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-357"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-358"></a>  <span class="c">! ***************************** GENERAL PROCEDURES **************************************</span>
<a name="ln-359"></a>  <span class="k">subroutine </span><span class="n">check_settings</span><span class="p">()</span>
<a name="ln-360"></a>    <span class="c">! Sanity check of display settings</span>
<a name="ln-361"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tsty</span>
<a name="ln-362"></a>    <span class="kt">character </span><span class="n">tch</span>
<a name="ln-363"></a>    <span class="kt">logical </span><span class="n">number</span><span class="p">,</span> <span class="n">ok</span><span class="p">,</span> <span class="n">dmxerr</span><span class="p">,</span> <span class="n">orierr</span><span class="p">,</span> <span class="n">styerr</span><span class="p">,</span> <span class="n">adverr</span>
<a name="ln-364"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ADVOK</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NO    &#39;</span><span class="p">,</span> <span class="s1">&#39;YES   &#39;</span><span class="p">,</span> <span class="s1">&#39;DOUBLE&#39;</span><span class="p">]</span>
<a name="ln-365"></a>    <span class="k">type</span><span class="p">(</span><span class="n">disp_settings</span><span class="p">)</span> <span class="n">ds</span>
<a name="ln-366"></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">DEFSET</span>
<a name="ln-367"></a>    <span class="k">call </span><span class="n">getstyles</span><span class="p">(</span><span class="n">ds</span> <span class="p">%</span> <span class="n">style</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">tch</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">ok</span><span class="p">)</span>
<a name="ln-368"></a>    <span class="n">styerr</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ok</span>
<a name="ln-369"></a>    <span class="n">dmxerr</span> <span class="o">=</span> <span class="n">ds</span> <span class="p">%</span> <span class="n">digmax</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">ds</span> <span class="p">%</span> <span class="n">digmax</span> <span class="o">&gt;</span> <span class="mi">89</span>
<a name="ln-370"></a>    <span class="n">orierr</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">ds</span> <span class="p">%</span> <span class="n">orient</span> <span class="o">/=</span> <span class="p">[</span><span class="s1">&#39;ROW&#39;</span><span class="p">,</span> <span class="s1">&#39;COL&#39;</span><span class="p">])</span>
<a name="ln-371"></a>    <span class="n">adverr</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">ds</span> <span class="p">%</span> <span class="n">advance</span> <span class="o">/=</span> <span class="n">ADVOK</span><span class="p">)</span>
<a name="ln-372"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">dmxerr</span><span class="p">)</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">digmax</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-373"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">orierr</span><span class="p">)</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;COL&#39;</span>
<a name="ln-374"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">styerr</span><span class="p">)</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;LEFT&#39;</span>
<a name="ln-375"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">adverr</span><span class="p">)</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">advance</span> <span class="o">=</span> <span class="s1">&#39;YES&#39;</span>
<a name="ln-376"></a>    <span class="c">!</span>
<a name="ln-377"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">dmxerr</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP_SET: error, illegal digmax (must be 1-89), set to 6&#39;</span><span class="p">)</span>
<a name="ln-378"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">orierr</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP_SET: error, illegal orient: &#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ds</span> <span class="p">%</span> <span class="n">orient</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;, set to &quot;COL&quot;&#39;</span><span class="p">)</span>
<a name="ln-379"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">styerr</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP_SET: error, illegal style: &#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ds</span> <span class="p">%</span> <span class="n">style</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;, set to &quot;LEFT&quot;&#39;</span><span class="p">)</span>
<a name="ln-380"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">adverr</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP_SET: error, illegal advance: &#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ds</span> <span class="p">%</span> <span class="n">advance</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;, set to &quot;YES&quot;&#39;</span><span class="p">)</span>
<a name="ln-381"></a>  <span class="k">end subroutine </span><span class="n">check_settings</span>
<a name="ln-382"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-383"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-384"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-385"></a>  <span class="k">function </span><span class="n">number_rows</span><span class="p">(</span><span class="n">SE</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">nbr</span><span class="p">)</span>
<a name="ln-386"></a>    <span class="c">! Should rows be numbered?</span>
<a name="ln-387"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-388"></a>    <span class="kt">logical </span><span class="n">nbr</span>
<a name="ln-389"></a>    <span class="n">nbr</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-390"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">number</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-391"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">vec</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-392"></a><span class="k">    </span><span class="n">nbr</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-393"></a>  <span class="k">end function </span><span class="n">number_rows</span>
<a name="ln-394"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-395"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-396"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-397"></a>  <span class="k">function </span><span class="n">number_cols</span><span class="p">(</span><span class="n">SE</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">nbr</span><span class="p">)</span>
<a name="ln-398"></a>    <span class="c">! Should columns be numbered?</span>
<a name="ln-399"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-400"></a>    <span class="kt">logical </span><span class="n">nbr</span>
<a name="ln-401"></a>    <span class="n">nbr</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-402"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">number</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-403"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">vec</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-404"></a><span class="k">    </span><span class="n">nbr</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-405"></a>  <span class="k">end function </span><span class="n">number_cols</span>
<a name="ln-406"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-407"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-408"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-409"></a>  <span class="k">subroutine </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-410"></a>    <span class="c">! Determine format to use to write matrix to box and row where matrix begins, copy</span>
<a name="ln-411"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>     <span class="c">! The title to use for the matrix</span>
<a name="ln-412"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">SE</span>        <span class="c">! Settings</span>
<a name="ln-413"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">m</span>         <span class="c">! Row count of matrix</span>
<a name="ln-414"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">n</span>         <span class="c">! Column count of matrix</span>
<a name="ln-415"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>    <span class="c">! widths of columns in matrix</span>
<a name="ln-416"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">widp</span><span class="p">(:)</span>   <span class="c">! widths of columns in box (max(wid, width of col nums))</span>
<a name="ln-417"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">lin1</span>      <span class="c">! Row number where matrix begins (tsty=&#39;left&#39; 0, &#39;pad&#39; 1, &#39;underline&#39; 2)</span>
<a name="ln-418"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">wleft</span>     <span class="c">! Number of spaces on left of matrix (when tsty is left or title long)</span>
<a name="ln-419"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span>            <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span> <span class="c">! The box</span>
<a name="ln-420"></a>
<a name="ln-421"></a>    <span class="kt">integer </span><span class="n">wt</span><span class="p">,</span> <span class="n">wa</span>          <span class="c">! Char count of title, idth of matrix in characters (wbox = lm + wa + rm)</span>
<a name="ln-422"></a>    <span class="kt">integer </span><span class="n">wbox</span><span class="p">,</span> <span class="n">wrow</span>      <span class="c">! Width of box in characters, width of row numbers in characters</span>
<a name="ln-423"></a>    <span class="kt">integer </span><span class="n">lm</span>              <span class="c">! Left margin</span>
<a name="ln-424"></a>    <span class="kt">integer </span><span class="n">h</span><span class="p">,</span><span class="n">ws</span>            <span class="c">! Height of box in characters, length of column separator</span>
<a name="ln-425"></a>    <span class="kt">integer </span><span class="n">m1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">i</span>       <span class="c">! lower bounds (for numbering), index</span>
<a name="ln-426"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="n">sn</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">row_nums</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">col_nums</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-427"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">fmt</span>
<a name="ln-428"></a>
<a name="ln-429"></a>    <span class="c">! ----------wbox---------    -----------wbox----------     -----wbox------</span>
<a name="ln-430"></a>    <span class="c">! ---lm---                   --wleft-                             --wt-</span>
<a name="ln-431"></a>    <span class="c">! ----wleft---                lm wrow    wa       rm       wrow    wa</span>
<a name="ln-432"></a>    <span class="c">!    wt   wrow    wa         ----====-----------======     ----===========</span>
<a name="ln-433"></a>    <span class="c">! --------====-----------    THIS-IS-A-VERY-LONG-TITLE            TITLE</span>
<a name="ln-434"></a>    <span class="c">!               1     2                1     2                   1     2</span>
<a name="ln-435"></a>    <span class="c">! MATRIX = 1   4.50  6.80         1   4.50  6.80            1   4.50  6.80</span>
<a name="ln-436"></a>    <span class="c">!          2   6.88  9.22         2   6.88  9.22            2   6.88  9.22</span>
<a name="ln-437"></a>    <span class="c">!          3  19.44  0.08         3  19.44  0.08            3  19.44  0.08</span>
<a name="ln-438"></a>    <span class="c">!          ...                    ...                       ...</span>
<a name="ln-439"></a>    <span class="c">!         10   6.18  4.22        10   6.18  4.22           10   6.18  4.22</span>
<a name="ln-440"></a>    <span class="c">! rm = 0                     wt = wbox                     lm = rm = 0, wleft = wrow</span>
<a name="ln-441"></a>    <span class="n">m1</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">m1</span>
<a name="ln-442"></a>    <span class="n">n1</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">n1</span>
<a name="ln-443"></a>    <span class="n">ws</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span>
<a name="ln-444"></a>    <span class="n">wt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<a name="ln-445"></a>    <span class="n">wrow</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-446"></a>    <span class="n">widp</span> <span class="o">=</span> <span class="n">wid</span>
<a name="ln-447"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">number</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-448"></a><span class="k">      </span><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;(SS,I0)&#39;</span>
<a name="ln-449"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">number_cols</span><span class="p">(</span><span class="n">SE</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-450"></a><span class="k">        write</span><span class="p">(</span><span class="n">col_nums</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
<a name="ln-451"></a>        <span class="n">widp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">col_nums</span><span class="p">))</span>
<a name="ln-452"></a>      <span class="k">endif</span>
<a name="ln-453"></a><span class="k">      if</span> <span class="p">(</span><span class="n">number_rows</span><span class="p">(</span><span class="n">SE</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-454"></a><span class="k">        write</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-455"></a>        <span class="n">wrow</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sn</span><span class="p">))</span> <span class="o">+</span> <span class="n">ws</span>  <span class="c">! determine max width of row numbers</span>
<a name="ln-456"></a>        <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">wrow</span> <span class="o">-</span> <span class="n">ws</span><span class="p">)</span> <span class="c">! to create e.g. &#39;I5&#39; from &#39;I0&#39;</span>
<a name="ln-457"></a>        <span class="k">write</span><span class="p">(</span><span class="n">row_nums</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
<a name="ln-458"></a>      <span class="k">endif</span>
<a name="ln-459"></a><span class="k">    endif</span>
<a name="ln-460"></a><span class="k">    </span><span class="n">wa</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ws</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">widp</span><span class="p">)</span>
<a name="ln-461"></a>    <span class="k">select case</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">tsty</span><span class="p">))</span>
<a name="ln-462"></a>    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;LEFT&#39;</span><span class="p">);</span>      <span class="n">lin1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">wbox</span> <span class="o">=</span> <span class="n">wt</span> <span class="o">+</span> <span class="n">wrow</span> <span class="o">+</span> <span class="n">wa</span><span class="p">;</span>     <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">);</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">wt</span>
<a name="ln-463"></a>    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;PAD&#39;</span><span class="p">);</span>       <span class="n">lin1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">wbox</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span> <span class="n">wa</span> <span class="o">+</span> <span class="n">wrow</span><span class="p">);</span> <span class="n">h</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>    <span class="n">lm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">wt</span> <span class="o">-</span> <span class="n">wa</span> <span class="o">-</span> <span class="n">wrow</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-464"></a>    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;UNDERLINE&#39;</span><span class="p">);</span> <span class="n">lin1</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">wbox</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span> <span class="n">wa</span> <span class="o">+</span> <span class="n">wrow</span><span class="p">);</span> <span class="n">h</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>    <span class="n">lm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">wt</span> <span class="o">-</span> <span class="n">wa</span> <span class="o">-</span> <span class="n">wrow</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-465"></a>    <span class="k">case </span><span class="n">default</span><span class="p">;</span>      <span class="n">lin1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">wbox</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">lm</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! should not happen</span>
<a name="ln-466"></a>    <span class="k">end select</span>
<a name="ln-467"></a><span class="k">    </span><span class="n">wleft</span> <span class="o">=</span> <span class="n">lm</span>
<a name="ln-468"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">number_cols</span><span class="p">(</span><span class="n">SE</span><span class="p">))</span> <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-469"></a>    <span class="k">call </span><span class="n">newbox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lun</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">wbox</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-470"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">number_cols</span><span class="p">(</span><span class="n">SE</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-471"></a><span class="k">      call </span><span class="n">copycolumnnumberstobox</span><span class="p">(</span><span class="n">col_nums</span><span class="p">,</span> <span class="n">wleft</span> <span class="o">+</span> <span class="n">wrow</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span>  <span class="n">boxp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">)</span>
<a name="ln-472"></a>    <span class="k">endif</span>
<a name="ln-473"></a><span class="k">    if</span> <span class="p">(</span><span class="n">number_rows</span><span class="p">(</span><span class="n">SE</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-474"></a><span class="k">      call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">row_nums</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wrow</span> <span class="o">-</span> <span class="n">ws</span><span class="p">,</span> <span class="n">wrow</span> <span class="o">-</span> <span class="n">ws</span><span class="p">,</span> <span class="n">nblj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boxp</span> <span class="o">=</span> <span class="n">boxp</span><span class="p">,</span> <span class="n">wleft</span> <span class="o">=</span> <span class="n">wleft</span><span class="p">)</span>
<a name="ln-475"></a>      <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span> <span class="n">wleft</span><span class="p">)</span>
<a name="ln-476"></a>    <span class="k">endif</span>
<a name="ln-477"></a><span class="k">  end subroutine </span><span class="n">preparebox</span>
<a name="ln-478"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-479"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-480"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-481"></a>  <span class="k">subroutine </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">widj</span><span class="p">,</span> <span class="n">widpj</span><span class="p">,</span> <span class="n">nblj</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-482"></a>    <span class="c">! Copy strings to column in boxp; update wleft to current char column in boxp</span>
<a name="ln-483"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">s</span><span class="p">(:)</span>        <span class="c">! the strings to copy</span>
<a name="ln-484"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">widj</span>  <span class="c">! first line in box to copy to, width of column</span>
<a name="ln-485"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">nblj</span><span class="p">,</span> <span class="n">widpj</span> <span class="c">! number of blank characters to trim from left of s, offset to next col</span>
<a name="ln-486"></a>    <span class="kt">character</span><span class="p">,</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>   <span class="c">! the box to accept the column</span>
<a name="ln-487"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wleft</span>       <span class="c">! number of char-columns in box already written to</span>
<a name="ln-488"></a>    <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-489"></a>    <span class="n">wleft</span> <span class="o">=</span> <span class="n">wleft</span> <span class="o">+</span> <span class="n">widpj</span> <span class="o">-</span> <span class="n">widj</span>
<a name="ln-490"></a>    <span class="k">forall</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">widj</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="n">boxp</span><span class="p">(</span><span class="n">wleft</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">lin1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">j</span><span class="p">)(</span><span class="n">i</span><span class="o">+</span><span class="n">nblj</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">nblj</span><span class="p">)</span>
<a name="ln-491"></a>    <span class="n">wleft</span> <span class="o">=</span> <span class="n">wleft</span> <span class="o">+</span> <span class="n">widj</span>
<a name="ln-492"></a>  <span class="k">end subroutine </span><span class="n">copytobox</span>
<a name="ln-493"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-494"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-495"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-496"></a>  <span class="k">subroutine </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-497"></a>    <span class="c">! Copy column separator to boxp; update wleft</span>
<a name="ln-498"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">sep</span>
<a name="ln-499"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span>
<a name="ln-500"></a>    <span class="kt">character</span><span class="p">,</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-501"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wleft</span>
<a name="ln-502"></a>    <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-503"></a>    <span class="k">forall</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">sep</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="n">boxp</span><span class="p">(</span><span class="n">wleft</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">lin1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sep</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-504"></a>    <span class="n">wleft</span> <span class="o">=</span> <span class="n">wleft</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<a name="ln-505"></a>  <span class="k">end subroutine </span><span class="n">copyseptobox</span>
<a name="ln-506"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-507"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-508"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-509"></a>  <span class="k">subroutine </span><span class="n">copycolumnnumberstobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lsep</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">)</span>
<a name="ln-510"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">s</span><span class="p">(:)</span>      <span class="c">! strings with left-adjusted column numbers</span>
<a name="ln-511"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">wleft</span>     <span class="c">! char positions on left of 1st col</span>
<a name="ln-512"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>    <span class="c">! widths of columns in matrix</span>
<a name="ln-513"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">widp</span><span class="p">(:)</span>   <span class="c">! widths of columns in box (max(wid, width of col nums))</span>
<a name="ln-514"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">lsep</span>      <span class="c">! width of column separator</span>
<a name="ln-515"></a>    <span class="kt">character</span><span class="p">,</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span> <span class="c">! receives the numbers</span>
<a name="ln-516"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lin1</span>      <span class="c">! line number in box to copy to</span>
<a name="ln-517"></a>    <span class="kt">integer </span><span class="n">ls</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">rmargmax</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">lmargin</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-518"></a>    <span class="c">!</span>
<a name="ln-519"></a>    <span class="n">ls</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-520"></a>    <span class="n">rmargmax</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">minval</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span> <span class="o">-</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">ls</span><span class="p">)))</span><span class="o">/</span><span class="mi">2</span> <span class="c">! locate according to narrowest column, widest number</span>
<a name="ln-521"></a>    <span class="n">k</span> <span class="o">=</span> <span class="n">wleft</span>
<a name="ln-522"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>
<a name="ln-523"></a>      <span class="n">lmargin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">widp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">ls</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">rmargmax</span><span class="p">)</span>
<a name="ln-524"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">lmargin</span>
<a name="ln-525"></a>      <span class="k">forall</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">ls</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">boxp</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">lin1</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span>
<a name="ln-526"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">widp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">lmargin</span> <span class="o">+</span> <span class="n">lsep</span>
<a name="ln-527"></a>    <span class="k">enddo</span>
<a name="ln-528"></a><span class="k">    </span><span class="n">lin1</span> <span class="o">=</span> <span class="n">lin1</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-529"></a>  <span class="k">end subroutine </span><span class="n">copycolumnnumberstobox</span>
<a name="ln-530"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-531"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-532"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-533"></a>  <span class="k">subroutine </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-534"></a>    <span class="c">! Finish creating a box and display it if advancing is turned on</span>
<a name="ln-535"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>     <span class="c">! The title to use for the matrix</span>
<a name="ln-536"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">SE</span>        <span class="c">! Settings</span>
<a name="ln-537"></a>    <span class="kt">character</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span> <span class="c">! The box</span>
<a name="ln-538"></a>    <span class="c">!</span>
<a name="ln-539"></a>    <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">wt</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">wpadright</span><span class="p">,</span> <span class="n">wpadleft</span> <span class="c">! index, width of title, width of box and spacing on either side of it</span>
<a name="ln-540"></a>    <span class="kt">integer </span><span class="n">lin1</span> <span class="c">! line to put left title</span>
<a name="ln-541"></a>    <span class="c">!</span>
<a name="ln-542"></a>    <span class="n">wt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<a name="ln-543"></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">boxp</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-544"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">tsty</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-545"></a><span class="k">      </span><span class="n">lin1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-546"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">number_cols</span><span class="p">(</span><span class="n">SE</span><span class="p">))</span> <span class="n">lin1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">boxp</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-547"></a>      <span class="k">forall</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">wt</span><span class="p">)</span> <span class="n">boxp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lin1</span><span class="p">)</span> <span class="o">=</span> <span class="n">title</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-548"></a>    <span class="k">else</span>
<a name="ln-549"></a><span class="k">      </span><span class="n">wpadright</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">wt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-550"></a>      <span class="n">wpadleft</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">wpadright</span> <span class="o">-</span> <span class="n">wt</span>
<a name="ln-551"></a>      <span class="k">forall</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">wt</span><span class="p">)</span> <span class="n">boxp</span><span class="p">(</span><span class="n">wpadleft</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">title</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-552"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">tsty</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;PAD&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-553"></a><span class="k">        </span><span class="n">boxp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">wpadleft</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">tch</span>
<a name="ln-554"></a>        <span class="n">boxp</span><span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">wpadright</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">w</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">tch</span>
<a name="ln-555"></a>      <span class="k">else</span> <span class="c">! tsty == &#39;UNDERLINE&#39;</span>
<a name="ln-556"></a>        <span class="n">boxp</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">tch</span>
<a name="ln-557"></a>      <span class="k">endif</span>
<a name="ln-558"></a><span class="k">    endif</span>
<a name="ln-559"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">adv</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">call </span><span class="n">dispboxlist</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lun</span><span class="p">,</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">matsep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">DEFSET</span> <span class="p">%</span> <span class="n">matseplen</span><span class="p">))</span>
<a name="ln-560"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">adv</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">dispnewline</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lun</span><span class="p">)</span>
<a name="ln-561"></a>  <span class="k">end subroutine </span><span class="n">finishbox</span>
<a name="ln-562"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-563"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-564"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-565"></a>  <span class="k">subroutine </span><span class="n">find_editdesc_real</span><span class="p">(</span><span class="nb">exp</span><span class="p">,</span> <span class="n">expm</span><span class="p">,</span> <span class="n">dmx</span><span class="p">,</span>  <span class="n">edesc</span><span class="p">,</span> <span class="n">flen</span><span class="p">,</span> <span class="n">ndec</span><span class="p">,</span> <span class="n">posit</span><span class="p">)</span>
<a name="ln-566"></a>    <span class="c">! Subroutine of find_editdesc_sngl and find_editdesc_dble</span>
<a name="ln-567"></a>    <span class="kt">integer</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">expm</span><span class="p">,</span> <span class="n">dmx</span>
<a name="ln-568"></a>    <span class="kt">integer</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">exp</span>
<a name="ln-569"></a><span class="nb">    </span><span class="kt">character</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">edesc</span>
<a name="ln-570"></a>    <span class="kt">integer</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">flen</span><span class="p">,</span> <span class="n">ndec</span>
<a name="ln-571"></a>    <span class="kt">logical</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">posit</span>
<a name="ln-572"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">neg</span><span class="p">,</span> <span class="n">nxp</span>
<a name="ln-573"></a>    <span class="nb">exp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">exp</span><span class="p">,</span> <span class="n">expm</span><span class="p">)</span>
<a name="ln-574"></a>    <span class="n">neg</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-575"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">exp</span> <span class="o">&lt;</span> <span class="n">dmx</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">exp</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-576"></a><span class="k">      if</span> <span class="p">(</span><span class="n">posit</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">exp</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">expm</span><span class="p">))</span> <span class="n">neg</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-577"></a>      <span class="n">edesc</span> <span class="o">=</span> <span class="s1">&#39;(SS,Fxx.yy)&#39;</span>
<a name="ln-578"></a>      <span class="n">ndec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmx</span> <span class="o">-</span> <span class="nb">exp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-579"></a>      <span class="n">flen</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ndec</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">exp</span><span class="p">)</span> <span class="c">! -X.YYYYY (2 covers X and .)</span>
<a name="ln-580"></a>      <span class="k">write</span><span class="p">(</span><span class="n">edesc</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;(SS,I2,&quot;.&quot;,I2)&#39;</span><span class="p">)</span> <span class="n">flen</span><span class="p">,</span> <span class="n">ndec</span>
<a name="ln-581"></a>    <span class="k">else</span>
<a name="ln-582"></a><span class="k">      if</span> <span class="p">(</span><span class="n">posit</span><span class="p">)</span> <span class="n">neg</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-583"></a>      <span class="k">if</span>     <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">exp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">nxp</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-584"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">exp</span><span class="p">)</span> <span class="o">&gt;</span>  <span class="mi">99</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">nxp</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-585"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">exp</span><span class="p">)</span> <span class="o">&gt;</span>   <span class="mi">9</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">nxp</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-586"></a>      <span class="k">else</span>                        <span class="p">;</span> <span class="n">nxp</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-587"></a>      <span class="k">endif</span>
<a name="ln-588"></a><span class="k">      </span><span class="n">flen</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">dmx</span> <span class="o">+</span> <span class="n">nxp</span>
<a name="ln-589"></a>      <span class="n">edesc</span> <span class="o">=</span> <span class="s1">&#39;(SS,ESxx.yyEz)&#39;</span>
<a name="ln-590"></a>      <span class="k">write</span><span class="p">(</span><span class="n">edesc</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">13</span><span class="p">),</span> <span class="s1">&#39;(SS,I2,&quot;.&quot;,I2,&quot;E&quot;,I1)&#39;</span><span class="p">)</span> <span class="n">flen</span><span class="p">,</span> <span class="n">dmx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxp</span>
<a name="ln-591"></a>      <span class="n">ndec</span> <span class="o">=</span> <span class="n">dmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-592"></a>    <span class="k">endif</span>
<a name="ln-593"></a><span class="k">  end subroutine </span><span class="n">find_editdesc_real</span>
<a name="ln-594"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-595"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-596"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-597"></a>  <span class="k">pure subroutine </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-598"></a>    <span class="c">! Returns w and d when fmt is (Xw.d) or (Xw) (then d = 0), X = edit descriptor letter</span>
<a name="ln-599"></a>    <span class="c">! (I, F, etc). X can also be ES, DS, 1PG or 1PF. Returns w = -1 for illegal fmt.</span>
<a name="ln-600"></a>    <span class="c">! Returns gedit = .true. if fmt is Gw.d. How about SS,1PES4.3?</span>
<a name="ln-601"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt</span>  <span class="c">! e.g. fmt = F 8.2</span>
<a name="ln-602"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt1</span> <span class="c">! returns &#39;(SS,F8.2)&#39;</span>
<a name="ln-603"></a>    <span class="kt">character </span><span class="n">ch</span>
<a name="ln-604"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-605"></a>    <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-606"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">k0</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">k4</span>
<a name="ln-607"></a>    <span class="k">call </span><span class="n">sszipfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span>
<a name="ln-608"></a>    <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">gedit</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-609"></a>    <span class="n">k1</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="mi">2</span><span class="p">:),</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-610"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="c">! only digits</span>
<a name="ln-611"></a>    <span class="n">k2</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k1</span><span class="p">:),</span> <span class="s1">&#39;ABDEFGILNOPSZabdefgilnopsz,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span> <span class="c">! , for &quot;1P,G12.3&quot;</span>
<a name="ln-612"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k2</span> <span class="o">&lt;=</span> <span class="n">k1</span><span class="p">)</span> <span class="k">return</span> <span class="c">! no letter or only letters</span>
<a name="ln-613"></a>    <span class="n">ch</span> <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-614"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="c">! deal with SS,1PG13.5</span>
<a name="ln-615"></a>      <span class="n">k0</span> <span class="o">=</span> <span class="n">k2</span>
<a name="ln-616"></a>      <span class="n">k1</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k0</span><span class="p">:),</span><span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-617"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-618"></a><span class="k">      </span><span class="n">k2</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k1</span><span class="p">:),</span><span class="s1">&#39;ABDEFGILNOPSZabdefgilnopsz,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-619"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k2</span> <span class="o">&lt;=</span> <span class="n">k1</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-620"></a><span class="k">      </span><span class="n">ch</span> <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-621"></a>    <span class="k">endif</span>
<a name="ln-622"></a><span class="k">    </span><span class="n">gedit</span> <span class="o">=</span> <span class="n">ch</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">ch</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span>
<a name="ln-623"></a>    <span class="n">k3</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k2</span><span class="p">:),</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-624"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k3</span> <span class="o">==</span> <span class="n">k2</span><span class="p">)</span> <span class="k">return</span> <span class="c">! no digits</span>
<a name="ln-625"></a>    <span class="k">read</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k2</span><span class="p">:</span><span class="n">k3</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="p">)</span> <span class="n">w</span>
<a name="ln-626"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k3</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt1</span><span class="p">))</span> <span class="k">return</span>
<a name="ln-627"></a><span class="k">    if</span> <span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k3</span><span class="p">:</span><span class="n">k3</span><span class="p">)</span> <span class="o">/=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="c">! not . after w</span>
<a name="ln-628"></a>    <span class="n">k4</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k3</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k3</span>
<a name="ln-629"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k4</span> <span class="o">==</span> <span class="n">k3</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="c">! no digits</span>
<a name="ln-630"></a>    <span class="k">read</span><span class="p">(</span><span class="n">fmt1</span><span class="p">(</span><span class="n">k3</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k4</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="p">)</span> <span class="n">d</span>
<a name="ln-631"></a>  <span class="k">end subroutine </span><span class="n">readfmt</span>
<a name="ln-632"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-633"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-634"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-635"></a>  <span class="k">pure subroutine </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">wnew</span><span class="p">)</span>
<a name="ln-636"></a>    <span class="c">! Change e.g. &#39;(F0.3)&#39; to &#39;(F5.3)&#39;. Works also for &#39;(SS,I0)&#39; to &#39;(SS,I5)&#39;. If wnew &gt; 999, set it to 999</span>
<a name="ln-637"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-638"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wnew</span>
<a name="ln-639"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">k0</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span>
<a name="ln-640"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">rw</span>
<a name="ln-641"></a>    <span class="n">k1</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="mi">2</span><span class="p">:),</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-642"></a>    <span class="n">k2</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">k1</span><span class="p">:),</span> <span class="s1">&#39;ABDEFGILNOPSZabdefgilnopsz,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-643"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k2</span> <span class="o">==</span> <span class="n">k1</span><span class="p">)</span> <span class="k">return</span> <span class="c">! no letter</span>
<a name="ln-644"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Handle (SS,1PF10.3)</span>
<a name="ln-645"></a>      <span class="n">k0</span> <span class="o">=</span> <span class="n">k2</span>
<a name="ln-646"></a>      <span class="n">k1</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">k0</span><span class="p">:),</span><span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-647"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-648"></a><span class="k">      </span><span class="n">k2</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">k1</span><span class="p">:),</span><span class="s1">&#39;ABDEFGILNOPSZabdefgilnopsz,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-649"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k2</span> <span class="o">&lt;=</span> <span class="n">k1</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-650"></a><span class="k">    endif</span>
<a name="ln-651"></a><span class="k">    </span><span class="n">k3</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">k2</span><span class="p">:),</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-652"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">k3</span> <span class="o">==</span> <span class="n">k2</span><span class="p">)</span> <span class="k">return</span> <span class="c">! no digits</span>
<a name="ln-653"></a>    <span class="k">write</span><span class="p">(</span><span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;(SS,I0)&#39;</span><span class="p">)</span> <span class="nb">min</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span><span class="n">wnew</span><span class="p">)</span>
<a name="ln-654"></a>    <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">rw</span><span class="p">)</span> <span class="o">//</span> <span class="n">fmt</span><span class="p">(</span><span class="n">k3</span><span class="p">:)</span>
<a name="ln-655"></a>  <span class="k">end subroutine </span><span class="n">replace_w</span>
<a name="ln-656"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-657"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-658"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-659"></a>  <span class="k">subroutine </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">shapex</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">digmax</span><span class="p">)</span>
<a name="ln-660"></a>    <span class="c">! Get the settings from the optional parameters fmt...zeroas in to the structure SE.</span>
<a name="ln-661"></a>    <span class="c">! Replace absent arguments with corresponding values from the structure DEFSET.</span>
<a name="ln-662"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-663"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>
<a name="ln-664"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">shapex</span><span class="p">(:)</span>
<a name="ln-665"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-666"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-667"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-668"></a>    <span class="kt">logical </span><span class="n">ok</span>
<a name="ln-669"></a>    <span class="c">!</span>
<a name="ln-670"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="n">ed</span>
<a name="ln-671"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="n">sep</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">zas</span>
<a name="ln-672"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">tch</span>
<a name="ln-673"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="n">advchr</span>
<a name="ln-674"></a>    <span class="kt">integer </span><span class="n">lun</span><span class="p">,</span> <span class="n">dmx</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">lsep</span><span class="p">,</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">adv</span>
<a name="ln-675"></a>    <span class="kt">logical </span><span class="n">trm</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">is_scalar</span><span class="p">,</span> <span class="n">gedit</span>
<a name="ln-676"></a>    <span class="c">!</span>
<a name="ln-677"></a>    <span class="n">vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">shapex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-678"></a>    <span class="n">is_scalar</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">shapex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-679"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">vec</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">orient</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-680"></a><span class="k">      select case</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">orient</span><span class="p">))</span>
<a name="ln-681"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ROW&#39;</span><span class="p">);</span>  <span class="n">row</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-682"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;COL&#39;</span><span class="p">);</span>  <span class="n">row</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-683"></a>      <span class="k">case </span><span class="n">default</span><span class="p">;</span>
<a name="ln-684"></a>        <span class="c">! do not use trim(3f), as using trim as an argument name</span>
<a name="ln-685"></a>        <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, wrong value of orient: &#39;</span><span class="o">//</span><span class="n">orient</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">orient</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;, using &quot;COL&quot;&#39;</span><span class="p">)</span>
<a name="ln-686"></a>        <span class="n">row</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-687"></a>      <span class="k">end select</span>
<a name="ln-688"></a><span class="k">    </span><span class="n">elseif</span> <span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-689"></a><span class="k">      </span><span class="n">row</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">orient</span> <span class="o">==</span> <span class="s1">&#39;ROW&#39;</span>
<a name="ln-690"></a>    <span class="k">else</span>
<a name="ln-691"></a><span class="k">      </span><span class="n">row</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-692"></a>    <span class="k">endif</span>
<a name="ln-693"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-694"></a><span class="k">      call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">ed</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-695"></a>    <span class="k">else</span>
<a name="ln-696"></a><span class="k">      </span><span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;()&#39;</span>
<a name="ln-697"></a>      <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">gedit</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-698"></a>    <span class="k">endif</span>
<a name="ln-699"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-700"></a><span class="k">      </span><span class="n">lun</span> <span class="o">=</span> <span class="n">unit</span>
<a name="ln-701"></a>    <span class="k">else</span>
<a name="ln-702"></a><span class="k">      </span><span class="n">lun</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">unit</span>
<a name="ln-703"></a>    <span class="k">endif</span>
<a name="ln-704"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">digmax</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-705"></a><span class="k">      </span><span class="n">dmx</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">digmax</span>
<a name="ln-706"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-707"></a><span class="k">      call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, both FMT and DIGMAX present, ignoring DIGMAX&#39;</span><span class="p">)</span>
<a name="ln-708"></a>      <span class="n">dmx</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-709"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="n">digmax</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">digmax</span> <span class="o">&gt;</span> <span class="mi">89</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-710"></a><span class="k">      call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, digmax must be &gt;= 1 and &lt; 90, using 6&#39;</span><span class="p">)</span>
<a name="ln-711"></a>      <span class="n">dmx</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-712"></a>    <span class="k">else</span>
<a name="ln-713"></a><span class="k">      </span><span class="n">dmx</span> <span class="o">=</span> <span class="n">digmax</span>
<a name="ln-714"></a>    <span class="k">endif</span>
<a name="ln-715"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">advance</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-716"></a><span class="k">      </span><span class="n">advchr</span> <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">advance</span><span class="p">)</span>
<a name="ln-717"></a>    <span class="k">else</span>
<a name="ln-718"></a><span class="k">      </span><span class="n">advchr</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">advance</span>
<a name="ln-719"></a>    <span class="k">endif</span>
<a name="ln-720"></a><span class="k">    select case</span><span class="p">(</span><span class="n">trims</span><span class="p">(</span><span class="n">advchr</span><span class="p">))</span>
<a name="ln-721"></a>    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;NO&#39;</span><span class="p">);</span>     <span class="n">adv</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-722"></a>    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;YES&#39;</span><span class="p">);</span>    <span class="n">adv</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-723"></a>    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;DOUBLE&#39;</span><span class="p">);</span> <span class="n">adv</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-724"></a>    <span class="k">case </span><span class="n">default</span>
<a name="ln-725"></a>      <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, illegal advance: &#39;</span> <span class="o">//</span> <span class="n">trims</span><span class="p">(</span><span class="n">advance</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;, using &quot;YES&quot;&#39;</span><span class="p">)</span>
<a name="ln-726"></a>      <span class="n">adv</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-727"></a>    <span class="k">end select</span>
<a name="ln-728"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="nb">trim</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-729"></a><span class="k">      if</span> <span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="nb">trim</span><span class="p">)</span> <span class="o">/=</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">upper</span><span class="p">(</span><span class="nb">trim</span><span class="p">)</span> <span class="o">/=</span> <span class="s1">&#39;NO&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">upper</span><span class="p">(</span><span class="nb">trim</span><span class="p">)</span> <span class="o">/=</span> <span class="s1">&#39;AUTO&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-730"></a><span class="k">        call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, illegal trim: &#39;</span> <span class="o">//</span> <span class="n">trims</span><span class="p">(</span><span class="nb">trim</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;, using &quot;YES&quot;&#39;</span><span class="p">)</span>
<a name="ln-731"></a>        <span class="n">trm</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-732"></a>      <span class="k">else</span>
<a name="ln-733"></a><span class="k">        </span><span class="n">trm</span> <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="nb">trim</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">upper</span><span class="p">(</span><span class="nb">trim</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;AUTO&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">FMT</span><span class="p">)</span>
<a name="ln-734"></a>      <span class="k">endif</span>
<a name="ln-735"></a><span class="k">    </span><span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-736"></a><span class="k">      </span><span class="n">trm</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-737"></a>    <span class="k">else</span>
<a name="ln-738"></a><span class="k">      </span><span class="n">trm</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="nb">trim</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="nb">trim</span> <span class="o">==</span> <span class="s1">&#39;AUTO&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">FMT</span><span class="p">)</span>
<a name="ln-739"></a>    <span class="k">endif</span>
<a name="ln-740"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">separator</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-741"></a><span class="k">      </span><span class="n">sep</span> <span class="o">=</span> <span class="n">separator</span>
<a name="ln-742"></a>      <span class="n">lsep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
<a name="ln-743"></a>    <span class="k">else</span>
<a name="ln-744"></a><span class="k">      </span><span class="n">sep</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">sep</span>
<a name="ln-745"></a>      <span class="n">lsep</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">seplen</span>
<a name="ln-746"></a>    <span class="k">endif</span>
<a name="ln-747"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">style</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-748"></a><span class="k">      call </span><span class="n">getstyles</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">tch</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">ok</span><span class="p">)</span>
<a name="ln-749"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ok</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, illegal style: &#39;</span><span class="o">//</span><span class="n">style</span><span class="o">//</span><span class="s1">&#39;. Using default instead&#39;</span><span class="p">)</span>
<a name="ln-750"></a>    <span class="k">else</span>
<a name="ln-751"></a><span class="k">      call </span><span class="n">getstyles</span><span class="p">(</span><span class="n">DEFSET</span> <span class="p">%</span> <span class="n">style</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">tch</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">ok</span><span class="p">)</span>
<a name="ln-752"></a>    <span class="k">endif</span>
<a name="ln-753"></a><span class="k">    if</span> <span class="p">(</span><span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="n">tsty</span> <span class="o">=</span> <span class="s1">&#39;LEFT&#39;</span>
<a name="ln-754"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">is_scalar</span><span class="p">)</span> <span class="n">number</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-755"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">zeroas</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-756"></a><span class="k">      </span><span class="n">zas</span> <span class="o">=</span> <span class="n">zeroas</span>
<a name="ln-757"></a>      <span class="n">lzas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeroas</span><span class="p">)</span>
<a name="ln-758"></a>    <span class="k">else</span>
<a name="ln-759"></a><span class="k">      </span><span class="n">zas</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">zeroas</span>
<a name="ln-760"></a>      <span class="n">lzas</span> <span class="o">=</span> <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">zaslen</span>
<a name="ln-761"></a>    <span class="k">endif</span>
<a name="ln-762"></a><span class="k">    if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">lzas</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">lzas</span><span class="p">)</span>
<a name="ln-763"></a>    <span class="n">zas</span> <span class="o">=</span> <span class="n">zas</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lzas</span><span class="p">)</span>
<a name="ln-764"></a>    <span class="n">m1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-765"></a>    <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-766"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="nb">lbound</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-767"></a><span class="k">      </span><span class="n">number</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-768"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="nb">lbound</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-769"></a><span class="k">        if</span> <span class="p">(</span><span class="n">vec</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-770"></a><span class="k">          </span><span class="n">n1</span> <span class="o">=</span> <span class="nb">lbound</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-771"></a>        <span class="k">else</span>
<a name="ln-772"></a><span class="k">          </span><span class="n">m1</span> <span class="o">=</span> <span class="nb">lbound</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-773"></a>        <span class="k">endif</span>
<a name="ln-774"></a><span class="k">      </span><span class="n">elseif</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="nb">lbound</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-775"></a><span class="k">        </span><span class="n">m1</span> <span class="o">=</span> <span class="nb">lbound</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-776"></a>        <span class="n">n1</span> <span class="o">=</span> <span class="nb">lbound</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-777"></a>      <span class="k">endif</span>
<a name="ln-778"></a><span class="k">    endif</span>
<a name="ln-779"></a><span class="k">    </span><span class="n">SE</span> <span class="o">=</span> <span class="n">settings</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">zas</span><span class="p">,</span> <span class="n">tch</span><span class="p">,</span> <span class="n">lun</span><span class="p">,</span> <span class="n">dmx</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">lsep</span><span class="p">,</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">adv</span><span class="p">,</span> <span class="n">trm</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-780"></a>  <span class="k">contains</span>
<a name="ln-781"></a><span class="k">    function </span><span class="n">trims</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a name="ln-782"></a>      <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-783"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="kd">::</span> <span class="n">t</span>
<a name="ln-784"></a>      <span class="k">intrinsic </span><span class="nb">trim</span>
<a name="ln-785"></a><span class="nb">      </span><span class="n">t</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-786"></a>    <span class="k">end function </span><span class="n">trims</span>
<a name="ln-787"></a>  <span class="k">end subroutine </span><span class="n">get_SE</span>
<a name="ln-788"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-789"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-790"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-791"></a>  <span class="k">subroutine </span><span class="n">getstyles</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">tsty</span><span class="p">,</span> <span class="n">tch</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">ok</span><span class="p">)</span>
<a name="ln-792"></a>    <span class="c">! Return tsty = &#39;LEFT&#39;, &#39;PAD&#39;, or &#39;UNDERLINE&#39;, tch = x from xPAD or xUNDERLINE, number = .true. if style includes</span>
<a name="ln-793"></a>    <span class="c">! NUMBER. If style has ABOVE, return tsty = &#39;PAD&#39; and tch = &#39; &#39;. Return tsty = &#39;LEFT&#39; if error. See NOTE 1 below.</span>
<a name="ln-794"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">style</span>
<a name="ln-795"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tsty</span>
<a name="ln-796"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tch</span>
<a name="ln-797"></a>    <span class="kt">logical</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">number</span><span class="p">,</span> <span class="n">ok</span>
<a name="ln-798"></a>    <span class="kt">integer </span><span class="n">kamp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">nsty</span>
<a name="ln-799"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>   <span class="kd">::</span> <span class="n">sty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-800"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">LPUA</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LEFT     &#39;</span><span class="p">,</span> <span class="s1">&#39;PAD      &#39;</span><span class="p">,</span> <span class="s1">&#39;UNDERLINE&#39;</span><span class="p">,</span> <span class="s1">&#39;ABOVE    &#39;</span><span class="p">]</span>
<a name="ln-801"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">PU</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PAD      &#39;</span><span class="p">,</span> <span class="s1">&#39;UNDERLINE&#39;</span><span class="p">]</span>
<a name="ln-802"></a>    <span class="n">kamp</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">style</span><span class="p">),</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
<a name="ln-803"></a>    <span class="n">ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-804"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">kamp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-805"></a><span class="k">      </span><span class="n">sty</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">style</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">kamp</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-806"></a>      <span class="n">sty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">style</span><span class="p">(</span><span class="n">kamp</span><span class="o">+</span><span class="mi">1</span><span class="p">:)))</span>
<a name="ln-807"></a>      <span class="n">nsty</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-808"></a>    <span class="k">else</span>
<a name="ln-809"></a><span class="k">      </span><span class="n">sty</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
<a name="ln-810"></a>      <span class="n">nsty</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-811"></a>    <span class="k">endif</span>
<a name="ln-812"></a><span class="k">    </span><span class="n">number</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-813"></a>    <span class="n">tsty</span> <span class="o">=</span> <span class="s1">&#39;LEFT&#39;</span>
<a name="ln-814"></a>    <span class="n">tch</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
<a name="ln-815"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsty</span>
<a name="ln-816"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;NUMBER&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-817"></a><span class="k">        </span><span class="n">number</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-818"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ABOVE&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-819"></a><span class="k">        </span><span class="n">tsty</span> <span class="o">=</span> <span class="s1">&#39;PAD&#39;</span>
<a name="ln-820"></a>        <span class="n">tch</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
<a name="ln-821"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">LPUA</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-822"></a><span class="k">        </span><span class="n">tsty</span> <span class="o">=</span> <span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-823"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">2</span><span class="p">:)</span> <span class="o">==</span> <span class="n">PU</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-824"></a><span class="k">        </span><span class="n">tsty</span> <span class="o">=</span> <span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">2</span><span class="p">:)</span>
<a name="ln-825"></a>        <span class="n">tch</span> <span class="o">=</span> <span class="n">sty</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-826"></a>      <span class="k">else</span>
<a name="ln-827"></a><span class="k">        </span><span class="n">ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-828"></a>        <span class="k">return</span>
<a name="ln-829"></a><span class="k">      endif</span>
<a name="ln-830"></a><span class="k">    enddo</span>
<a name="ln-831"></a><span class="k">    </span><span class="n">ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-832"></a>  <span class="k">end subroutine </span><span class="n">getstyles</span>
<a name="ln-833"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-834"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-835"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-836"></a>  <span class="k">subroutine </span><span class="n">replace_zeronaninf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">zas</span><span class="p">,</span> <span class="n">maskz</span><span class="p">,</span> <span class="n">masknan</span><span class="p">,</span> <span class="n">maskminf</span><span class="p">,</span> <span class="n">maskinf</span><span class="p">)</span>
<a name="ln-837"></a>    <span class="c">! replace zeros in s (where maskz is true) with zas (i.e. zero-as string) also replace nans with &#39;NaN&#39;,</span>
<a name="ln-838"></a>    <span class="c">! infinities with &#39;+Inf&#39; and minus infinities with &#39;-Inf&#39;. Zeros are aligned with . if zas contains .</span>
<a name="ln-839"></a>    <span class="c">! otherwise right-adjusted. Nans, and infs are right adjusted.</span>
<a name="ln-840"></a>    <span class="c">! NOTE: There are compiler bugs in current versions of both the Absoft and the Pathscale compilers</span>
<a name="ln-841"></a>    <span class="c">! so the merge calls (commented out below) had to be replaced with do loops.</span>
<a name="ln-842"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span><span class="p">(:)</span>
<a name="ln-843"></a>    <span class="kt">logical</span>     <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">maskz</span><span class="p">(:),</span> <span class="n">masknan</span><span class="p">(:),</span> <span class="n">maskinf</span><span class="p">(:),</span> <span class="n">maskminf</span><span class="p">(:)</span>
<a name="ln-844"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">zas</span>
<a name="ln-845"></a>    <span class="k">optional</span>                    <span class="kd">::</span> <span class="n">masknan</span><span class="p">,</span> <span class="n">maskminf</span><span class="p">,</span> <span class="n">maskinf</span>
<a name="ln-846"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="n">z</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">minf</span><span class="p">,</span> <span class="n">inf</span>
<a name="ln-847"></a>    <span class="kt">integer </span><span class="n">w</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zasdot</span>
<a name="ln-848"></a>    <span class="n">w</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-849"></a>    <span class="n">wz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zas</span><span class="p">)</span>
<a name="ln-850"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">maskz</span><span class="p">)</span>
<a name="ln-851"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">wz</span> <span class="o">/=</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">wz</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="p">)</span> <span class="k">then</span> <span class="c">! zas not empty and not too wide</span>
<a name="ln-852"></a>      <span class="n">zasdot</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">zas</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a name="ln-853"></a>      <span class="n">z</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-854"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">zasdot</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-855"></a><span class="k">        do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-856"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">maskz</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">exit</span>
<a name="ln-857"></a><span class="k">        enddo</span>
<a name="ln-858"></a><span class="k">        if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">)</span> <span class="k">then</span> <span class="c">! some zeros</span>
<a name="ln-859"></a>          <span class="n">k</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a name="ln-860"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">zasdot</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">wz</span><span class="o">-</span><span class="n">zasdot</span> <span class="o">&gt;</span> <span class="n">w</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="k">then</span> <span class="c">! cannot align .&#39;s</span>
<a name="ln-861"></a>            <span class="n">z</span><span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">wz</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span> <span class="o">=</span> <span class="n">zas</span> <span class="c">! align right</span>
<a name="ln-862"></a>          <span class="k">else</span>
<a name="ln-863"></a><span class="k">            </span><span class="n">z</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">zasdot</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">-</span><span class="n">zasdot</span><span class="o">+</span><span class="n">wz</span><span class="p">)</span> <span class="o">=</span> <span class="n">zas</span>
<a name="ln-864"></a>          <span class="k">endif</span>
<a name="ln-865"></a><span class="k">        endif</span>
<a name="ln-866"></a><span class="k">      else</span>
<a name="ln-867"></a><span class="k">        </span><span class="n">z</span><span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">wz</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span> <span class="o">=</span> <span class="n">zas</span>
<a name="ln-868"></a>      <span class="k">endif</span>
<a name="ln-869"></a>      <span class="c">! s = merge(z, s, maskz)</span>
<a name="ln-870"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-871"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">maskz</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">z</span>
<a name="ln-872"></a>      <span class="k">enddo</span>
<a name="ln-873"></a><span class="k">    endif</span>
<a name="ln-874"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">masknan</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-875"></a><span class="k">      if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-876"></a><span class="k">        </span><span class="n">nan</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39; NaN&#39;</span>
<a name="ln-877"></a>        <span class="n">minf</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;-Inf&#39;</span>
<a name="ln-878"></a>        <span class="n">inf</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;+Inf&#39;</span>
<a name="ln-879"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-880"></a><span class="k">        </span><span class="n">nan</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span>
<a name="ln-881"></a>        <span class="n">minf</span> <span class="o">=</span> <span class="s1">&#39;***&#39;</span>
<a name="ln-882"></a>        <span class="n">inf</span> <span class="o">=</span> <span class="s1">&#39;Inf&#39;</span>
<a name="ln-883"></a>      <span class="k">else</span>
<a name="ln-884"></a><span class="k">        </span><span class="n">nan</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
<a name="ln-885"></a>        <span class="n">minf</span> <span class="o">=</span> <span class="n">nan</span>
<a name="ln-886"></a>        <span class="n">inf</span> <span class="o">=</span> <span class="n">nan</span>
<a name="ln-887"></a>      <span class="k">endif</span>
<a name="ln-888"></a>      <span class="c">! s = merge(nan, s, masknan)</span>
<a name="ln-889"></a>      <span class="c">! s = merge(minf, s, maskminf)</span>
<a name="ln-890"></a>      <span class="c">! s = merge(inf, s, maskinf)</span>
<a name="ln-891"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-892"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">masknan</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">nan</span>
<a name="ln-893"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">maskminf</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">minf</span>
<a name="ln-894"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">maskinf</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">inf</span>
<a name="ln-895"></a>      <span class="k">enddo</span>
<a name="ln-896"></a><span class="k">    endif</span>
<a name="ln-897"></a><span class="k">  end subroutine </span><span class="n">replace_zeronaninf</span>
<a name="ln-898"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-899"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-900"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-901"></a><span class="k">pure function </span><span class="n">upper</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">su</span><span class="p">)</span> <span class="c">! Change string to upper case</span>
<a name="ln-902"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-903"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="n">su</span>
<a name="ln-904"></a><span class="kt">character</span><span class="p">(</span><span class="mi">26</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ll</span> <span class="o">=</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">,</span> <span class="n">ul</span> <span class="o">=</span> <span class="s1">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>
<a name="ln-905"></a><span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-906"></a>   <span class="n">su</span> <span class="o">=</span> <span class="n">s</span>
<a name="ln-907"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-908"></a>      <span class="n">k</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">))</span>
<a name="ln-909"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">su</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ul</span><span class="p">(</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="p">)</span>
<a name="ln-910"></a>   <span class="k">enddo</span>
<a name="ln-911"></a><span class="k">end function </span><span class="n">upper</span>
<a name="ln-912"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-913"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-914"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-915"></a><span class="k">pure subroutine </span><span class="n">sszipfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span>
<a name="ln-916"></a><span class="c">! Set fmt1 to &#39;(SS,&#39;//removeblanks(fmt)//&#39;)&#39;. Caller is responsible that</span>
<a name="ln-917"></a><span class="c">! fmt1 has sufficient length.</span>
<a name="ln-918"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-919"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-920"></a><span class="kt">integer </span><span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-921"></a>   <span class="n">fmt1</span> <span class="o">=</span> <span class="s1">&#39;(SS,&#39;</span>
<a name="ln-922"></a>   <span class="n">j</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-923"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
<a name="ln-924"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">/=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-925"></a><span class="k">         </span><span class="n">fmt1</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-926"></a>         <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-927"></a>      <span class="k">endif</span>
<a name="ln-928"></a><span class="k">   enddo</span>
<a name="ln-929"></a><span class="k">   </span><span class="n">fmt1</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;)&#39;</span>
<a name="ln-930"></a><span class="k">end subroutine </span><span class="n">sszipfmt</span>
<a name="ln-931"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-932"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-933"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-934"></a><span class="k">pure function </span><span class="n">nnblk</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">! count nonblanks in s</span>
<a name="ln-935"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-936"></a><span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-937"></a>   <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-938"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-939"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">/=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-940"></a>   <span class="k">enddo</span>
<a name="ln-941"></a><span class="k">end function </span><span class="n">nnblk</span>
<a name="ln-942"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-943"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-944"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-945"></a><span class="k">subroutine </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-946"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-947"></a><span class="kt">integer </span><span class="n">wleft</span>
<a name="ln-948"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-949"></a>   <span class="n">wleft</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-950"></a>   <span class="k">call </span><span class="n">newbox</span><span class="p">(</span><span class="n">DEFAULT_UNIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-951"></a>   <span class="k">call </span><span class="n">copytobox</span><span class="p">([</span><span class="n">s</span><span class="p">],</span> <span class="n">lin1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">widj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">widpj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">nblj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boxp</span> <span class="o">=</span> <span class="n">boxp</span><span class="p">,</span> <span class="n">wleft</span> <span class="o">=</span> <span class="n">wleft</span><span class="p">)</span>
<a name="ln-952"></a>   <span class="k">call </span><span class="n">dispboxlist</span><span class="p">(</span><span class="n">DEFAULT_UNIT</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-953"></a><span class="k">end subroutine </span><span class="n">disp_errmsg</span>
<a name="ln-954"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-955"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-956"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-957"></a><span class="c">! **************************************************** END OF GENERAL PROCEDURES **************************************************</span>
<a name="ln-958"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-959"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-960"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-961"></a><span class="c">! ****************************************************** TOSTRING PROCEDURES ******************************************************</span>
<a name="ln-962"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-963"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-964"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-965"></a><span class="k">subroutine </span><span class="n">tostring_check_settings</span>
<a name="ln-966"></a><span class="c">! Sanity check of tostring settings</span>
<a name="ln-967"></a><span class="k">type</span><span class="p">(</span><span class="n">tostring_settings</span><span class="p">)</span> <span class="n">ts</span>
<a name="ln-968"></a><span class="kt">integer </span><span class="n">wi</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-969"></a><span class="kt">character</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">))</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="n">fmt1</span>
<a name="ln-970"></a><span class="kt">logical </span><span class="n">gedit</span>
<a name="ln-971"></a>   <span class="n">ts</span> <span class="o">=</span> <span class="n">tosset</span>
<a name="ln-972"></a>   <span class="k">if</span> <span class="p">(</span><span class="k">all</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">/=</span> <span class="p">[</span><span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;NO &#39;</span><span class="p">]))</span>           <span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">=</span> <span class="n">tosfac</span> <span class="p">%</span> <span class="n">trimb</span>
<a name="ln-973"></a>   <span class="k">if</span> <span class="p">(</span><span class="k">all</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">/=</span> <span class="p">[</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL &#39;</span><span class="p">,</span> <span class="s1">&#39;G   &#39;</span><span class="p">]))</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">=</span> <span class="n">tosfac</span> <span class="p">%</span> <span class="n">trimz</span>
<a name="ln-974"></a>   <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-975"></a>   <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-976"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">wr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span> <span class="o">=</span> <span class="n">tosfac</span> <span class="p">%</span> <span class="n">rfmt</span>
<a name="ln-977"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">wi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span> <span class="o">=</span> <span class="n">tosfac</span> <span class="p">%</span> <span class="n">ifmt</span>
<a name="ln-978"></a>   <span class="k">if</span> <span class="p">(</span><span class="k">all</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">/=</span> <span class="p">[</span><span class="s1">&#39;YES &#39;</span><span class="p">,</span> <span class="s1">&#39;NO  &#39;</span><span class="p">,</span> <span class="s1">&#39;AUTO&#39;</span><span class="p">]))</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-979"></a>        <span class="s1">&#39;TOSTRING_SET: error, illegal trimb: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">trimb</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, set to &#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">tosfac</span> <span class="p">%</span> <span class="n">trimb</span><span class="p">))</span>
<a name="ln-980"></a>   <span class="k">if</span> <span class="p">(</span><span class="k">all</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">/=</span> <span class="p">[</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL &#39;</span><span class="p">,</span> <span class="s1">&#39;G   &#39;</span><span class="p">]))</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-981"></a>        <span class="s1">&#39;TOSTRING_SET: error, illegal trimz: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">trimz</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, set to &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tosfac</span> <span class="p">%</span> <span class="n">trimz</span><span class="p">))</span>
<a name="ln-982"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">wr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-983"></a>        <span class="s1">&#39;TOSTRING_SET: error, illegal rfmt: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, set to &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tosfac</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span>
<a name="ln-984"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">wi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">disp_errmsg</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-985"></a>        <span class="s1">&#39;TOSTRING_SET: error, illegal ifmt: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">ts</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, set to &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tosfac</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">))</span>
<a name="ln-986"></a><span class="k">end subroutine </span><span class="n">tostring_check_settings</span>
<a name="ln-987"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-988"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-989"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-990"></a><span class="k">pure subroutine </span><span class="n">trim_s_real</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-991"></a><span class="c">! Trim trailing zeros and possibly decimal point from fractional part.</span>
<a name="ln-992"></a><span class="c">! If sa = &#39;52.2000E12&#39; on entry then it is returned as &#39;52.2E12   &#39;.</span>
<a name="ln-993"></a><span class="c">! Whether trimming is actually done depends on tosset, gedit and w.</span>
<a name="ln-994"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sa</span>
<a name="ln-995"></a><span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-996"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">w</span>
<a name="ln-997"></a><span class="kt">integer </span><span class="n">k</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span>
<a name="ln-998"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">sa</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<a name="ln-999"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">==</span> <span class="s1">&#39;ALL&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">gedit</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1000"></a><span class="k">      </span><span class="n">k</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a name="ln-1001"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1002"></a><span class="k">         </span><span class="n">k2</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">sa</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span>
<a name="ln-1003"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">k2</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span> <span class="n">k2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1004"></a>         <span class="n">k3</span> <span class="o">=</span> <span class="nb">verify</span><span class="p">(</span><span class="n">sa</span><span class="p">(</span><span class="n">k</span><span class="p">:</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;0.&#39;</span><span class="p">,</span> <span class="n">back</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1005"></a>         <span class="n">sa</span><span class="p">(</span><span class="n">k3</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span> <span class="o">=</span> <span class="n">sa</span><span class="p">(</span><span class="n">k2</span><span class="p">:)</span>
<a name="ln-1006"></a>      <span class="k">endif</span>
<a name="ln-1007"></a><span class="k">   endif</span>
<a name="ln-1008"></a><span class="k">end subroutine </span><span class="n">trim_s_real</span>
<a name="ln-1009"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1010"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1011"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1012"></a><span class="k">pure subroutine </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-1013"></a><span class="c">! Trim trailing zeros and possibly decimal point from fractional part.</span>
<a name="ln-1014"></a><span class="c">! If sa = &#39;52.2000E12&#39; on entry then it is returned as &#39;52.2E12   &#39;.</span>
<a name="ln-1015"></a><span class="c">! Whether trimming is actually done depends on tosset, gedit and w.</span>
<a name="ln-1016"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(:)</span>
<a name="ln-1017"></a><span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-1018"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">w</span>
<a name="ln-1019"></a><span class="kt">integer </span><span class="n">i</span>
<a name="ln-1020"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">sa</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<a name="ln-1021"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">==</span> <span class="s1">&#39;ALL&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">trimz</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">gedit</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1022"></a><span class="k">      do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span> <span class="c">! trim trailing zeros from fractional part</span>
<a name="ln-1023"></a>         <span class="k">call </span><span class="n">trim_s_real</span><span class="p">(</span><span class="n">sa</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-1024"></a>      <span class="k">enddo</span>
<a name="ln-1025"></a><span class="k">   endif</span>
<a name="ln-1026"></a><span class="k">end subroutine </span><span class="n">trim_real</span>
<a name="ln-1027"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1028"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1029"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1030"></a><span class="k">pure subroutine </span><span class="n">tostring_get</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-1031"></a><span class="c">! Copy trimmed elements of sa (containing individual elements as strings) to the final</span>
<a name="ln-1032"></a><span class="c">! tostring result st, separated by tosset % sep strings.</span>
<a name="ln-1033"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">sa</span><span class="p">(:)</span>
<a name="ln-1034"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-1035"></a><span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">sepl</span>
<a name="ln-1036"></a>    <span class="n">sepl</span> <span class="o">=</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span>
<a name="ln-1037"></a>    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1038"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<a name="ln-1039"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">sepl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">sepl</span><span class="p">)</span>
<a name="ln-1040"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">sepl</span>
<a name="ln-1041"></a>      <span class="n">n</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">sa</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1042"></a>      <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sa</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1043"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span>
<a name="ln-1044"></a>    <span class="k">enddo</span>
<a name="ln-1045"></a><span class="k">end subroutine </span><span class="n">tostring_get</span>
<a name="ln-1046"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1047"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1048"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1049"></a><span class="k">pure subroutine </span><span class="n">tostring_get_complex</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">sgn</span><span class="p">,</span> <span class="n">sai</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-1050"></a><span class="c">! Version of tostring_get for complex numbers</span>
<a name="ln-1051"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">sar</span><span class="p">(:),</span> <span class="n">sai</span><span class="p">(:),</span> <span class="n">sgn</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1052"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-1053"></a><span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">sepl</span>
<a name="ln-1054"></a>    <span class="n">sepl</span> <span class="o">=</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span>
<a name="ln-1055"></a>    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1056"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">sar</span><span class="p">)</span>
<a name="ln-1057"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">sepl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">sepl</span><span class="p">)</span>
<a name="ln-1058"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">sepl</span>
<a name="ln-1059"></a>      <span class="n">n</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">sar</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1060"></a>      <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sar</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1061"></a>      <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">//</span><span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; &#39;</span>
<a name="ln-1062"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">3</span>
<a name="ln-1063"></a>      <span class="n">n</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">sai</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1064"></a>      <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sai</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1065"></a>      <span class="n">st</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>
<a name="ln-1066"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1067"></a>    <span class="k">enddo</span>
<a name="ln-1068"></a><span class="k">end subroutine </span><span class="n">tostring_get_complex</span>
<a name="ln-1069"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1070"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1071"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1072"></a>
<a name="ln-1073"></a>  <span class="c">! ********************************* END OF TOSTRING PROCEDURES *********************************</span>
<a name="ln-1074"></a>
<a name="ln-1075"></a>  <span class="c">! *********************************** BOX-PACKAGE **********************************************</span>
<a name="ln-1076"></a>  <span class="c">!</span>
<a name="ln-1077"></a>  <span class="c">! A &quot;box&quot; is a variable dimension character matrix that can be created dynamically. There are</span>
<a name="ln-1078"></a>  <span class="c">! linked lists of boxes, one for each logical unit. When disp is called the item to be displayed</span>
<a name="ln-1079"></a>  <span class="c">! is written to a box. If advance = &#39;no&#39; is in effect, the writing out of the items is delayed</span>
<a name="ln-1080"></a>  <span class="c">! until disp is called on the same unit with advance = &#39;yes&#39; in effect; then all the boxes in</span>
<a name="ln-1081"></a>  <span class="c">! the relevant list are written to the unit. There are two subroutines that are meant to be</span>
<a name="ln-1082"></a>  <span class="c">! called from outside the Box-package: NEWBOX and DISPBOXLIST:</span>
<a name="ln-1083"></a>  <span class="c">!</span>
<a name="ln-1084"></a>  <span class="c">! CALL NEWBOX(UNIT, M, N, BOXP) creates a box on unit UNIT. BOXP returns a pointer to the</span>
<a name="ln-1085"></a>  <span class="c">! created box which is of type CHARACTER and DIMENSION (M,N).</span>
<a name="ln-1086"></a>  <span class="c">!</span>
<a name="ln-1087"></a>  <span class="c">! CALL DISPBOXLIST(UNIT, SEP) writes all the boxes in the list associated with UNIT to the file</span>
<a name="ln-1088"></a>  <span class="c">! on UNIT, separated with the string SEP. The following example makes this clear: let SEP = &#39; : &#39;</span>
<a name="ln-1089"></a>  <span class="c">! and let the first box contain XXX and the second have two rows, both equal to YYYY. Then the</span>
<a name="ln-1090"></a>  <span class="c">! text written will be: XXX : YYYY : YYYY</span>
<a name="ln-1091"></a>  <span class="c">!</span>
<a name="ln-1092"></a>  <span class="c">! To obtain tab-separated boxes when using ASCII, let SEP = char(9). After writing the boxes,</span>
<a name="ln-1093"></a>  <span class="c">! the complete list is deallocated. If UNIT = -3 the asterisk unit (usually command window) is</span>
<a name="ln-1094"></a>  <span class="c">! written to. If UNIT = -2 the routine putstr from the disp_where unit is used for writing. If</span>
<a name="ln-1095"></a>  <span class="c">! UNIT = -1 all output will be discarded. With the iso_fortran_env module of Fortran 2003, unit</span>
<a name="ln-1096"></a>  <span class="c">! may also equal OUTPUT_UNIT, unless the compiler sets that to -2.</span>
<a name="ln-1097"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1098"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1099"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1100"></a><span class="k">function </span><span class="n">getboxlist</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-1101"></a><span class="c">! Return boxlist associated with specified unit. If this list does not exist a new list is started.</span>
<a name="ln-1102"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-1103"></a><span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-1104"></a>   <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">firstboxlist</span>
<a name="ln-1105"></a>   <span class="k">do while</span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a name="ln-1106"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">unit</span> <span class="o">==</span> <span class="n">unit</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-1107"></a><span class="k">     </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">%</span> <span class="n">nextboxlist</span>
<a name="ln-1108"></a>   <span class="k">enddo</span>
<a name="ln-1109"></a><span class="k">   allocate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-1110"></a>   <span class="n">p</span> <span class="p">%</span> <span class="n">nextboxlist</span> <span class="o">=&gt;</span> <span class="n">firstboxlist</span>  <span class="c">! put at head of list</span>
<a name="ln-1111"></a>   <span class="n">p</span> <span class="p">%</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
<a name="ln-1112"></a>   <span class="n">firstboxlist</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-1113"></a><span class="k">end function </span><span class="n">getboxlist</span>
<a name="ln-1114"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1115"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1116"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1117"></a><span class="k">subroutine </span><span class="n">clearboxlist</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1118"></a><span class="c">! Deallocate all boxes associated with unit</span>
<a name="ln-1119"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-1120"></a><span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span>
<a name="ln-1121"></a><span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">blp</span>
<a name="ln-1122"></a>    <span class="n">blp</span> <span class="o">=&gt;</span> <span class="n">firstboxlist</span>
<a name="ln-1123"></a>    <span class="k">do while</span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">blp</span><span class="p">))</span>
<a name="ln-1124"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">blp</span> <span class="p">%</span> <span class="n">unit</span> <span class="o">==</span> <span class="n">unit</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-1125"></a><span class="k">      </span><span class="n">blp</span> <span class="o">=&gt;</span> <span class="n">blp</span> <span class="p">%</span> <span class="n">nextboxlist</span>
<a name="ln-1126"></a>    <span class="k">enddo</span>
<a name="ln-1127"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">blp</span><span class="p">))</span> <span class="k">return</span>
<a name="ln-1128"></a><span class="k">    </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">blp</span> <span class="p">%</span> <span class="n">firstbox</span>
<a name="ln-1129"></a>    <span class="k">do while</span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a name="ln-1130"></a>      <span class="n">q</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-1131"></a>      <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">%</span> <span class="n">nextbox</span>
<a name="ln-1132"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">q</span> <span class="p">%</span> <span class="n">box</span><span class="p">)</span>
<a name="ln-1133"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a name="ln-1134"></a>    <span class="k">enddo</span>
<a name="ln-1135"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">firstboxlist</span><span class="p">,</span> <span class="n">blp</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1136"></a><span class="k">      </span><span class="n">firstboxlist</span> <span class="o">=&gt;</span> <span class="n">blp</span> <span class="p">%</span> <span class="n">nextboxlist</span>
<a name="ln-1137"></a>    <span class="k">endif</span>
<a name="ln-1138"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">blp</span><span class="p">)</span>
<a name="ln-1139"></a><span class="k">end subroutine </span><span class="n">clearboxlist</span>
<a name="ln-1140"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1141"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1142"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1143"></a><span class="k">subroutine </span><span class="n">newbox</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-1144"></a><span class="c">! Create a new box</span>
<a name="ln-1145"></a><span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-1146"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-1147"></a><span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-1148"></a><span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">blp</span>
<a name="ln-1149"></a>   <span class="k">allocate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-1150"></a>   <span class="k">allocate</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
<a name="ln-1151"></a>   <span class="n">blp</span> <span class="o">=&gt;</span> <span class="n">getboxlist</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1152"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">associated</span><span class="p">(</span><span class="n">blp</span> <span class="p">%</span> <span class="n">firstbox</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1153"></a><span class="k">     </span><span class="n">blp</span> <span class="p">%</span> <span class="n">firstbox</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-1154"></a>   <span class="k">else</span>
<a name="ln-1155"></a><span class="k">     </span><span class="n">blp</span> <span class="p">%</span> <span class="n">lastbox</span> <span class="p">%</span> <span class="n">nextbox</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-1156"></a>   <span class="k">endif</span>
<a name="ln-1157"></a><span class="k">   </span><span class="n">blp</span> <span class="p">%</span> <span class="n">lastbox</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-1158"></a>   <span class="n">boxp</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">%</span> <span class="n">box</span>
<a name="ln-1159"></a>   <span class="n">boxp</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
<a name="ln-1160"></a><span class="k">end subroutine </span><span class="n">newbox</span>
<a name="ln-1161"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1162"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1163"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1164"></a><span class="k">function </span><span class="n">tostr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-1165"></a><span class="c">! Copy char array to string</span>
<a name="ln-1166"></a><span class="kt">character</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">(:)</span>
<a name="ln-1167"></a><span class="kt">character</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="n">s</span>
<a name="ln-1168"></a><span class="kt">integer </span><span class="n">i</span>
<a name="ln-1169"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-1170"></a>     <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1171"></a>   <span class="k">enddo</span>
<a name="ln-1172"></a><span class="k"> end function </span><span class="n">tostr</span>
<a name="ln-1173"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1174"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1175"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1176"></a><span class="k">subroutine </span><span class="n">dispboxlist</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
<a name="ln-1177"></a>   <span class="c">! Display the list of boxes associated with unit</span>
<a name="ln-1178"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-1179"></a>   <span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">pfirst</span><span class="p">,</span> <span class="n">p</span>
<a name="ln-1180"></a>   <span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">blp</span>
<a name="ln-1181"></a>   <span class="kt">integer </span><span class="n">k</span><span class="p">,</span> <span class="n">nlines</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ns</span>
<a name="ln-1182"></a>   <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sep</span>
<a name="ln-1183"></a>   <span class="n">blp</span> <span class="o">=&gt;</span> <span class="n">getboxlist</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1184"></a>   <span class="n">pfirst</span> <span class="o">=&gt;</span> <span class="n">blp</span> <span class="p">%</span> <span class="n">firstbox</span>
<a name="ln-1185"></a>   <span class="n">nlines</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1186"></a>   <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">pfirst</span>
<a name="ln-1187"></a>   <span class="k">do while</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a name="ln-1188"></a>     <span class="n">nlines</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nlines</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a name="ln-1189"></a>     <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">%</span> <span class="n">nextbox</span>
<a name="ln-1190"></a>   <span class="k">enddo</span>
<a name="ln-1191"></a><span class="k">   do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlines</span>
<a name="ln-1192"></a>     <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">pfirst</span>
<a name="ln-1193"></a>     <span class="n">ns</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1194"></a>     <span class="k">do while</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a name="ln-1195"></a>       <span class="n">h</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-1196"></a>       <span class="n">w</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1197"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">h</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1198"></a><span class="k">         select case</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1199"></a>         <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1200"></a>           <span class="k">continue</span>
<a name="ln-1201"></a><span class="k">         case</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1202"></a>           <span class="k">call </span><span class="n">putstr</span><span class="p">(</span><span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">)</span> <span class="o">//</span> <span class="n">tostr</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">(:,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1203"></a>         <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1204"></a>           <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span>    <span class="s1">&#39;(2A)&#39;</span><span class="p">,</span> <span class="n">advance</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">),</span> <span class="n">tostr</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">(:,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1205"></a>         <span class="k">case </span><span class="n">default</span>
<a name="ln-1206"></a>           <span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="s1">&#39;(2A)&#39;</span><span class="p">,</span> <span class="n">advance</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">),</span> <span class="n">tostr</span><span class="p">(</span><span class="n">p</span> <span class="p">%</span> <span class="n">box</span><span class="p">(:,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1207"></a>         <span class="k">end select</span>
<a name="ln-1208"></a><span class="k">       else</span>
<a name="ln-1209"></a><span class="k">         select case</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1210"></a>         <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1211"></a>           <span class="k">continue</span>
<a name="ln-1212"></a><span class="k">         case</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1213"></a>           <span class="k">call </span><span class="n">putstr</span><span class="p">(</span><span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">)</span> <span class="o">//</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
<a name="ln-1214"></a>         <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1215"></a>           <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span>    <span class="s1">&#39;(2A)&#39;</span><span class="p">,</span> <span class="n">advance</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">),</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-1216"></a>         <span class="k">case </span><span class="n">default</span>
<a name="ln-1217"></a>           <span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="s1">&#39;(2A)&#39;</span><span class="p">,</span> <span class="n">advance</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">),</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-1218"></a>         <span class="k">end select</span>
<a name="ln-1219"></a><span class="k">       endif</span>
<a name="ln-1220"></a><span class="k">       </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">%</span> <span class="n">nextbox</span>
<a name="ln-1221"></a>       <span class="n">ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<a name="ln-1222"></a>     <span class="k">enddo</span>
<a name="ln-1223"></a><span class="k">     call </span><span class="n">dispnewline</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1224"></a>   <span class="k">enddo</span>
<a name="ln-1225"></a><span class="k">   call </span><span class="n">clearboxlist</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1226"></a><span class="k">end subroutine </span><span class="n">dispboxlist</span>
<a name="ln-1227"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1228"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1229"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1230"></a><span class="k">subroutine </span><span class="n">dispnewline</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1231"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-1232"></a>   <span class="k">select case</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-1233"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="k">continue</span>
<a name="ln-1234"></a><span class="k">   case</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="k">call </span><span class="n">putnl</span>
<a name="ln-1235"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span> <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1236"></a>   <span class="k">case </span><span class="n">default</span><span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1237"></a>   <span class="k">end select</span>
<a name="ln-1238"></a><span class="k">end subroutine </span><span class="n">dispnewline</span>
<a name="ln-1239"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1240"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1241"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1242"></a>  <span class="c">!   subroutine print_boxes</span>
<a name="ln-1243"></a>  <span class="c">!     ! Print info on all boxes (used for debug purposes)</span>
<a name="ln-1244"></a>  <span class="c">!     integer :: k</span>
<a name="ln-1245"></a>  <span class="c">!     type(boxlist), pointer :: bl</span>
<a name="ln-1246"></a>  <span class="c">!     type(boxnode), pointer :: p</span>
<a name="ln-1247"></a>  <span class="c">!     bl =&gt; firstboxlist</span>
<a name="ln-1248"></a>  <span class="c">!     write(*,&#39;(&quot;BOXES:&quot;)&#39;)</span>
<a name="ln-1249"></a>  <span class="c">!     do while (associated(bl))</span>
<a name="ln-1250"></a>  <span class="c">!       write(*,&#39;(&quot;UNIT=&quot;,SS,I0,&quot;:&quot;)&#39;) bl % unit</span>
<a name="ln-1251"></a>  <span class="c">!       p =&gt; bl % firstbox</span>
<a name="ln-1252"></a>  <span class="c">!       k = 1</span>
<a name="ln-1253"></a>  <span class="c">!       do while(associated(p))</span>
<a name="ln-1254"></a>  <span class="c">!         write(*,&#39;(&quot;  box &quot;,SS,I0,&quot;, size=(&quot;,I0,&quot;,&quot;,I0,&quot;)&quot;)&#39;) k, shape(p % box)</span>
<a name="ln-1255"></a>  <span class="c">!         k = k+1</span>
<a name="ln-1256"></a>  <span class="c">!         p =&gt; p % nextbox</span>
<a name="ln-1257"></a>  <span class="c">!       enddo</span>
<a name="ln-1258"></a>  <span class="c">!       bl =&gt; bl % nextboxlist</span>
<a name="ln-1259"></a>  <span class="c">!     enddo</span>
<a name="ln-1260"></a>  <span class="c">!   end subroutine print_boxes</span>
<a name="ln-1261"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1262"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1263"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1264"></a>
<a name="ln-1265"></a>  <span class="c">! ******************************** END OF BOX-PACKAGE *******************************</span>
<a name="ln-1266"></a>
<a name="ln-1267"></a><span class="k">END MODULE </span><span class="n">M_display_UTIL</span>
<a name="ln-1268"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1269"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1270"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1271"></a><span class="k">MODULE </span><span class="n">M_display</span>
<a name="ln-1272"></a>  <span class="k">use </span><span class="n">M_display_util</span>
<a name="ln-1273"></a>  <span class="k">implicit none</span>
<a name="ln-1274"></a><span class="k">  private</span>  <span class="c">! everything not explicitly declared public will be private (including entities from m_display_util)</span>
<a name="ln-1275"></a>
<a name="ln-1276"></a>  <span class="c">! ********************************** PUBLIC DECLARATIONS *************************************</span>
<a name="ln-1277"></a>
<a name="ln-1278"></a>  <span class="k">PUBLIC </span><span class="n">DISP</span>                 <span class="c">! Main routine of package, &quot;pretty-prints&quot; vectors and matrices</span>
<a name="ln-1279"></a>  <span class="k">PUBLIC </span><span class="n">DISP_SET</span>             <span class="c">! Subroutine to change default settings for DISP</span>
<a name="ln-1280"></a>  <span class="k">PUBLIC </span><span class="n">DISP_GET</span>             <span class="c">! Obtain current default settings</span>
<a name="ln-1281"></a>  <span class="k">PUBLIC </span><span class="n">DISP_SET_FACTORY</span>     <span class="c">! Call (without parameters) to restore original default settings</span>
<a name="ln-1282"></a>  <span class="k">PUBLIC </span><span class="n">TOSTRING</span>             <span class="c">! Convert numbers to strings</span>
<a name="ln-1283"></a>  <span class="k">PUBLIC </span><span class="n">TOSTRING_SET</span>         <span class="c">! Change settings for tostring</span>
<a name="ln-1284"></a>  <span class="k">PUBLIC </span><span class="n">TOSTRING_SET_FACTORY</span> <span class="c">! Restore original default settings for tostring</span>
<a name="ln-1285"></a>  <span class="c">!</span>
<a name="ln-1286"></a>  <span class="k">PUBLIC </span><span class="n">DISP_SETTINGS</span>        <span class="c">! Derived type with settings</span>
<a name="ln-1287"></a>  <span class="c">!</span>
<a name="ln-1288"></a>  <span class="k">PUBLIC </span><span class="n">ASTERISK_UNIT</span>        <span class="c">! Constant to specify displaying on asterisk unit (normally the screen)</span>
<a name="ln-1289"></a>  <span class="k">PUBLIC </span><span class="n">PUTSTR_UNIT</span>          <span class="c">! Constant to specify the use of subroutines putstr and putnl to display</span>
<a name="ln-1290"></a>  <span class="k">PUBLIC </span><span class="n">NULL_UNIT</span>            <span class="c">! Constant to specify discarding of all displayed output</span>
<a name="ln-1291"></a>
<a name="ln-1292"></a>  <span class="k">public </span><span class="n">test_suite_M_display</span>
<a name="ln-1293"></a>
<a name="ln-1294"></a>  <span class="c">! ********************************** INTERFACE DECLARATIONS *************************************</span>
<a name="ln-1295"></a>  <span class="k">interface </span><span class="n">disp_set</span>
<a name="ln-1296"></a>    <span class="k">module procedure </span><span class="n">disp_set</span><span class="p">,</span> <span class="n">disp_set_ds</span>
<a name="ln-1297"></a>  <span class="k">end interface</span>
<a name="ln-1298"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1299"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1300"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1301"></a><span class="c">!&gt;</span>
<a name="ln-1302"></a><span class="c">!!##NAME</span>
<a name="ln-1303"></a><span class="c">!!       disp(3f) - [M_display] pretty-print a matrix</span>
<a name="ln-1304"></a><span class="c">!!</span>
<a name="ln-1305"></a><span class="c">!!##DESCRIPTION</span>
<a name="ln-1306"></a><span class="c">!!</span>
<a name="ln-1307"></a><span class="c">!! This is the principal subroutine of the package. It has various control arguments that specify the</span>
<a name="ln-1308"></a><span class="c">!! exact format of the output. Most of these may also be used as arguments of the subroutine</span>
<a name="ln-1309"></a><span class="c">!! DISP_SET. When used with DISP, a control argument affects only the item being displayed with the</span>
<a name="ln-1310"></a><span class="c">!! current call, but when used with DISP_SET, the default settings for subsequent DISP calls are</span>
<a name="ln-1311"></a><span class="c">!! affected. The default values for individual arguments given below are used unless they have been</span>
<a name="ln-1312"></a><span class="c">!! changed by a call to DISP_SET. All character arguments should be of type default character.</span>
<a name="ln-1313"></a><span class="c">!!</span>
<a name="ln-1314"></a><span class="c">!! Simple Calls:</span>
<a name="ln-1315"></a><span class="c">!!</span>
<a name="ln-1316"></a><span class="c">!!       call disp</span>
<a name="ln-1317"></a><span class="c">!!       call disp(x)</span>
<a name="ln-1318"></a><span class="c">!!       call disp(title, x)</span>
<a name="ln-1319"></a><span class="c">!!       call disp(x, fmt)</span>
<a name="ln-1320"></a><span class="c">!!       call disp(title, x, fmt)</span>
<a name="ln-1321"></a><span class="c">!!</span>
<a name="ln-1322"></a><span class="c">!! The first call advances to the next line, and the other calls display X on the default unit (the</span>
<a name="ln-1323"></a><span class="c">!! unit may be changed with the UNIT argument). The default putstrmodule (see section 2) sets the</span>
<a name="ln-1324"></a><span class="c">!! asterisk unit (usually the screen) to be default. The purpose of individual arguments is as</span>
<a name="ln-1325"></a><span class="c">!! follows:</span>
<a name="ln-1326"></a><span class="c">!!</span>
<a name="ln-1327"></a><span class="c">!! X      The item to be displayed. X may be scalar, vector or matrix (i.e. of rank &lt;= 2) and the</span>
<a name="ln-1328"></a><span class="c">!!        following kinds of data are supported:</span>
<a name="ln-1329"></a><span class="c">!!</span>
<a name="ln-1330"></a><span class="c">!!           default integer</span>
<a name="ln-1331"></a><span class="c">!!           default real (or single precision, real(kind(1.0)))</span>
<a name="ln-1332"></a><span class="c">!!           double precision real (or real(kind(1d0)))</span>
<a name="ln-1333"></a><span class="c">!!           default complex (or complex(kind(1.0)))</span>
<a name="ln-1334"></a><span class="c">!!           double precision complex (or complex(kind(1d0)))</span>
<a name="ln-1335"></a><span class="c">!!           default logical</span>
<a name="ln-1336"></a><span class="c">!!           default character</span>
<a name="ln-1337"></a><span class="c">!!</span>
<a name="ln-1338"></a><span class="c">!!        With the add-on modules described in section 2.3 other kinds may be displayed. Matrices are</span>
<a name="ln-1339"></a><span class="c">!!        displayed in traditional mathematical order, so the rows displayed are X(1,:), X(2,:) etc.</span>
<a name="ln-1340"></a><span class="c">!!        Vectors are by default displayed as column vectors (but a row orientation may be specified</span>
<a name="ln-1341"></a><span class="c">!!        with the ORIENT argument). An SS edit descriptor is applied automatically so positive</span>
<a name="ln-1342"></a><span class="c">!!        elements are not prefixed with a + sign (the Fortran standard makes outputting a + sign</span>
<a name="ln-1343"></a><span class="c">!!        optional).</span>
<a name="ln-1344"></a><span class="c">!!</span>
<a name="ln-1345"></a><span class="c">!! TITLE  Provides a label for X. The label prefixes X by default but this may be changed with the</span>
<a name="ln-1346"></a><span class="c">!!        STYLE argument (see examples in section 3.2). When X is absent TITLE must also be absent.</span>
<a name="ln-1347"></a><span class="c">!!</span>
<a name="ln-1348"></a><span class="c">!! FMT    When present, FMT should contain an edit descriptor that will be used to format each</span>
<a name="ln-1349"></a><span class="c">!!        element of X (or the real parts of X in case X is complex and FMT_IMAG is present; see</span>
<a name="ln-1350"></a><span class="c">!!        below). The possible edit descriptors are:</span>
<a name="ln-1351"></a><span class="c">!!</span>
<a name="ln-1352"></a><span class="c">!!           Fw.d, Dw.d, Ew.dEe, ENw.dEe, ESw.dEe: real data (the Ee suffixes are optional)</span>
<a name="ln-1353"></a><span class="c">!!           Iw, Bw, Ow, Zw: integer data (all may be suffixed with .m)</span>
<a name="ln-1354"></a><span class="c">!!           Lw: logical data</span>
<a name="ln-1355"></a><span class="c">!!           A, Aw: character data</span>
<a name="ln-1356"></a><span class="c">!!           Gw.d, Gw.dEe: any data</span>
<a name="ln-1357"></a><span class="c">!!</span>
<a name="ln-1358"></a><span class="c">!!        Example calls for numeric X are CALL DISP(X,&#39;ES11.4&#39;) and CALL DISP(&#39;X=&#39;,X,&#39;F8.4&#39;). If X is</span>
<a name="ln-1359"></a><span class="c">!!        a scalar string (i.e. of rank 0) and TITLE is absent FMT must be specified with a keyword</span>
<a name="ln-1360"></a><span class="c">!!        (otherwise the call is taken to have TITLE and X): CALL DISP(&#39;str&#39;,FMT=&#39;A4&#39;) displays</span>
<a name="ln-1361"></a><span class="c">!!        &quot;str&quot; but CALL DISP(&#39;str&#39;,&#39;A4&#39;) displays &quot;strA4&quot;).</span>
<a name="ln-1362"></a><span class="c">!!</span>
<a name="ln-1363"></a><span class="c">!!        If FMT is absent, each element of X is formatted with a default edit descriptor. When X is</span>
<a name="ln-1364"></a><span class="c">!!        of type logical the default is L1 and when it is of type character the default is A (which</span>
<a name="ln-1365"></a><span class="c">!!        is equivalent to Aw where w = LEN(X)). For integer data the default is Iw where w is</span>
<a name="ln-1366"></a><span class="c">!!        exactly big enough to accommodate both the largest positive and the largest negative values</span>
<a name="ln-1367"></a><span class="c">!!        in X. For real and complex data the default also depends on the largest absolute values in</span>
<a name="ln-1368"></a><span class="c">!!        X, as detailed in the DIGMAX-paragraph in section 3.2. The format used for complex numbers</span>
<a name="ln-1369"></a><span class="c">!!        is demonstrated in the introduction above.</span>
<a name="ln-1370"></a><span class="c">!!</span>
<a name="ln-1371"></a><span class="c">!!</span>
<a name="ln-1372"></a><span class="c">!!##CALL WITH COMPLETE LIST OF ARGUMENTS</span>
<a name="ln-1373"></a><span class="c">!!</span>
<a name="ln-1374"></a><span class="c">!!       CALL DISP(TITLE, X, FMT, FMT_IMAG, ADVANCE, DIGMAX, LBOUND, ORIENT,</span>
<a name="ln-1375"></a><span class="c">!!       SEP, STYLE, TRIM, UNIT, ZEROAS)</span>
<a name="ln-1376"></a><span class="c">!!</span>
<a name="ln-1377"></a><span class="c">!! All dummy arguments are optional and some of them are incompatible with some data types of X.</span>
<a name="ln-1378"></a><span class="c">!! The arguments control how X is displayed, as described in section 3.1 and below. For the character</span>
<a name="ln-1379"></a><span class="c">!! arguments ADVANCE and ORIENT the case of letters is ignored (so e.g. ADVANCE = &#39;yes&#39; and ADVANCE =</span>
<a name="ln-1380"></a><span class="c">!! &#39;YES&#39; are equivalent). Normally argument association for arguments after FMT (or FMT_IMAG) will be</span>
<a name="ln-1381"></a><span class="c">!! realized with argument keywords, e.g. CALL DISP(&#39;X=&#39;, X, DIGMAX=3, ORIENT=&#39;ROW&#39;). When X is a</span>
<a name="ln-1382"></a><span class="c">!! scalar string FMT must also be associated with keyword, as mentioned in section 3.1. The most</span>
<a name="ln-1383"></a><span class="c">!! useful application of calling DISP with X absent is to advance to the next line or display an</span>
<a name="ln-1384"></a><span class="c">!! empty line. For this purpose, the only relevant arguments are UNIT, and ADVANCE with the value</span>
<a name="ln-1385"></a><span class="c">!! &#39;YES&#39; or &#39;DOUBLE&#39;.</span>
<a name="ln-1386"></a><span class="c">!!</span>
<a name="ln-1387"></a><span class="c">!! FMT_IMAG = edit-descriptor-imag  An edit descriptor for imaginary parts of complex X. The</span>
<a name="ln-1388"></a><span class="c">!!        statement CALL DISP((1.31,2.47),&#39;F0.1&#39;,&#39;F0.2&#39;) will display &quot;1.3 + 2.47i&quot;. If FMT_IMAG</span>
<a name="ln-1389"></a><span class="c">!!        is absent and FMT is present then both real and imaginary parts are edited with FMT. If</span>
<a name="ln-1390"></a><span class="c">!!        both are absent, separate defaults are used, as explained in the DIGMAX-paragraph below.</span>
<a name="ln-1391"></a><span class="c">!!        FMT_IMAG must be absent if X is not complex.</span>
<a name="ln-1392"></a><span class="c">!!</span>
<a name="ln-1393"></a><span class="c">!! ADVANCE = adv  The value for ADVANCE may be &#39;yes&#39;, &#39;no&#39; or &#39;double&#39;. If the value is &#39;yes&#39; then X</span>
<a name="ln-1394"></a><span class="c">!!       is written out immediately, if it is &#39;double&#39; then X is written out followed by an empty</span>
<a name="ln-1395"></a><span class="c">!!       line (thus giving double spacing), and if it is &#39;no&#39; then X is not written out until the</span>
<a name="ln-1396"></a><span class="c">!!       next DISP call on the same unit with advancing turned on (either by default, via a call to</span>
<a name="ln-1397"></a><span class="c">!!       DISP_SET, or via the ADVANCE keyword). When this occurs, all the items displayed with DISP</span>
<a name="ln-1398"></a><span class="c">!!       since the last output occurred on the unit are written out side by side, separated by three</span>
<a name="ln-1399"></a><span class="c">!!       spaces unless a different separation has been specified via the MATSEP argument of DISP_SET.</span>
<a name="ln-1400"></a><span class="c">!!       Default value of ADVANCE is &#39;yes&#39;.</span>
<a name="ln-1401"></a><span class="c">!!</span>
<a name="ln-1402"></a><span class="c">!! DIGMAX = n  Controls the format used for real and complex data in the absence of FMT. For real</span>
<a name="ln-1403"></a><span class="c">!!       items the format is chosen so that the displayed number of largest absolute magnitude (say</span>
<a name="ln-1404"></a><span class="c">!!       xmax) has n significant decimal digits. If 0.1 &lt;= |xmax| &lt; 10**n an F edit descriptor is</span>
<a name="ln-1405"></a><span class="c">!!       used, otherwise an E edit descriptor. For complex items these rules are applied separately</span>
<a name="ln-1406"></a><span class="c">!!       to the real parts and imaginary parts, and thus two different formats are used. When X is</span>
<a name="ln-1407"></a><span class="c">!!       not of real or complex type the argument DIGMAX is ignored. When DIGMAX is present FMT</span>
<a name="ln-1408"></a><span class="c">!!       should be absent. The default is n = 6.</span>
<a name="ln-1409"></a><span class="c">!!</span>
<a name="ln-1410"></a><span class="c">!! LBOUND = lbound  This argument is a default integer vector with the numbers of the first row</span>
<a name="ln-1411"></a><span class="c">!!       / column to show when displaying with numbered style. When calling subroutines in Fortran,</span>
<a name="ln-1412"></a><span class="c">!!       only the shape of matrix arguments is passed with the arguments, but matrix lower bounds are</span>
<a name="ln-1413"></a><span class="c">!!       assumed to be 1 unless declared explicitly in the routine. To compensate for this deficiency</span>
<a name="ln-1414"></a><span class="c">!!       LBOUND may be set to the declared lower bound(s) of X. To take an example, let</span>
<a name="ln-1415"></a><span class="c">!!       aij = exp(i + j - 1) as in section 1, but let A be declared with REAL::A(0:3,0:3). Then</span>
<a name="ln-1416"></a><span class="c">!!       CALL DISP(A, STYLE = &#39;NUMBER&#39;, LBOUND = LBOUND(A)) will display:</span>
<a name="ln-1417"></a><span class="c">!!</span>
<a name="ln-1418"></a><span class="c">!!         &gt;        0       1        2        3</span>
<a name="ln-1419"></a><span class="c">!!         &gt;  0   1.000   2.718    7.389   20.086</span>
<a name="ln-1420"></a><span class="c">!!         &gt;  1   2.718   7.389   20.086   54.598</span>
<a name="ln-1421"></a><span class="c">!!         &gt;  2   7.389  20.086   54.598  148.413</span>
<a name="ln-1422"></a><span class="c">!!         &gt;  3  20.086  54.598  148.413  403.429.</span>
<a name="ln-1423"></a><span class="c">!!</span>
<a name="ln-1424"></a><span class="c">!!       In fact the call may be shortened to CALL DISP(A, LBOUND = LBOUND(A)) because numbering is</span>
<a name="ln-1425"></a><span class="c">!!       default when LBOUND is present.</span>
<a name="ln-1426"></a><span class="c">!!</span>
<a name="ln-1427"></a><span class="c">!! ORIENT = ori  This argument can only be used when X is a vector (i.e. has rank 1). If ORIENT is</span>
<a name="ln-1428"></a><span class="c">!!       &#39;col&#39; (the default) a column vector is displayed, and if ORIENT is &#39;row&#39; a row vector</span>
<a name="ln-1429"></a><span class="c">!!       results.</span>
<a name="ln-1430"></a><span class="c">!!</span>
<a name="ln-1431"></a><span class="c">!! SEP = sep  Specifies a string which is written out between columns of displayed matrices. If X has</span>
<a name="ln-1432"></a><span class="c">!!       rows (-1, 3) and (5, 10) and SEP is &#39;, &#39; then the output will be:</span>
<a name="ln-1433"></a><span class="c">!!</span>
<a name="ln-1434"></a><span class="c">!!         &gt;  -1,  5</span>
<a name="ln-1435"></a><span class="c">!!         &gt;   5, 10</span>
<a name="ln-1436"></a><span class="c">!!</span>
<a name="ln-1437"></a><span class="c">!!       The length of the string must be at most 9. Default is &#39;  &#39; (character string with two</span>
<a name="ln-1438"></a><span class="c">!!       spaces).</span>
<a name="ln-1439"></a><span class="c">!!</span>
<a name="ln-1440"></a><span class="c">!! STYLE = style  There are five possible styles:</span>
<a name="ln-1441"></a><span class="c">!!</span>
<a name="ln-1442"></a><span class="c">!!           &#39;left&#39;       Title is immediately to the left of the first line of the displayed item.</span>
<a name="ln-1443"></a><span class="c">!!           &#39;above&#39;      Title is centered immediately above the item.</span>
<a name="ln-1444"></a><span class="c">!!           &#39;pad&#39;        Title is centered above the item, padded with hyphens (-).</span>
<a name="ln-1445"></a><span class="c">!!           &#39;underline&#39;  Title is centered above the item, underlined with hyphens.</span>
<a name="ln-1446"></a><span class="c">!!           &#39;number&#39;     Each matrix or vector row and / or column is numbered.</span>
<a name="ln-1447"></a><span class="c">!!</span>
<a name="ln-1448"></a><span class="c">!!       Any of the four title position styles can also be combined with the number style by</span>
<a name="ln-1449"></a><span class="c">!!       specifying for example STYLE = &#39;pad &amp; number&#39;. Any character except space may be used</span>
<a name="ln-1450"></a><span class="c">!!       instead of hyphen by prefixing it to the style. STYLE = &#39;*underline&#39; will thus underline the</span>
<a name="ln-1451"></a><span class="c">!!       title with asterisks. Both row and column numbers appear for numbered matrices, but for</span>
<a name="ln-1452"></a><span class="c">!!       vectors only row numbers appear (or column numbers when ORIENT is &#39;col&#39;). The five styles</span>
<a name="ln-1453"></a><span class="c">!!       are illustrated below, accompanied by an example of combined padded title and numbering.</span>
<a name="ln-1454"></a><span class="c">!!</span>
<a name="ln-1455"></a><span class="c">!!         &gt; Matr = 1.2   4.2       Matr      ---Matr--       Matr          1     2     ____Matr____</span>
<a name="ln-1456"></a><span class="c">!!         &gt;        5.6  18.3    1.2   4.2    1.2   4.2    ---------    1  1.2   4.2        1     2</span>
<a name="ln-1457"></a><span class="c">!!         &gt;                     5.6  18.3    5.6  18.3    1.2   4.2    2  5.6  18.3    1  1.2   4.2</span>
<a name="ln-1458"></a><span class="c">!!         &gt;                                               5.6  18.3                    2  5.6  18.3</span>
<a name="ln-1459"></a><span class="c">!!</span>
<a name="ln-1460"></a><span class="c">!!       The default value of STYLE is &#39;left&#39; if LBOUND is absent, &#39;number&#39; if it is present, and</span>
<a name="ln-1461"></a><span class="c">!!       &#39;left &amp; number&#39; if both TITLE and LBOUND are present.</span>
<a name="ln-1462"></a><span class="c">!!</span>
<a name="ln-1463"></a><span class="c">!! TRIM = trim  This argument can take three values, &#39;YES&#39;, &#39;NO&#39; and &#39;AUTO&#39;. When YES is specified,</span>
<a name="ln-1464"></a><span class="c">!!       each column of displayed items is trimmed from the left, with &#39;NO&#39; the items are not trimmed</span>
<a name="ln-1465"></a><span class="c">!!       and if TRIM is &#39;AUTO&#39; the items are trimmed when FMT is absent but not when it is present.</span>
<a name="ln-1466"></a><span class="c">!!       In the following example, X and U are displayed with TRIM = &#39;yes&#39;, but Y and V with TRIM =</span>
<a name="ln-1467"></a><span class="c">!!       &#39;no&#39;. In all cases the edit descriptor is the default (I4). The default is TRIM = &#39;AUTO&#39;.</span>
<a name="ln-1468"></a><span class="c">!!</span>
<a name="ln-1469"></a><span class="c">!!         &gt; ----X----   -------Y------   -----U-----   -------V------</span>
<a name="ln-1470"></a><span class="c">!!         &gt; 1  2    4      1    2    3   333 22 4444    333   22 4444</span>
<a name="ln-1471"></a><span class="c">!!         &gt; 2 22   34      2   22   34</span>
<a name="ln-1472"></a><span class="c">!!         &gt; 3 32 1234      3   32 1234</span>
<a name="ln-1473"></a><span class="c">!!</span>
<a name="ln-1474"></a><span class="c">!!       One application of trimming is to display matrices with a fixed number of fractional digits</span>
<a name="ln-1475"></a><span class="c">!!       but variable effective field width. Then Fw.d editing with w big enough is accompanied by</span>
<a name="ln-1476"></a><span class="c">!!       TRIM = &#39;yes&#39;. An example is the following display of a matrix with (i, k) element exp(k**i)</span>
<a name="ln-1477"></a><span class="c">!!       using F20.2 and &#39;yes&#39;:</span>
<a name="ln-1478"></a><span class="c">!!</span>
<a name="ln-1479"></a><span class="c">!!            power exponentials</span>
<a name="ln-1480"></a><span class="c">!!           2.72   7.39    20.09</span>
<a name="ln-1481"></a><span class="c">!!           2.72  54.60  8103.08</span>
<a name="ln-1482"></a><span class="c">!!</span>
<a name="ln-1483"></a><span class="c">!!       Similar output may be obtained using I and F edit descriptors with w = 0 as discussed in</span>
<a name="ln-1484"></a><span class="c">!!       section 3.5. Apart from I and F edited displays, it is possible to trim A-edited displays as</span>
<a name="ln-1485"></a><span class="c">!!       well as E-edited displays with some negative elements, but the first column all positive:</span>
<a name="ln-1486"></a><span class="c">!!</span>
<a name="ln-1487"></a><span class="c">!!           With TRIM=&#39;yes&#39;:X=1.2e+5 -4.1e-2   With TRIM=&#39;no&#39;:X= 1.2e+5 -4.1e-2</span>
<a name="ln-1488"></a><span class="c">!!                             2.3e-3  8.6e+1                     2.3e-3  8.6e+1</span>
<a name="ln-1489"></a><span class="c">!!</span>
<a name="ln-1490"></a><span class="c">!! UNIT = external-file-unit  The unit which the output is sent to. There are three special units,</span>
<a name="ln-1491"></a><span class="c">!!       which may be referred to either with constants or parameters (named constants) as follows:</span>
<a name="ln-1492"></a><span class="c">!!</span>
<a name="ln-1493"></a><span class="c">!!           Constant  Parameter      Preconnected unit</span>
<a name="ln-1494"></a><span class="c">!!             -3      ASTERISK_UNIT  The asterisk unit (often the screen)</span>
<a name="ln-1495"></a><span class="c">!!             -2      PUTSTR_UNIT    The subroutines PUTSTR and PUTNL</span>
<a name="ln-1496"></a><span class="c">!!             -1      NULL_UNIT      Null device (all output to this is discarded)</span>
<a name="ln-1497"></a><span class="c">!!</span>
<a name="ln-1498"></a><span class="c">!!       These units are further described in sections 3.3 and 3.4. Other unit numbers correspond to</span>
<a name="ln-1499"></a><span class="c">!!       external files that should have been connected with open-statements. The default unit depends</span>
<a name="ln-1500"></a><span class="c">!!       on the named constant DEFAULT_UNIT, defined in PUTSTRMODULE. The default PUTSTRMODULE sets</span>
<a name="ln-1501"></a><span class="c">!!       it to -3 (see sections 2 and 3.4).</span>
<a name="ln-1502"></a><span class="c">!!</span>
<a name="ln-1503"></a><span class="c">!! ZEROAS = zerostring  Supported for integer and real X (not complex) Any element that compares equal</span>
<a name="ln-1504"></a><span class="c">!!       to 0 will be displayed as zerostring. If, for example, A is a 4 by 4 upper triangular matrix</span>
<a name="ln-1505"></a><span class="c">!!       with aij = 1/max(0,j - i + 1) then CALL DISP(&#39;A = &#39;, A, &#39;F0.3&#39;, ZEROAS = &#39;0&#39;, ADVANCE = &#39;NO&#39;)</span>
<a name="ln-1506"></a><span class="c">!!       and CALL DISP(&#39;B = &#39;, A, &#39;F0.3&#39;, ZEROAS = &#39;.&#39;) will display:</span>
<a name="ln-1507"></a><span class="c">!!</span>
<a name="ln-1508"></a><span class="c">!!           A = 1.000  0.500  0.333  0.250   B = 1.000  0.500  0.333  0.250</span>
<a name="ln-1509"></a><span class="c">!!                   0  1.000  0.500  0.333        .     1.000  0.500  0.333</span>
<a name="ln-1510"></a><span class="c">!!                   0      0  1.000  0.500        .      .     1.000  0.500</span>
<a name="ln-1511"></a><span class="c">!!                   0      0      0  1.000        .      .      .     1.000</span>
<a name="ln-1512"></a><span class="c">!!</span>
<a name="ln-1513"></a><span class="c">!!       Notice that when zerostring contains a decimal point it is lined up with other decimal</span>
<a name="ln-1514"></a><span class="c">!!       points in the column. If zerostring has length 0, the default behavior of not treating zeros</span>
<a name="ln-1515"></a><span class="c">!!       specially is re-established, in case an earlier DISP_SET call has been used to set ZEROAS.</span>
<a name="ln-1516"></a><span class="c">!!</span>
<a name="ln-1517"></a><span class="c">!!</span>
<a name="ln-1518"></a><span class="c">!!##ASTERISK_UNIT AND NULL_UNIT</span>
<a name="ln-1519"></a><span class="c">!!</span>
<a name="ln-1520"></a><span class="c">!! As already mentioned in section 3.2 there are three special units, ASTERISK_UNIT = -3, PUTSTR_UNIT</span>
<a name="ln-1521"></a><span class="c">!! = -2 and NULL_UNIT = -1. These public named constants (parameters) are defined by M_display.</span>
<a name="ln-1522"></a><span class="c">!!</span>
<a name="ln-1523"></a><span class="c">!! Selecting ASTERISK_UNIT channels all output to the unit that WRITE(*,...) statements use. The</span>
<a name="ln-1524"></a><span class="c">!! ISO_FORTRAN_ENV intrinsic module of Fortran 2003 defines the named constant OUTPUT_UNIT and this</span>
<a name="ln-1525"></a><span class="c">!! may be used instead, unless its value is set to -2 by the compiler (which would clash with</span>
<a name="ln-1526"></a><span class="c">!!##PUTSTR_UNIT).</span>
<a name="ln-1527"></a><span class="c">!!</span>
<a name="ln-1528"></a><span class="c">!! Selecting NULL_UNIT causes all output via DISP to be discarded. This feature makes it simple to</span>
<a name="ln-1529"></a><span class="c">!! turn the output on and off, which may be useful for debugging and testing purposes. If UNIT = U is</span>
<a name="ln-1530"></a><span class="c">!! specified in all DISP-calls, it is enough to change the value of U to -1 to turn off output.</span>
<a name="ln-1531"></a><span class="c">!!</span>
<a name="ln-1532"></a><span class="c">!!</span>
<a name="ln-1533"></a><span class="c">!! PUTSTR_UNIT: Output with user written subroutines</span>
<a name="ln-1534"></a><span class="c">!!</span>
<a name="ln-1535"></a><span class="c">!! One of the purposes of the PUTSTR_UNIT is to make displaying possible in situations where ordinary</span>
<a name="ln-1536"></a><span class="c">!! print- and write-statements do not work. This is for example the case in Matlab mex-files (in fact</span>
<a name="ln-1537"></a><span class="c">!! the execution of a write statement on the asterisk unit crashes Matlab). To use the PUTSTR_UNIT it</span>
<a name="ln-1538"></a><span class="c">!! is necessary to write two subroutines with interfaces:</span>
<a name="ln-1539"></a><span class="c">!!</span>
<a name="ln-1540"></a><span class="c">!!       SUBROUTINE PUTSTR(S)</span>
<a name="ln-1541"></a><span class="c">!!       CHARACTER(*), INTENT(IN) :: S</span>
<a name="ln-1542"></a><span class="c">!!</span>
<a name="ln-1543"></a><span class="c">!!       SUBROUTINE PUTNL()</span>
<a name="ln-1544"></a><span class="c">!!</span>
<a name="ln-1545"></a><span class="c">!! The first of these should output the string S, and the second one should advance output to the</span>
<a name="ln-1546"></a><span class="c">!! next line. These subroutines should be placed in a module PUTSTRMODULE as explained in section 2.</span>
<a name="ln-1547"></a><span class="c">!! The module should also define a named constant DEFAULT_UNIT, which could be set to -2 to make the</span>
<a name="ln-1548"></a><span class="c">!! PUTSTR_UNIT default. An example that works with g95 and Matlab mex-files is:</span>
<a name="ln-1549"></a><span class="c">!!</span>
<a name="ln-1550"></a><span class="c">!!       module putstrmodule</span>
<a name="ln-1551"></a><span class="c">!!         integer, parameter :: default_unit = -2</span>
<a name="ln-1552"></a><span class="c">!!</span>
<a name="ln-1553"></a><span class="c">!!       contains</span>
<a name="ln-1554"></a><span class="c">!!         subroutine putstr(s)</span>
<a name="ln-1555"></a><span class="c">!!           character(*), intent(in) :: s</span>
<a name="ln-1556"></a><span class="c">!!           call mexprintf(s//char(0))</span>
<a name="ln-1557"></a><span class="c">!!         end subroutine putstr</span>
<a name="ln-1558"></a><span class="c">!!</span>
<a name="ln-1559"></a><span class="c">!!         subroutine putnl()</span>
<a name="ln-1560"></a><span class="c">!!           call mexprintf(char(10)//char(0))</span>
<a name="ln-1561"></a><span class="c">!!         end subroutine putnl</span>
<a name="ln-1562"></a><span class="c">!!</span>
<a name="ln-1563"></a><span class="c">!!       end module putstrmodule</span>
<a name="ln-1564"></a><span class="c">!!</span>
<a name="ln-1565"></a><span class="c">!! At the beginning of the file M_display.f90 there is a slightly longer version which works with</span>
<a name="ln-1566"></a><span class="c">!! both g95 and gfortran. Testing this module is discussed in section 6.2 below.</span>
<a name="ln-1567"></a><span class="c">!!</span>
<a name="ln-1568"></a><span class="c">!!</span>
<a name="ln-1569"></a><span class="c">!!##USING W=0 EDITING</span>
<a name="ln-1570"></a><span class="c">!!</span>
<a name="ln-1571"></a><span class="c">!! The Fortran standard stipulates that writing a single element with I0 editing results in the</span>
<a name="ln-1572"></a><span class="c">!! smallest field width that accommodates the value, and the same applies to B0, O0, Z0 and F0.d</span>
<a name="ln-1573"></a><span class="c">!! editing. With DISP, the width of a displayed column will be the width of the widest field in the</span>
<a name="ln-1574"></a><span class="c">!! column, and each element is right-adjusted in the column. This gives exactly the same output as</span>
<a name="ln-1575"></a><span class="c">!! using TRIM=&#39;yes&#39; and a specified field width bigger than the largest occurring. Note that with</span>
<a name="ln-1576"></a><span class="c">!! F0.d editing, there is no limit on the width of a column, but with Fw.d and TRIM=&#39;yes&#39; any element</span>
<a name="ln-1577"></a><span class="c">!! wider than w will be displayed as w asterisks:</span>
<a name="ln-1578"></a><span class="c">!!</span>
<a name="ln-1579"></a><span class="c">!!       ------------------F0.2------------------    -----F13.2, TRIM=&#39;yes&#39;----</span>
<a name="ln-1580"></a><span class="c">!!       14.28  142857142857142857142857.14  0.47    14.28  *************  0.47</span>
<a name="ln-1581"></a><span class="c">!!        1.42                1414213562.37  0.69     1.42  1414213562.37  0.69</span>
<a name="ln-1582"></a><span class="c">!!</span>
<a name="ln-1583"></a><span class="c">!!</span>
<a name="ln-1584"></a><span class="c">!!##NOT-A-NUMBER AND INFINITE VALUES</span>
<a name="ln-1585"></a><span class="c">!!</span>
<a name="ln-1586"></a><span class="c">!! If the compiler supports not-a-number and infinite values as defined by the IEEE exceptional values</span>
<a name="ln-1587"></a><span class="c">!! of Fortran 2003, these are displayed as NaN, +Inf or Inf. A not-a-number value X is identified as</span>
<a name="ln-1588"></a><span class="c">!! being not equal to itself, and an infinite value is either greater than HUGE(X) or smaller than</span>
<a name="ln-1589"></a><span class="c">!! -HUGE(X). On all the compilers tried the sequence BIG=1E20; CALL DISP(EXP(BIG)) displays +Inf, and</span>
<a name="ln-1590"></a><span class="c">!! the program segment:</span>
<a name="ln-1591"></a><span class="c">!!</span>
<a name="ln-1592"></a><span class="c">!!     &gt; real :: z = 0, big = 1e20</span>
<a name="ln-1593"></a><span class="c">!!     &gt; call disp([z, z/z, big, -exp(big)])</span>
<a name="ln-1594"></a><span class="c">!!</span>
<a name="ln-1595"></a><span class="c">!! displays</span>
<a name="ln-1596"></a><span class="c">!!     &gt;  0.00000E+00</span>
<a name="ln-1597"></a><span class="c">!!     &gt;          NaN</span>
<a name="ln-1598"></a><span class="c">!!     &gt;  1.00000E+20</span>
<a name="ln-1599"></a><span class="c">!!     &gt;         -Inf</span>
<a name="ln-1600"></a><span class="c">!!</span>
<a name="ln-1601"></a><span class="c">!!##AUTHOR</span>
<a name="ln-1602"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-1603"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-1604"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-1605"></a>  <span class="k">interface </span><span class="n">disp</span>
<a name="ln-1606"></a>    <span class="k">module procedure </span><span class="n">disp_scalar_int</span><span class="p">,</span> <span class="n">disp_title_scalar_int</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1607"></a>                     <span class="n">disp_vector_int</span><span class="p">,</span> <span class="n">disp_title_vector_int</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1608"></a>                     <span class="n">disp_matrix_int</span><span class="p">,</span> <span class="n">disp_title_matrix_int</span>
<a name="ln-1609"></a>
<a name="ln-1610"></a>    <span class="k">module procedure </span><span class="n">disp_s_sngl</span><span class="p">,</span> <span class="n">disp_ts_sngl</span><span class="p">,</span> <span class="n">disp_v_sngl</span><span class="p">,</span> <span class="n">disp_tv_sngl</span><span class="p">,</span> <span class="n">disp_m_sngl</span><span class="p">,</span> <span class="n">disp_tm_sngl</span>
<a name="ln-1611"></a>    <span class="k">module procedure </span><span class="n">disp_s_dble</span><span class="p">,</span> <span class="n">disp_ts_dble</span><span class="p">,</span> <span class="n">disp_v_dble</span><span class="p">,</span> <span class="n">disp_tv_dble</span><span class="p">,</span> <span class="n">disp_m_dble</span><span class="p">,</span> <span class="n">disp_tm_dble</span>
<a name="ln-1612"></a>    <span class="k">module procedure </span><span class="n">disp_s_cplx</span><span class="p">,</span> <span class="n">disp_ts_cplx</span><span class="p">,</span> <span class="n">disp_v_cplx</span><span class="p">,</span> <span class="n">disp_tv_cplx</span><span class="p">,</span> <span class="n">disp_m_cplx</span><span class="p">,</span> <span class="n">disp_tm_cplx</span>
<a name="ln-1613"></a>    <span class="k">module procedure </span><span class="n">disp_s_cpld</span><span class="p">,</span> <span class="n">disp_ts_cpld</span><span class="p">,</span> <span class="n">disp_v_cpld</span><span class="p">,</span> <span class="n">disp_tv_cpld</span><span class="p">,</span> <span class="n">disp_m_cpld</span><span class="p">,</span> <span class="n">disp_tm_cpld</span>
<a name="ln-1614"></a>    <span class="k">module procedure </span><span class="n">disp_s_dlog</span><span class="p">,</span> <span class="n">disp_ts_dlog</span><span class="p">,</span> <span class="n">disp_v_dlog</span><span class="p">,</span> <span class="n">disp_tv_dlog</span><span class="p">,</span> <span class="n">disp_m_dlog</span><span class="p">,</span> <span class="n">disp_tm_dlog</span>
<a name="ln-1615"></a>    <span class="k">module procedure              </span><span class="n">disp_ts_dchr</span><span class="p">,</span> <span class="n">disp_v_dchr</span><span class="p">,</span> <span class="n">disp_tv_dchr</span><span class="p">,</span> <span class="n">disp_m_dchr</span><span class="p">,</span> <span class="n">disp_tm_dchr</span>
<a name="ln-1616"></a>  <span class="k">end interface</span>
<a name="ln-1617"></a>
<a name="ln-1618"></a><span class="k">  interface </span><span class="n">tostring</span>
<a name="ln-1619"></a>    <span class="k">module procedure </span><span class="n">tostring_dint</span><span class="p">,</span> <span class="n">tostring_f_dint</span><span class="p">,</span> <span class="n">tostring_s_dint</span><span class="p">,</span> <span class="n">tostring_sf_dint</span>
<a name="ln-1620"></a>    <span class="k">module procedure </span><span class="n">tostring_dlog</span><span class="p">,</span> <span class="n">tostring_f_dlog</span><span class="p">,</span> <span class="n">tostring_s_dlog</span><span class="p">,</span> <span class="n">tostring_sf_dlog</span>
<a name="ln-1621"></a>    <span class="k">module procedure </span><span class="n">tostring_sngl</span><span class="p">,</span> <span class="n">tostring_f_sngl</span><span class="p">,</span> <span class="n">tostring_s_sngl</span><span class="p">,</span> <span class="n">tostring_sf_sngl</span>
<a name="ln-1622"></a>    <span class="k">module procedure </span><span class="n">tostring_dble</span><span class="p">,</span> <span class="n">tostring_f_dble</span><span class="p">,</span> <span class="n">tostring_s_dble</span><span class="p">,</span> <span class="n">tostring_sf_dble</span>
<a name="ln-1623"></a>    <span class="k">module procedure </span><span class="n">tostring_cplx</span><span class="p">,</span> <span class="n">tostring_f_cplx</span><span class="p">,</span> <span class="n">tostring_s_cplx</span><span class="p">,</span> <span class="n">tostring_sf_cplx</span>
<a name="ln-1624"></a>    <span class="k">module procedure </span><span class="n">tostring_cpld</span><span class="p">,</span> <span class="n">tostring_f_cpld</span><span class="p">,</span> <span class="n">tostring_s_cpld</span><span class="p">,</span> <span class="n">tostring_sf_cpld</span>
<a name="ln-1625"></a>  <span class="k">end interface</span>
<a name="ln-1626"></a>
<a name="ln-1627"></a>  <span class="c">! *********************** DEFINITION OF TYPED CONSTANTS: UNITS AND KIND PARAMETERS ********************</span>
<a name="ln-1628"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span>    <span class="p">&amp;</span>
<a name="ln-1629"></a>       <span class="n">ASTERISK_UNIT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>  <span class="p">,&amp;</span>
<a name="ln-1630"></a>       <span class="n">PUTSTR_UNIT</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>  <span class="p">,&amp;</span>
<a name="ln-1631"></a>       <span class="n">NULL_UNIT</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1632"></a>
<a name="ln-1633"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">dint</span> <span class="o">=</span> <span class="nb">kind</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>       <span class="c">! default integer</span>
<a name="ln-1634"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">sngl</span> <span class="o">=</span> <span class="nb">kind</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>     <span class="c">! single precision (default real)</span>
<a name="ln-1635"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">dble</span> <span class="o">=</span> <span class="nb">kind</span><span class="p">(</span><span class="mi">0</span><span class="n">d0</span><span class="p">)</span>     <span class="c">! double precision</span>
<a name="ln-1636"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">dlog</span> <span class="o">=</span> <span class="nb">kind</span><span class="p">(.</span><span class="n">false</span><span class="p">.)</span> <span class="c">! default logical</span>
<a name="ln-1637"></a>
<a name="ln-1638"></a>  <span class="c">! The above are also used as specific procedure (i.e. module procedure) name extensions, together</span>
<a name="ln-1639"></a>  <span class="c">! with the following:</span>
<a name="ln-1640"></a>  <span class="c">!        cplx = complex single precision (default complex)</span>
<a name="ln-1641"></a>  <span class="c">!        cpld = complex double precision</span>
<a name="ln-1642"></a>
<a name="ln-1643"></a><span class="k">CONTAINS</span>
<a name="ln-1644"></a>
<a name="ln-1645"></a>  <span class="c">! ******************************* SETTING AND GETTING PROCEDURES *************************************</span>
<a name="ln-1646"></a><span class="c">!&gt;</span>
<a name="ln-1647"></a><span class="c">!!##NAME</span>
<a name="ln-1648"></a><span class="c">!!       disp_set(3f) - [M_display] set default options for disp(3f)</span>
<a name="ln-1649"></a><span class="c">!!</span>
<a name="ln-1650"></a><span class="c">!!##DESCRIPTION</span>
<a name="ln-1651"></a><span class="c">!!</span>
<a name="ln-1652"></a><span class="c">!! The subroutine DISP_SET may be used to change default values of all the arguments of DISP except</span>
<a name="ln-1653"></a><span class="c">!! TITLE, X, FMT and LBOUND. In addition the default separator between items that are displayed</span>
<a name="ln-1654"></a><span class="c">!! side-by-side (using ADVANCE=&#39;no&#39;) may be changed with the MATSEP argument.</span>
<a name="ln-1655"></a><span class="c">!!</span>
<a name="ln-1656"></a><span class="c">!!</span>
<a name="ln-1657"></a><span class="c">!!##THE DERIVED TYPE DISP_SETTINGS</span>
<a name="ln-1658"></a><span class="c">!!</span>
<a name="ln-1659"></a><span class="c">!! M_display contains the following definition of the data type DISP_SETTINGS.</span>
<a name="ln-1660"></a><span class="c">!!</span>
<a name="ln-1661"></a><span class="c">!!       TYPE DISP_SETTINGS</span>
<a name="ln-1662"></a><span class="c">!!         character(3)  :: advance   = &#39;YES&#39;</span>
<a name="ln-1663"></a><span class="c">!!         character(9)  :: matsep    = &#39;   &#39;</span>
<a name="ln-1664"></a><span class="c">!!         character(3)  :: orient    = &#39;COL&#39;</span>
<a name="ln-1665"></a><span class="c">!!         character(9)  :: sep       = &#39;  &#39;</span>
<a name="ln-1666"></a><span class="c">!!         character(19) :: style     = &#39;LEFT&#39;</span>
<a name="ln-1667"></a><span class="c">!!         character(4)  :: trim      = &#39;AUTO&#39;</span>
<a name="ln-1668"></a><span class="c">!!         character(9)  :: zeroas    = &#39;&#39;</span>
<a name="ln-1669"></a><span class="c">!!         integer       :: digmax    = 6</span>
<a name="ln-1670"></a><span class="c">!!         integer       :: matseplen = 3</span>
<a name="ln-1671"></a><span class="c">!!         integer       :: seplen    = 2</span>
<a name="ln-1672"></a><span class="c">!!         integer       :: unit      = -3</span>
<a name="ln-1673"></a><span class="c">!!         integer       :: zaslen    = 0</span>
<a name="ln-1674"></a><span class="c">!!       END TYPE DISP_SETTINGS</span>
<a name="ln-1675"></a><span class="c">!!</span>
<a name="ln-1676"></a><span class="c">!! Structures of type DISP_SETTINGS may be used to save and later restore format control settings of</span>
<a name="ln-1677"></a><span class="c">!! DISP. As shown, new variables of this type will automatically have default values for all</span>
<a name="ln-1678"></a><span class="c">!! components.</span>
<a name="ln-1679"></a><span class="c">!!</span>
<a name="ln-1680"></a><span class="c">!!</span>
<a name="ln-1681"></a><span class="c">!!##CALLING SYNTAX FOR DISP_SET</span>
<a name="ln-1682"></a><span class="c">!!</span>
<a name="ln-1683"></a><span class="c">!! There are two ways to call DISP_SET:</span>
<a name="ln-1684"></a><span class="c">!!</span>
<a name="ln-1685"></a><span class="c">!!       CALL DISP_SET(SETTINGS)</span>
<a name="ln-1686"></a><span class="c">!!       CALL DISP_SET(ADVANCE, DIGMAX, MATSEP, ORIENT, SEP, STYLE, UNIT, ZEROAS)</span>
<a name="ln-1687"></a><span class="c">!!</span>
<a name="ln-1688"></a><span class="c">!! Both calls change the default format control used in subsequent calls to DISP. In the first call,</span>
<a name="ln-1689"></a><span class="c">!! SETTINGS is of type DISP_SETTINGS and the default values for all arguments is changed. In the</span>
<a name="ln-1690"></a><span class="c">!! second call all the arguments are optional. If an argument is absent the corresponding default</span>
<a name="ln-1691"></a><span class="c">!! setting is not changed. An example call is</span>
<a name="ln-1692"></a><span class="c">!!</span>
<a name="ln-1693"></a><span class="c">!!       CALL DISP_SET(STYLE = &#39;PAD&#39;, SEP = &#39; &#39;).</span>
<a name="ln-1694"></a><span class="c">!!</span>
<a name="ln-1695"></a><span class="c">!! The effect is that titles will be written padded above matrices, and matrix column will be</span>
<a name="ln-1696"></a><span class="c">!! separated by one blank. The type and purpose of all the arguments except MATSEP has been</span>
<a name="ln-1697"></a><span class="c">!! described in section 3.2.</span>
<a name="ln-1698"></a><span class="c">!!</span>
<a name="ln-1699"></a><span class="c">!! MATSEP = ms  Specifies a character string of length &lt;= 9 that is written out between items</span>
<a name="ln-1700"></a><span class="c">!!              (matrices) when they are displayed side-by-side. An example is:</span>
<a name="ln-1701"></a><span class="c">!!</span>
<a name="ln-1702"></a><span class="c">!!                   CALL DISP(X, ADVANCE=&#39;NO&#39;)</span>
<a name="ln-1703"></a><span class="c">!!                   CALL DISP(Y, ADVANCE=&#39;NO&#39;)</span>
<a name="ln-1704"></a><span class="c">!!                   CALL DISP_SET(MATSEP=&#39; | &#39;)</span>
<a name="ln-1705"></a><span class="c">!!                   CALL DISP(Z, ADVANCE=&#39;YES&#39;)</span>
<a name="ln-1706"></a><span class="c">!!</span>
<a name="ln-1707"></a><span class="c">!!              The output from these calls might be:</span>
<a name="ln-1708"></a><span class="c">!!</span>
<a name="ln-1709"></a><span class="c">!!                   12.2 |  1.3 | 1</span>
<a name="ln-1710"></a><span class="c">!!                    9.6 | 13.0 | 3</span>
<a name="ln-1711"></a><span class="c">!!                   -2.0 |  4.0 | 4</span>
<a name="ln-1712"></a><span class="c">!!</span>
<a name="ln-1713"></a><span class="c">!!              Note that MATSEP affects the separation of all items that have been placed in the</span>
<a name="ln-1714"></a><span class="c">!!              output queue of the unit being displayed on.</span>
<a name="ln-1715"></a><span class="c">!!##AUTHOR</span>
<a name="ln-1716"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-1717"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-1718"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-1719"></a>  <span class="k">subroutine </span><span class="n">disp_set</span><span class="p">(</span><span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">matsep</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-1720"></a>    <span class="c">! Change display settings according to individual parameters</span>
<a name="ln-1721"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">matsep</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-1722"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">unit</span>
<a name="ln-1723"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">advance</span><span class="p">))</span>    <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">advance</span> <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">advance</span><span class="p">)</span>
<a name="ln-1724"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>        <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span>
<a name="ln-1725"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>        <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">seplen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
<a name="ln-1726"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">zeroas</span><span class="p">))</span>     <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">zeroas</span> <span class="o">=</span> <span class="n">zeroas</span>
<a name="ln-1727"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">zeroas</span><span class="p">))</span>     <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">zaslen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeroas</span><span class="p">))</span>
<a name="ln-1728"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">matsep</span><span class="p">))</span>     <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">matsep</span> <span class="o">=</span> <span class="n">matsep</span>
<a name="ln-1729"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">matsep</span><span class="p">))</span>     <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">matseplen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">matsep</span><span class="p">))</span>
<a name="ln-1730"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">orient</span><span class="p">))</span>     <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">orient</span> <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">orient</span><span class="p">)</span>
<a name="ln-1731"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>      <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
<a name="ln-1732"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">digmax</span><span class="p">))</span>     <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">digmax</span> <span class="o">=</span> <span class="n">digmax</span>
<a name="ln-1733"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>       <span class="n">DEFSET</span> <span class="p">%</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
<a name="ln-1734"></a>    <span class="k">call </span><span class="n">check_settings</span>
<a name="ln-1735"></a>  <span class="k">end subroutine </span><span class="n">disp_set</span>
<a name="ln-1736"></a><span class="c">!&gt;</span>
<a name="ln-1737"></a><span class="c">!!##NAME</span>
<a name="ln-1738"></a><span class="c">!!    disp_set_factory(3f) - [M_display] set DISP(3f) output back to original defaults</span>
<a name="ln-1739"></a><span class="c">!!</span>
<a name="ln-1740"></a><span class="c">!!##DESCRIPTION</span>
<a name="ln-1741"></a><span class="c">!! The subroutine disp_set_factory (which has no arguments) may be called to restore all</span>
<a name="ln-1742"></a><span class="c">!! settings of DISP(3f) to the original default values.</span>
<a name="ln-1743"></a><span class="c">!!</span>
<a name="ln-1744"></a><span class="c">!!##AUTHOR</span>
<a name="ln-1745"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-1746"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-1747"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-1748"></a>  <span class="k">subroutine </span><span class="n">disp_set_factory</span><span class="p">()</span>
<a name="ln-1749"></a>    <span class="c">! Change display settings to the original default</span>
<a name="ln-1750"></a>    <span class="n">DEFSET</span> <span class="o">=</span> <span class="n">FACTORY_SETTINGS</span>
<a name="ln-1751"></a>  <span class="k">end subroutine </span><span class="n">disp_set_factory</span>
<a name="ln-1752"></a>
<a name="ln-1753"></a>  <span class="k">subroutine </span><span class="n">avoid_compiler_warnings</span>
<a name="ln-1754"></a>    <span class="c">! Routine that exists only to avoid compiler warnings (due to compiler bugs)</span>
<a name="ln-1755"></a>    <span class="k">type</span><span class="p">(</span><span class="n">boxlist</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxl_dummy1</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">(),</span> <span class="n">boxl_dummy2</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-1756"></a>    <span class="k">type</span><span class="p">(</span><span class="n">boxnode</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxn_dummy1</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">(),</span> <span class="n">boxn_dummy2</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-1757"></a>    <span class="k">type</span><span class="p">(</span><span class="n">tostring_settings</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">ts1</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">(),</span> <span class="n">ts2</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-1758"></a>    <span class="n">ts1</span> <span class="o">=&gt;</span> <span class="n">ts2</span>
<a name="ln-1759"></a>    <span class="n">ts2</span> <span class="o">=&gt;</span> <span class="n">ts1</span>
<a name="ln-1760"></a>    <span class="n">boxl_dummy2</span> <span class="o">=&gt;</span> <span class="n">boxl_dummy1</span>
<a name="ln-1761"></a>    <span class="n">boxl_dummy1</span> <span class="o">=&gt;</span> <span class="n">boxl_dummy2</span>
<a name="ln-1762"></a>    <span class="n">boxn_dummy2</span> <span class="o">=&gt;</span> <span class="n">boxn_dummy1</span>
<a name="ln-1763"></a>    <span class="n">boxn_dummy1</span> <span class="o">=&gt;</span> <span class="n">boxn_dummy2</span>
<a name="ln-1764"></a>  <span class="k">end subroutine </span><span class="n">avoid_compiler_warnings</span>
<a name="ln-1765"></a><span class="c">!&gt;</span>
<a name="ln-1766"></a><span class="c">!!##NAME</span>
<a name="ln-1767"></a><span class="c">!!    tostring_set(3f) - [M_display] set modes for TOSTRING(3f)</span>
<a name="ln-1768"></a><span class="c">!!</span>
<a name="ln-1769"></a><span class="c">!!##DESCRIPTION</span>
<a name="ln-1770"></a><span class="c">!!</span>
<a name="ln-1771"></a><span class="c">!! The subroutine TOSTRING_SET has five arguments, all of which are optional. Argument</span>
<a name="ln-1772"></a><span class="c">!! association will normally be realized using argument keywords, e.g. CALL</span>
<a name="ln-1773"></a><span class="c">!! TOSTRING_SET(SEP=&#39;; &#39;). The examples in section 5.4 clarify how to use this subroutine. The five</span>
<a name="ln-1774"></a><span class="c">!! arguments are:</span>
<a name="ln-1775"></a><span class="c">!!</span>
<a name="ln-1776"></a><span class="c">!! SEP     Character string used to separate elements of displayed vectors. Original default value is</span>
<a name="ln-1777"></a><span class="c">!!         &#39;, &#39;.</span>
<a name="ln-1778"></a><span class="c">!!</span>
<a name="ln-1779"></a><span class="c">!! RFMT    Character string containing default edit descriptor to use to display real items. The</span>
<a name="ln-1780"></a><span class="c">!!         original default value is &#39;1PG12.5&#39;</span>
<a name="ln-1781"></a><span class="c">!!</span>
<a name="ln-1782"></a><span class="c">!! IFMT    Character string containing default edit descriptor to use to display integer items. The</span>
<a name="ln-1783"></a><span class="c">!!         original default value is &#39;I0&#39;.</span>
<a name="ln-1784"></a><span class="c">!!</span>
<a name="ln-1785"></a><span class="c">!! TRIMB   Controls whether leading and trailing blanks are trimmed from individual displayed</span>
<a name="ln-1786"></a><span class="c">!!         elements. Possible values are &#39;YES&#39; (to trim blanks) and &#39;NO&#39; (for no trimming). Default</span>
<a name="ln-1787"></a><span class="c">!!         is &#39;YES&#39;.</span>
<a name="ln-1788"></a><span class="c">!!</span>
<a name="ln-1789"></a><span class="c">!! TRIMZ   Controls whether trailing zeros are trimmed from the fractional part of displayed items.</span>
<a name="ln-1790"></a><span class="c">!!         Possible values are &#39;NONE&#39; (for no zero trimming), &#39;G&#39; (to trim fractional trailing zeros</span>
<a name="ln-1791"></a><span class="c">!!         only when G editing is used), and &#39;ALL&#39; (to trim zeros with all types of editing). Trailing</span>
<a name="ln-1792"></a><span class="c">!!         decimal points are also removed when zero-trimming is active. Default value is &#39;G&#39;.</span>
<a name="ln-1793"></a><span class="c">!!</span>
<a name="ln-1794"></a><span class="c">!!##EXAMPLES</span>
<a name="ln-1795"></a><span class="c">!!</span>
<a name="ln-1796"></a><span class="c">!!</span>
<a name="ln-1797"></a><span class="c">!! When the original (factory) defaults are in effect, the result of invoking TOSTRING will usually</span>
<a name="ln-1798"></a><span class="c">!! be as follows.</span>
<a name="ln-1799"></a><span class="c">!!</span>
<a name="ln-1800"></a><span class="c">!!       Invocation                             Returned String</span>
<a name="ln-1801"></a><span class="c">!!       ----------                             ---------------</span>
<a name="ln-1802"></a><span class="c">!!       tostring(atan(1.0))                    &#39;0.785398&#39;</span>
<a name="ln-1803"></a><span class="c">!!       tostring(exp([-3.,-1.,0.,1.]))         &#39;4.97871E-02, 0.36788, 1, 2.7183&#39;</span>
<a name="ln-1804"></a><span class="c">!!       tostring(real([(i,i=1,5)])**8)         &#39;1, 256, 6561, 65536, 3.90625E+05&#39;</span>
<a name="ln-1805"></a><span class="c">!!       tostring([1.23456,1.2300,1.23456e6])   &#39;1.2346, 1.23, 1.23456E+06&#39;</span>
<a name="ln-1806"></a><span class="c">!!       tostring(real([(i,i=1,5)])**8,&#39;f0.1&#39;)  &#39;1.0, 256.0, 6561.0, 65536.0, 390625.0&#39;</span>
<a name="ln-1807"></a><span class="c">!!       tostring(real([(i,i=1,5)])**8,&#39;f6.1&#39;)  &#39;1.0, 256.0, 6561.0, ******, ******&#39;</span>
<a name="ln-1808"></a><span class="c">!!       tostring([1200000.,-1.2e-9])           &#39;1.2E+06, -1.2E-09&#39;</span>
<a name="ln-1809"></a><span class="c">!!       !</span>
<a name="ln-1810"></a><span class="c">!!       tostring(1.200d103)                    &#39;1.2+103&#39;</span>
<a name="ln-1811"></a><span class="c">!!       tostring([1.1d0,2.2d10,3.3d20])        &#39;1.1E+00, 2.2E+10, 3.3E+20&#39;</span>
<a name="ln-1812"></a><span class="c">!!       !</span>
<a name="ln-1813"></a><span class="c">!!       tostring(-77)                          &#39;-77&#39;</span>
<a name="ln-1814"></a><span class="c">!!       tostring([(i,i=-3,3)]**11)             &#39;-177147, -2048, -1, 0, 1, 2048, 177147&#39;</span>
<a name="ln-1815"></a><span class="c">!!       tostring([(i,i=-3,3)]**11, &#39;i7&#39;)       &#39;-177147, -2048, -1, 0, 1, 2048, 177147&#39;</span>
<a name="ln-1816"></a><span class="c">!!       tostring([(i,i=-3,3)]**11, &#39;i4&#39;)       &#39;****, ****, -1, 0, 1, 2048, ****&#39;</span>
<a name="ln-1817"></a><span class="c">!!       !</span>
<a name="ln-1818"></a><span class="c">!!       tostring((1,3)/(4,2))                  &#39;0.5 + 0.5i&#39;</span>
<a name="ln-1819"></a><span class="c">!!       tostring(cmplx([-1,-2])**0.25)       &#39;0.70711 + 0.70711i, 0.8409 + 0.8409i&#39;</span>
<a name="ln-1820"></a><span class="c">!!       !</span>
<a name="ln-1821"></a><span class="c">!!       tostring([.true., .false., .false.])   &#39;T, F, F&#39;</span>
<a name="ln-1822"></a><span class="c">!!       tostring(.true., &#39;L2&#39;)                 &#39;T&#39;</span>
<a name="ln-1823"></a><span class="c">!!</span>
<a name="ln-1824"></a><span class="c">!! The returned strings may be slightly different from the ones shown, because some compilers (at</span>
<a name="ln-1825"></a><span class="c">!! least some versions of g95) will produce one more decimal place in a few cases, and because the</span>
<a name="ln-1826"></a><span class="c">!! Fortran standard allows G editing to give exponent fields in the form 0dd instead of Edd. The</span>
<a name="ln-1827"></a><span class="c">!! examples make use of brackets to construct vector constants (a Fortran 2003 feature). If the</span>
<a name="ln-1828"></a><span class="c">!! compiler being used does not support this, [ and ] must be used instead. Notice that trimming is</span>
<a name="ln-1829"></a><span class="c">!! on by default so there is not much purpose in specifying the format for integers and logicals.</span>
<a name="ln-1830"></a><span class="c">!! Notice also that (usually) 5 significant digits are displayed when the default G editing results</span>
<a name="ln-1831"></a><span class="c">!! in F edited output, but 6 digits for the numbers of small or large magnitude, displayed with E</span>
<a name="ln-1832"></a><span class="c">!! editing. This discrepancy is present in the Fortran standard; the presence of the scale factor 1P</span>
<a name="ln-1833"></a><span class="c">!! in the edit descriptor increases the number of displayed significant digits.</span>
<a name="ln-1834"></a><span class="c">!!</span>
<a name="ln-1835"></a><span class="c">!! Examples of using TOSTRING_SET follow (again the returned string may be slightly different).</span>
<a name="ln-1836"></a><span class="c">!!</span>
<a name="ln-1837"></a><span class="c">!!       Invocation                              Returned String</span>
<a name="ln-1838"></a><span class="c">!!       ----------                              ---------------</span>
<a name="ln-1839"></a><span class="c">!!       call tostring_set(sep=&#39;;&#39;)</span>
<a name="ln-1840"></a><span class="c">!!       tostring([1,2,30])                      &#39;1;2;30&#39;</span>
<a name="ln-1841"></a><span class="c">!!       !</span>
<a name="ln-1842"></a><span class="c">!!       call tostring_set(trimb=&#39;NO&#39;)</span>
<a name="ln-1843"></a><span class="c">!!       tostring(real([(i,i=1,5)])**8,&#39;f6.1&#39;)   &#39;   1.0; 256.0;6561.0;******;******&#39;</span>
<a name="ln-1844"></a><span class="c">!!       tostring([1,2,30],&#39;i3&#39;)                 &#39;  1;  2; 30&#39;</span>
<a name="ln-1845"></a><span class="c">!!       tostring([(i,i=-3,3)]**11, &#39;i4&#39;)        &#39;****;****;  -1;   0;   1;2048;****&#39;</span>
<a name="ln-1846"></a><span class="c">!!       tostring([1,2,30],&#39;i0&#39;)                 &#39;1;2;30&#39;</span>
<a name="ln-1847"></a><span class="c">!!       tostring(.true.,&#39;L3&#39;)                   &#39;  T&#39;</span>
<a name="ln-1848"></a><span class="c">!!       !</span>
<a name="ln-1849"></a><span class="c">!!       call tostring_set(trimz=&#39;NONE&#39;,sep=&#39;, &#39;,trimb=&#39;YES&#39;)</span>
<a name="ln-1850"></a><span class="c">!!       tostring(real([(i,i=1,4)])**8)          &#39;1.0000, 256.00, 6561.0, 65536.&#39;</span>
<a name="ln-1851"></a><span class="c">!!       tostring([1.23456,1.2300,1.23456e6])    &#39;1.2346, 1.2300, 1.23456E+06&#39;</span>
<a name="ln-1852"></a><span class="c">!!       tostring(1.200d103)                     &#39;1.20000+103&#39;</span>
<a name="ln-1853"></a><span class="c">!!       !</span>
<a name="ln-1854"></a><span class="c">!!       call tostring_set(trimz=&#39;ALL&#39;)</span>
<a name="ln-1855"></a><span class="c">!!       tostring(real([(i,i=1,5)])**8,&#39;f0.1&#39;)   &#39;1, 256, 6561, 65536, 390625&#39;</span>
<a name="ln-1856"></a><span class="c">!!       !</span>
<a name="ln-1857"></a><span class="c">!!       call tostring_set(rfmt=&#39;G12.4&#39;)</span>
<a name="ln-1858"></a><span class="c">!!       tostring(real([(i,i=0,5)])**8)          &#39;1, 256, 6561, 0.6554E+05, 0.3906E+06&#39;</span>
<a name="ln-1859"></a><span class="c">!!       tostring([1200000.,-1.2e-9])            &#39;0.12E+07, -0.12E-08&#39;</span>
<a name="ln-1860"></a><span class="c">!!       !</span>
<a name="ln-1861"></a><span class="c">!!       call tostring_set_factory()</span>
<a name="ln-1862"></a><span class="c">!!</span>
<a name="ln-1863"></a><span class="c">!!##AUTHOR</span>
<a name="ln-1864"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-1865"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-1866"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-1867"></a>  <span class="k">subroutine </span><span class="n">tostring_set</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">rfmt</span><span class="p">,</span> <span class="n">ifmt</span><span class="p">,</span> <span class="n">trimb</span><span class="p">,</span> <span class="n">trimz</span><span class="p">)</span>
<a name="ln-1868"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sep</span><span class="p">,</span> <span class="n">rfmt</span><span class="p">,</span> <span class="n">ifmt</span><span class="p">,</span> <span class="n">trimb</span><span class="p">,</span> <span class="n">trimz</span>
<a name="ln-1869"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>    <span class="n">tosset</span> <span class="p">%</span> <span class="n">sep</span>    <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<a name="ln-1870"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>    <span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
<a name="ln-1871"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">rfmt</span><span class="p">))</span>   <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span>   <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">rfmt</span><span class="p">)</span>
<a name="ln-1872"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">ifmt</span><span class="p">))</span>   <span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span>   <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">ifmt</span><span class="p">)</span>
<a name="ln-1873"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">trimb</span><span class="p">))</span>  <span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span>  <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">trimb</span><span class="p">)</span>
<a name="ln-1874"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">trimz</span><span class="p">))</span>  <span class="n">tosset</span> <span class="p">%</span> <span class="n">trimz</span>  <span class="o">=</span> <span class="n">upper</span><span class="p">(</span><span class="n">trimz</span><span class="p">)</span>
<a name="ln-1875"></a>    <span class="k">call </span><span class="n">tostring_check_settings</span>
<a name="ln-1876"></a>  <span class="k">end subroutine </span><span class="n">tostring_set</span>
<a name="ln-1877"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1878"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1879"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1880"></a><span class="c">!&gt;</span>
<a name="ln-1881"></a><span class="c">!!##NAME</span>
<a name="ln-1882"></a><span class="c">!!    tostring_set_factory(3f) - [M_display] set TOSTRING(3f) output back to original defaults</span>
<a name="ln-1883"></a><span class="c">!!</span>
<a name="ln-1884"></a><span class="c">!!##DESCRIPTION</span>
<a name="ln-1885"></a><span class="c">!! The subroutine TOSTRING_SET_FACTORY (which has no arguments) may be called to restore all</span>
<a name="ln-1886"></a><span class="c">!! settings of TOSTRING(3f) to the original default values (the factory defaults): SEP=&#39;,&#39;, RFMT =</span>
<a name="ln-1887"></a><span class="c">!! &#39;1PG12.5&#39;, IFMT= &#39;I0&#39;, TRIMB=&#39;YES&#39; and TRIMZ=&#39;G&#39;.</span>
<a name="ln-1888"></a><span class="c">!!</span>
<a name="ln-1889"></a><span class="c">!!##AUTHOR</span>
<a name="ln-1890"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-1891"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-1892"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-1893"></a>  <span class="k">subroutine </span><span class="n">tostring_set_factory</span><span class="p">()</span>
<a name="ln-1894"></a>    <span class="kt">logical </span><span class="n">dummy</span>
<a name="ln-1895"></a>    <span class="n">dummy</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1896"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">dummy</span><span class="p">)</span> <span class="k">call </span><span class="n">avoid_compiler_warnings</span>
<a name="ln-1897"></a>    <span class="n">tosset</span> <span class="o">=</span> <span class="n">tosfac</span>
<a name="ln-1898"></a>  <span class="k">end subroutine </span><span class="n">tostring_set_factory</span>
<a name="ln-1899"></a>
<a name="ln-1900"></a>  <span class="k">subroutine </span><span class="n">disp_set_ds</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<a name="ln-1901"></a>    <span class="c">! Change display settings according to the structure &quot;settings&quot;</span>
<a name="ln-1902"></a>    <span class="k">type</span><span class="p">(</span><span class="n">disp_settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">settings</span>
<a name="ln-1903"></a>    <span class="n">DEFSET</span> <span class="o">=</span> <span class="n">settings</span>
<a name="ln-1904"></a>    <span class="k">call </span><span class="n">check_settings</span>
<a name="ln-1905"></a>  <span class="k">end subroutine </span><span class="n">disp_set_ds</span>
<a name="ln-1906"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1907"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1908"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1909"></a><span class="c">!&gt;</span>
<a name="ln-1910"></a><span class="c">!!##NAME</span>
<a name="ln-1911"></a><span class="c">!!</span>
<a name="ln-1912"></a><span class="c">!! disp_get(3f) - [M_display] return default settings in a structure of DISP(3f) settings</span>
<a name="ln-1913"></a><span class="c">!!</span>
<a name="ln-1914"></a><span class="c">!!##DESCRIPTION</span>
<a name="ln-1915"></a><span class="c">!!</span>
<a name="ln-1916"></a><span class="c">!! The argumentless function DISP_GET returns the current default settings in a structure of type</span>
<a name="ln-1917"></a><span class="c">!! DISP_SETTINGS. If a subroutine changes the default settings with DISP_SET it is possible to save</span>
<a name="ln-1918"></a><span class="c">!! the settings that are in effect when the routine is entered, and restore these settings before</span>
<a name="ln-1919"></a><span class="c">!! returning from the routine.</span>
<a name="ln-1920"></a><span class="c">!!</span>
<a name="ln-1921"></a><span class="c">!!##EXAMPLE</span>
<a name="ln-1922"></a><span class="c">!!</span>
<a name="ln-1923"></a><span class="c">!!</span>
<a name="ln-1924"></a><span class="c">!! An example is:</span>
<a name="ln-1925"></a><span class="c">!!</span>
<a name="ln-1926"></a><span class="c">!!    program demo_disp_get</span>
<a name="ln-1927"></a><span class="c">!!    real :: xx(2,3), yy(2,3)</span>
<a name="ln-1928"></a><span class="c">!!       xx(1,:)=[ 1.0, 6.0, 5.0  ]</span>
<a name="ln-1929"></a><span class="c">!!       xx(2,:)=[ 2.4, 4.0, 6.0  ]</span>
<a name="ln-1930"></a><span class="c">!!       yy(1,:)=[ 0.0, 3.5, 2.0  ]</span>
<a name="ln-1931"></a><span class="c">!!       yy(2,:)=[ 7.0, 4.0, 8.22 ]</span>
<a name="ln-1932"></a><span class="c">!!       call disp_xy(xx,yy)</span>
<a name="ln-1933"></a><span class="c">!!    contains</span>
<a name="ln-1934"></a><span class="c">!!</span>
<a name="ln-1935"></a><span class="c">!!    subroutine disp_xy(x,y)</span>
<a name="ln-1936"></a><span class="c">!!    use M_display</span>
<a name="ln-1937"></a><span class="c">!!    real x(:,:), y(:,:)</span>
<a name="ln-1938"></a><span class="c">!!    type(disp_settings) ds</span>
<a name="ln-1939"></a><span class="c">!!       ds = disp_get()</span>
<a name="ln-1940"></a><span class="c">!!       call disp_set(digmax=4, sep=&#39;,&#39;)</span>
<a name="ln-1941"></a><span class="c">!!       call disp(&#39;x=&#39;,x)</span>
<a name="ln-1942"></a><span class="c">!!       write(*,*)</span>
<a name="ln-1943"></a><span class="c">!!       call disp(&#39;y=&#39;,y)</span>
<a name="ln-1944"></a><span class="c">!!       call disp_set(ds)</span>
<a name="ln-1945"></a><span class="c">!!    end subroutine disp_xy</span>
<a name="ln-1946"></a><span class="c">!!</span>
<a name="ln-1947"></a><span class="c">!!    end program demo_disp_get</span>
<a name="ln-1948"></a><span class="c">!!</span>
<a name="ln-1949"></a><span class="c">!! Expected:</span>
<a name="ln-1950"></a><span class="c">!!</span>
<a name="ln-1951"></a><span class="c">!!    x=1.000,6.000,5.000</span>
<a name="ln-1952"></a><span class="c">!!      2.400,4.000,6.000</span>
<a name="ln-1953"></a><span class="c">!!</span>
<a name="ln-1954"></a><span class="c">!!    y=0.000,3.500,2.000</span>
<a name="ln-1955"></a><span class="c">!!      7.000,4.000,8.220</span>
<a name="ln-1956"></a><span class="c">!!</span>
<a name="ln-1957"></a><span class="c">!!##AUTHOR</span>
<a name="ln-1958"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-1959"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-1960"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-1961"></a><span class="k">function </span><span class="n">disp_get</span><span class="p">()</span> <span class="k">result</span><span class="p">(</span><span class="n">defs</span><span class="p">)</span>
<a name="ln-1962"></a><span class="c">! Return current display settings</span>
<a name="ln-1963"></a><span class="k">type</span><span class="p">(</span><span class="n">disp_settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">defs</span>
<a name="ln-1964"></a>   <span class="n">defs</span> <span class="o">=</span> <span class="n">DEFSET</span>
<a name="ln-1965"></a><span class="k">end function </span><span class="n">disp_get</span>
<a name="ln-1966"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1967"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1968"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1969"></a><span class="c">! *********************************************** DEFAULT INTEGER PROCEDURES ******************************************************</span>
<a name="ln-1970"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1971"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1972"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1973"></a><span class="k">subroutine </span><span class="n">disp_scalar_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-1974"></a>
<a name="ln-1975"></a><span class="c">! ident_2=&quot;@(#)M_disp::disp_scalar_int(3f): integer scalar without title  (call disp_title_scalar_int(3f) with title=&#39;&#39;)&quot;</span>
<a name="ln-1976"></a>
<a name="ln-1977"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-1978"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">x</span>
<a name="ln-1979"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span>      <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-1980"></a>
<a name="ln-1981"></a>   <span class="k">call </span><span class="n">disp_title_scalar_int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-1982"></a>
<a name="ln-1983"></a><span class="k">end subroutine </span><span class="n">disp_scalar_int</span>
<a name="ln-1984"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1985"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1986"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1987"></a><span class="k">subroutine </span><span class="n">disp_title_scalar_int</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-1988"></a>
<a name="ln-1989"></a><span class="c">! ident_3=&quot;@(#)M_display::disp_scalar_int(3f): Default integer scalar with title&quot;</span>
<a name="ln-1990"></a>
<a name="ln-1991"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-1992"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-1993"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">x</span>
<a name="ln-1994"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span>      <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-1995"></a>
<a name="ln-1996"></a>   <span class="k">call </span><span class="n">disp_title_matrix_int</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="nb">reshape</span><span class="p">([</span><span class="n">x</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">fmt</span><span class="p">,</span><span class="n">advance</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span><span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span><span class="n">zeroas</span><span class="o">=</span><span class="n">zeroas</span><span class="p">)</span>
<a name="ln-1997"></a>
<a name="ln-1998"></a><span class="k">end subroutine </span><span class="n">disp_title_scalar_int</span>
<a name="ln-1999"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2000"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2001"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2002"></a><span class="k">subroutine </span><span class="n">disp_vector_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2003"></a>
<a name="ln-2004"></a><span class="c">! ident_4=&quot;@(#)M_display::disp_vector_int(3f): Default integer vector without title&quot;</span>
<a name="ln-2005"></a>
<a name="ln-2006"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2007"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2008"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-2009"></a>
<a name="ln-2010"></a>   <span class="k">call </span><span class="n">disp_title_vector_int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2011"></a>
<a name="ln-2012"></a><span class="k">end subroutine </span><span class="n">disp_vector_int</span>
<a name="ln-2013"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2014"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2015"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2016"></a><span class="k">subroutine </span><span class="n">disp_title_vector_int</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2017"></a><span class="c">! Default integer vector with title</span>
<a name="ln-2018"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2019"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2020"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2021"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-2022"></a><span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2023"></a>
<a name="ln-2024"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2025"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2026"></a><span class="k">      call </span><span class="n">disp_dint</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2027"></a>    <span class="k">else</span>
<a name="ln-2028"></a><span class="k">      call </span><span class="n">disp_dint</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2029"></a>    <span class="k">endif</span>
<a name="ln-2030"></a>
<a name="ln-2031"></a><span class="k">end subroutine </span><span class="n">disp_title_vector_int</span>
<a name="ln-2032"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2033"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2034"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2035"></a><span class="k">subroutine </span><span class="n">disp_matrix_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2036"></a><span class="c">! Default integer matrix without title</span>
<a name="ln-2037"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2038"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2039"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-2040"></a>
<a name="ln-2041"></a>   <span class="k">call </span><span class="n">disp_title_matrix_int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2042"></a>
<a name="ln-2043"></a><span class="k">end subroutine </span><span class="n">disp_matrix_int</span>
<a name="ln-2044"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2045"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2046"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2047"></a><span class="k">subroutine </span><span class="n">disp_title_matrix_int</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2048"></a><span class="c">! Default integer matrix with title</span>
<a name="ln-2049"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>      <span class="c">! The title to use for the matrix</span>
<a name="ln-2050"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>     <span class="c">! The matrix to be written</span>
<a name="ln-2051"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>        <span class="c">! Format edit descriptor to use for each matrix element (e.g.&#39;I4&#39;)</span>
<a name="ln-2052"></a><span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>       <span class="c">! Unit to display on</span>
<a name="ln-2053"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>    <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-2054"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>        <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-2055"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">zeroas</span>     <span class="c">! Zeros are replaced by this string</span>
<a name="ln-2056"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>      <span class="c">! Style(s): See NOTE 1 below</span>
<a name="ln-2057"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>       <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no trimming,</span>
<a name="ln-2058"></a><span class="c">!                                                ! trimming, &#39;yes&#39; for trimming</span>
<a name="ln-2059"></a><span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span>  <span class="c">! Lower bounds of x</span>
<a name="ln-2060"></a><span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2061"></a>
<a name="ln-2062"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="o">=</span><span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2063"></a>    <span class="k">call </span><span class="n">disp_dint</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2064"></a>
<a name="ln-2065"></a><span class="k">end subroutine </span><span class="n">disp_title_matrix_int</span>
<a name="ln-2066"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2067"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2068"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2069"></a><span class="k">subroutine </span><span class="n">disp_dint</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2070"></a><span class="c">! Default integer item</span>
<a name="ln-2071"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2072"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2073"></a><span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2074"></a><span class="kt">integer </span><span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2075"></a>
<a name="ln-2076"></a>   <span class="k">call </span><span class="n">find_editdesc_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span> <span class="c">! determine also SE % w</span>
<a name="ln-2077"></a>   <span class="k">call </span><span class="n">tobox_dint</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2078"></a>
<a name="ln-2079"></a><span class="k">end subroutine </span><span class="n">disp_dint</span>
<a name="ln-2080"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2081"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2082"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2083"></a><span class="k">subroutine </span><span class="n">tobox_dint</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2084"></a><span class="c">! Write default integer matrix to box</span>
<a name="ln-2085"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2086"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2087"></a><span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2088"></a><span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>
<a name="ln-2089"></a><span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>
<a name="ln-2090"></a><span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">s</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2091"></a><span class="kt">integer</span>            <span class="kd">::</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">widp</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<a name="ln-2092"></a><span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-2093"></a>
<a name="ln-2094"></a>   <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2095"></a>   <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2096"></a>   <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2097"></a>   <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-2098"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">x</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-2099"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">replace_zeronaninf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">zas</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">),</span> <span class="n">x</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-2100"></a>     <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2101"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2102"></a>   <span class="k">enddo</span>
<a name="ln-2103"></a><span class="k">   call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2104"></a>
<a name="ln-2105"></a><span class="k">end subroutine </span><span class="n">tobox_dint</span>
<a name="ln-2106"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2107"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2108"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2109"></a><span class="k">subroutine </span><span class="n">find_editdesc_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2110"></a><span class="c">! Determine SE % ed, SE % w (unless specified) and wid</span>
<a name="ln-2111"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2112"></a><span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2113"></a><span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2114"></a><span class="c">!</span>
<a name="ln-2115"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">)</span> <span class="n">xmaxv</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xminv</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xp</span><span class="p">,</span> <span class="n">xm</span>
<a name="ln-2116"></a><span class="kt">logical </span><span class="n">xzero</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xallz</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2117"></a><span class="kt">character</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="n">s</span>
<a name="ln-2118"></a><span class="kt">integer </span><span class="n">ww</span>
<a name="ln-2119"></a><span class="c">!</span>
<a name="ln-2120"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2121"></a><span class="k">     </span><span class="n">xp</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2122"></a>     <span class="n">xm</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2123"></a>     <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;(SS,I0)&#39;</span><span class="p">)</span> <span class="n">xp</span><span class="p">;</span> <span class="n">ww</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-2124"></a>     <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;(SS,I0)&#39;</span><span class="p">)</span> <span class="n">xm</span><span class="p">;</span> <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<a name="ln-2125"></a>     <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2126"></a>     <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2127"></a>   <span class="n">elseif</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! obtain max-width of x</span>
<a name="ln-2128"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2129"></a><span class="k">       </span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;()&#39;</span>
<a name="ln-2130"></a>       <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2131"></a>       <span class="n">wid</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2132"></a>       <span class="k">return</span>
<a name="ln-2133"></a><span class="k">     endif</span>
<a name="ln-2134"></a><span class="k">     </span><span class="n">xp</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2135"></a>     <span class="n">xm</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2136"></a>     <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;(SS,I0)&#39;</span><span class="p">)</span> <span class="n">xp</span><span class="p">;</span> <span class="n">ww</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-2137"></a>     <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;(SS,I0)&#39;</span><span class="p">)</span> <span class="n">xm</span><span class="p">;</span> <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<a name="ln-2138"></a>     <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2139"></a>     <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;(SS,Ixx)&#39;</span>
<a name="ln-2140"></a>     <span class="k">write</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">7</span><span class="p">),</span> <span class="s1">&#39;(SS,I2)&#39;</span><span class="p">)</span> <span class="n">ww</span>
<a name="ln-2141"></a>     <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ww</span>
<a name="ln-2142"></a>   <span class="k">endif</span>
<a name="ln-2143"></a><span class="k">   if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">trm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2144"></a><span class="k">     </span><span class="n">xmaxv</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! max in each column</span>
<a name="ln-2145"></a>     <span class="n">xminv</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! min</span>
<a name="ln-2146"></a>     <span class="n">xzero</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0_dint</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! true where column has some zeros</span>
<a name="ln-2147"></a>     <span class="n">xallz</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0_dint</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! true where column has only zeros</span>
<a name="ln-2148"></a>     <span class="k">call </span><span class="n">getwid_dint</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">,</span> <span class="n">xminv</span><span class="p">,</span> <span class="n">xzero</span><span class="p">,</span> <span class="n">xallz</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span>  <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2149"></a>   <span class="k">else</span>
<a name="ln-2150"></a><span class="k">     </span><span class="n">wid</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-2151"></a>     <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2152"></a>   <span class="k">endif</span>
<a name="ln-2153"></a>
<a name="ln-2154"></a><span class="k">end subroutine </span><span class="n">find_editdesc_dint</span>
<a name="ln-2155"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2156"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2157"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2158"></a><span class="k">subroutine </span><span class="n">getwid_dint</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">,</span> <span class="n">xminv</span><span class="p">,</span> <span class="n">xzero</span><span class="p">,</span> <span class="n">xallz</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span>  <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2159"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xmaxv</span><span class="p">(:),</span> <span class="n">xminv</span><span class="p">(:)</span>
<a name="ln-2160"></a><span class="kt">logical</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xzero</span><span class="p">(:),</span> <span class="n">xallz</span><span class="p">(:)</span> <span class="c">! True for columns with some/all zeros</span>
<a name="ln-2161"></a><span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">SE</span>                 <span class="c">! Settings</span>
<a name="ln-2162"></a><span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>             <span class="c">! Widths of columns</span>
<a name="ln-2163"></a><span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>             <span class="c">! n of blanks to peel from left (w-wid)</span>
<a name="ln-2164"></a><span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span> <span class="kd">::</span> <span class="n">stmax</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">)),</span> <span class="n">stmin</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">))</span>
<a name="ln-2165"></a><span class="kt">integer </span><span class="n">w</span>
<a name="ln-2166"></a>
<a name="ln-2167"></a>   <span class="n">w</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-2168"></a>   <span class="k">write</span><span class="p">(</span><span class="n">stmax</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xmaxv</span>
<a name="ln-2169"></a>   <span class="k">write</span><span class="p">(</span><span class="n">stmin</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xminv</span>
<a name="ln-2170"></a>   <span class="n">nbl</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">stmin</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! loc. of first nonblank</span>
<a name="ln-2171"></a>   <span class="n">nbl</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbl</span><span class="p">,</span> <span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">stmax</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-2172"></a>   <span class="n">wid</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">nbl</span>
<a name="ln-2173"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2174"></a><span class="k">     </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">merge</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">xallz</span><span class="p">)</span>
<a name="ln-2175"></a>     <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">merge</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xzero</span><span class="p">))</span>
<a name="ln-2176"></a>     <span class="n">nbl</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">wid</span>
<a name="ln-2177"></a>   <span class="k">endif</span>
<a name="ln-2178"></a>
<a name="ln-2179"></a><span class="k">end subroutine </span><span class="n">getwid_dint</span>
<a name="ln-2180"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2181"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2182"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2183"></a><span class="c">!&gt;</span>
<a name="ln-2184"></a><span class="c">!!##NAME</span>
<a name="ln-2185"></a><span class="c">!!      tostring(3f) - [M_display] change numbers to a string</span>
<a name="ln-2186"></a><span class="c">!!</span>
<a name="ln-2187"></a><span class="c">!!##INTRODUCTION</span>
<a name="ln-2188"></a><span class="c">!!</span>
<a name="ln-2189"></a><span class="c">!! Many programming languages have built-in functions that change numbers</span>
<a name="ln-2190"></a><span class="c">!! to strings. It is possible to achieve a similar effect in Fortran</span>
<a name="ln-2191"></a><span class="c">!! using internal files and list-directed output:</span>
<a name="ln-2192"></a><span class="c">!!</span>
<a name="ln-2193"></a><span class="c">!!       character(100) s</span>
<a name="ln-2194"></a><span class="c">!!       real :: x = 1.5</span>
<a name="ln-2195"></a><span class="c">!!       write(s, *) &#39;The square of&#39;, x, &#39;is&#39;, x*x</span>
<a name="ln-2196"></a><span class="c">!!       print *, trim(s)</span>
<a name="ln-2197"></a><span class="c">!!</span>
<a name="ln-2198"></a><span class="c">!! but this is cumbersome, and also there is the disadvantage that the result is compiler-dependent.</span>
<a name="ln-2199"></a><span class="c">!! M_display has a function, TOSTRING, which overcomes this disadvantage and offers additional</span>
<a name="ln-2200"></a><span class="c">!! flexibility. With x = 1.5 the following statement will produce the same output as Matlab and Java</span>
<a name="ln-2201"></a><span class="c">!! give:</span>
<a name="ln-2202"></a><span class="c">!!</span>
<a name="ln-2203"></a><span class="c">!!       CALL DISP(&#39;The square of &#39;//TOSTRING(X)//&#39; is &#39;//TOSTRING(X*X))</span>
<a name="ln-2204"></a><span class="c">!!</span>
<a name="ln-2205"></a><span class="c">!! TOSTRING accepts integer, logical or real scalars or vectors. The subroutine TOSTRING_SET may be</span>
<a name="ln-2206"></a><span class="c">!! used to change settings for TOSTRING.</span>
<a name="ln-2207"></a><span class="c">!!</span>
<a name="ln-2208"></a><span class="c">!!</span>
<a name="ln-2209"></a><span class="c">!!##THE FUNCTION TOSTRING</span>
<a name="ln-2210"></a><span class="c">!!</span>
<a name="ln-2211"></a><span class="c">!! Apart from the item to be turned into a string, an edit descriptor to use can optionally be</span>
<a name="ln-2212"></a><span class="c">!! supplied as the second argument to TOSTRING. The two ways to invoke TOSTRING are:</span>
<a name="ln-2213"></a><span class="c">!!</span>
<a name="ln-2214"></a><span class="c">!!       TOSTRING(X)</span>
<a name="ln-2215"></a><span class="c">!!       TOSTRING(X, FMT)</span>
<a name="ln-2216"></a><span class="c">!!</span>
<a name="ln-2217"></a><span class="c">!! These invocations return a character string representing the value of the argument X. When X is a</span>
<a name="ln-2218"></a><span class="c">!! vector individual elements are separated by a string, with the original (or factory) default value</span>
<a name="ln-2219"></a><span class="c">!! &quot;, &quot;. By (original) default G editing is used to convert real numbers, I editing integers, and</span>
<a name="ln-2220"></a><span class="c">!! blanks are trimmed from (each element of) X, both from the left and the right. In addition</span>
<a name="ln-2221"></a><span class="c">!! trailing zeroes are trimmed from the fractional part of real X-elements, as well as a trailing</span>
<a name="ln-2222"></a><span class="c">!! decimal point. The separating string, trimming behavior, and default editing may be changed by</span>
<a name="ln-2223"></a><span class="c">!! calling TOSTRING_SET</span>
<a name="ln-2224"></a><span class="c">!!</span>
<a name="ln-2225"></a><span class="c">!! X     The item to be changed to a string. X may be a scalar or a vector (i.e. of rank 0 or 1) and</span>
<a name="ln-2226"></a><span class="c">!!       of one of the following kinds:</span>
<a name="ln-2227"></a><span class="c">!!</span>
<a name="ln-2228"></a><span class="c">!!         default integer</span>
<a name="ln-2229"></a><span class="c">!!         default real (i.e. real(1.0), single precision)</span>
<a name="ln-2230"></a><span class="c">!!         double precision real (i.e. real(1d0))</span>
<a name="ln-2231"></a><span class="c">!!         default logical</span>
<a name="ln-2232"></a><span class="c">!!</span>
<a name="ln-2233"></a><span class="c">!! FMT   Character string with an edit descriptor used to format each element of X. The possible edit</span>
<a name="ln-2234"></a><span class="c">!!       descriptors are given in section 3.1, except that A and Aw can of course not be used. When</span>
<a name="ln-2235"></a><span class="c">!!       FMT is absent, a default edit descriptor is used. The default may be set by calling</span>
<a name="ln-2236"></a><span class="c">!!       TOSTRING_SET but the original (or factory) defaults are I0 for integers, L1 for logicals and</span>
<a name="ln-2237"></a><span class="c">!!       1PG12.5 for reals.</span>
<a name="ln-2238"></a><span class="c">!!</span>
<a name="ln-2239"></a><span class="c">!!##AUTHOR</span>
<a name="ln-2240"></a><span class="c">!!   Based on dispmodule(3f), &quot;A Fortran 95 module for pretty-printing matrices&quot;.</span>
<a name="ln-2241"></a><span class="c">!!   Version number 1.02 6-Sept-2008, Kristjan Jonasson, Dept. of Computer Science, University of</span>
<a name="ln-2242"></a><span class="c">!!   Iceland (jonasson@hi.is).</span>
<a name="ln-2243"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2244"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2245"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2246"></a>  <span class="c">! ********* DEFAULT INTEGER TOSTRING PROCEDURES *********</span>
<a name="ln-2247"></a>  <span class="k">function </span><span class="n">tostring_s_dint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2248"></a>    <span class="c">! Scalar to string</span>
<a name="ln-2249"></a>    <span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2250"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dint</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2251"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dint</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">)</span>
<a name="ln-2252"></a>  <span class="k">end function </span><span class="n">tostring_s_dint</span>
<a name="ln-2253"></a>
<a name="ln-2254"></a>  <span class="k">function </span><span class="n">tostring_sf_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2255"></a>    <span class="c">! Scalar with specified format to string</span>
<a name="ln-2256"></a>    <span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2257"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2258"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dint</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2259"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dint</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
<a name="ln-2260"></a>  <span class="k">end function </span><span class="n">tostring_sf_dint</span>
<a name="ln-2261"></a>
<a name="ln-2262"></a>  <span class="k">function </span><span class="n">tostring_dint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2263"></a>    <span class="c">! Vector to string</span>
<a name="ln-2264"></a>    <span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2265"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2266"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">ifmt</span><span class="p">)</span>
<a name="ln-2267"></a>  <span class="k">end function </span><span class="n">tostring_dint</span>
<a name="ln-2268"></a>
<a name="ln-2269"></a>  <span class="k">function </span><span class="n">tostring_f_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2270"></a>    <span class="c">! Vector with specified format to string</span>
<a name="ln-2271"></a>    <span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2272"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2273"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span>    <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2274"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2275"></a>    <span class="kt">integer</span>                          <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-2276"></a>    <span class="kt">logical</span>                          <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2277"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-2278"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2279"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">st</span> <span class="o">=</span> <span class="n">errormsg</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-2280"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-2281"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">sa</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<a name="ln-2282"></a>    <span class="k">call </span><span class="n">tostring_get</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-2283"></a>  <span class="k">end function </span><span class="n">tostring_f_dint</span>
<a name="ln-2284"></a>
<a name="ln-2285"></a>  <span class="k">pure function </span><span class="n">len_f_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-2286"></a>    <span class="c">! Total width of tostring representation of x</span>
<a name="ln-2287"></a>    <span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2288"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2289"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2290"></a>    <span class="kt">integer</span>                          <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-2291"></a>    <span class="kt">logical</span>                          <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2292"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-2293"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2294"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-2295"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-2296"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">sa</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<a name="ln-2297"></a>    <span class="n">wtot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sa</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">)</span>
<a name="ln-2298"></a>  <span class="k">end function </span><span class="n">len_f_dint</span>
<a name="ln-2299"></a>
<a name="ln-2300"></a>  <span class="k">pure function </span><span class="n">widthmax_dint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a name="ln-2301"></a>    <span class="c">! Maximum width of string representation of an element in x</span>
<a name="ln-2302"></a>    <span class="kt">integer</span><span class="p">(</span><span class="nb">dint</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2303"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2304"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="n">sx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2305"></a>    <span class="kt">integer </span><span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-2306"></a>    <span class="kt">logical </span><span class="n">gedit</span>
<a name="ln-2307"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-2308"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2309"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2310"></a><span class="k">      write</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="s1">&#39;(SS,I0)&#39;</span><span class="p">)</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2311"></a>      <span class="n">w</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sx</span><span class="p">))</span>
<a name="ln-2312"></a>    <span class="k">endif</span>
<a name="ln-2313"></a><span class="k">  end function </span><span class="n">widthmax_dint</span>
<a name="ln-2314"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2315"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2316"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2317"></a>  <span class="c">! ************************************* END OF DEFAULT INTEGER PROCEDURES ******************************************</span>
<a name="ln-2318"></a>
<a name="ln-2319"></a>  <span class="c">! **************************************** SINGLE PRECISION PROCEDURES *********************************************</span>
<a name="ln-2320"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2321"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2322"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2323"></a>  <span class="k">subroutine </span><span class="n">disp_s_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2324"></a>    <span class="c">! Single precision scalar without title</span>
<a name="ln-2325"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2326"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2327"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-2328"></a>    <span class="k">call </span><span class="n">disp_ts_sngl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2329"></a>  <span class="k">end subroutine </span><span class="n">disp_s_sngl</span>
<a name="ln-2330"></a>
<a name="ln-2331"></a>  <span class="k">subroutine </span><span class="n">disp_v_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2332"></a>    <span class="c">! Single precision vector without title</span>
<a name="ln-2333"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2334"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2335"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-2336"></a>    <span class="k">call </span><span class="n">disp_tv_sngl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2337"></a>  <span class="k">end subroutine </span><span class="n">disp_v_sngl</span>
<a name="ln-2338"></a>
<a name="ln-2339"></a>  <span class="k">subroutine </span><span class="n">disp_m_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2340"></a>    <span class="c">! Single precision matrix without title</span>
<a name="ln-2341"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2342"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2343"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-2344"></a>    <span class="k">call </span><span class="n">disp_tm_sngl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2345"></a>  <span class="k">end subroutine </span><span class="n">disp_m_sngl</span>
<a name="ln-2346"></a>
<a name="ln-2347"></a>  <span class="k">subroutine </span><span class="n">disp_ts_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2348"></a>    <span class="c">! Single precision scalar with title</span>
<a name="ln-2349"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2350"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2351"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2352"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-2353"></a>    <span class="k">call </span><span class="n">disp_tm_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2354"></a>         <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="o">=</span><span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2355"></a>  <span class="k">end subroutine </span><span class="n">disp_ts_sngl</span>
<a name="ln-2356"></a>
<a name="ln-2357"></a>  <span class="k">subroutine </span><span class="n">disp_tv_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2358"></a>    <span class="c">! Single precision vector with title</span>
<a name="ln-2359"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2360"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2361"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2362"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-2363"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2364"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">digmax</span><span class="p">)</span>
<a name="ln-2365"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2366"></a><span class="k">      call </span><span class="n">disp_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2367"></a>    <span class="k">else</span>
<a name="ln-2368"></a><span class="k">      call </span><span class="n">disp_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2369"></a>    <span class="k">endif</span>
<a name="ln-2370"></a><span class="k">  end subroutine </span><span class="n">disp_tv_sngl</span>
<a name="ln-2371"></a>
<a name="ln-2372"></a>  <span class="k">subroutine </span><span class="n">disp_tm_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2373"></a>    <span class="c">! Single precision matrix with title</span>
<a name="ln-2374"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>      <span class="c">! The title to use for the matrix</span>
<a name="ln-2375"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>     <span class="c">! The matrix to be written</span>
<a name="ln-2376"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>        <span class="c">! Editdit descriptor to use for each matrix element (e.g. &#39;F5.2&#39;)</span>
<a name="ln-2377"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>       <span class="c">! Unit to display on</span>
<a name="ln-2378"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">digmax</span>     <span class="c">! Nbr of significant digits for largest abs value in x</span>
<a name="ln-2379"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>    <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-2380"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>        <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-2381"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">zeroas</span>     <span class="c">! Zeros are replaced with this string if it is not empty</span>
<a name="ln-2382"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>      <span class="c">! Style(s): See NOTE 1 below</span>
<a name="ln-2383"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>       <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no</span>
<a name="ln-2384"></a>    <span class="c">!                                                ! trimming, &#39;yes&#39; for trimming</span>
<a name="ln-2385"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span>  <span class="c">! Lower bounds of x</span>
<a name="ln-2386"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2387"></a>    <span class="c">!</span>
<a name="ln-2388"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="o">=</span><span class="n">zeroas</span><span class="p">,</span> <span class="n">digmax</span><span class="o">=</span><span class="n">digmax</span><span class="p">)</span>
<a name="ln-2389"></a>    <span class="k">call </span><span class="n">disp_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2390"></a>  <span class="k">end subroutine </span><span class="n">disp_tm_sngl</span>
<a name="ln-2391"></a>
<a name="ln-2392"></a>  <span class="k">subroutine </span><span class="n">disp_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2393"></a>    <span class="c">! Single precision item</span>
<a name="ln-2394"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2395"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2396"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2397"></a>    <span class="kt">integer </span><span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2398"></a>    <span class="k">call </span><span class="n">find_editdesc_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span> <span class="c">! determine also SE % w</span>
<a name="ln-2399"></a>    <span class="k">call </span><span class="n">tobox_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2400"></a>  <span class="k">end subroutine </span><span class="n">disp_sngl</span>
<a name="ln-2401"></a>
<a name="ln-2402"></a>  <span class="k">subroutine </span><span class="n">tobox_sngl</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2403"></a>    <span class="c">! Write single precision matrix to box</span>
<a name="ln-2404"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>   <span class="c">! title</span>
<a name="ln-2405"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>  <span class="c">! item</span>
<a name="ln-2406"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>      <span class="c">! settings</span>
<a name="ln-2407"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>  <span class="c">! widths of columns</span>
<a name="ln-2408"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>  <span class="c">! number of blanks to trim from left</span>
<a name="ln-2409"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">s</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2410"></a>    <span class="kt">integer</span>            <span class="kd">::</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">widp</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<a name="ln-2411"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-2412"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">xj</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">h</span>
<a name="ln-2413"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2414"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2415"></a>    <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2416"></a>    <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2417"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-2418"></a>      <span class="n">xj</span> <span class="o">=</span> <span class="n">x</span><span class="p">(:,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-2419"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xj</span>
<a name="ln-2420"></a>      <span class="k">call </span><span class="n">replace_zeronaninf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">zas</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">),</span> <span class="n">xj</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xj</span> <span class="o">/=</span> <span class="n">xj</span><span class="p">,</span> <span class="n">xj</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">xj</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">)</span>
<a name="ln-2421"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2422"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2423"></a>    <span class="k">enddo</span>
<a name="ln-2424"></a><span class="k">    call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2425"></a>  <span class="k">end subroutine </span><span class="n">tobox_sngl</span>
<a name="ln-2426"></a>
<a name="ln-2427"></a>  <span class="k">pure function </span><span class="n">maxw_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a name="ln-2428"></a>    <span class="c">! Find max field width needed (F0.d editing is specified)</span>
<a name="ln-2429"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2430"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>
<a name="ln-2431"></a>    <span class="kt">integer </span><span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">,</span> <span class="n">w</span>
<a name="ln-2432"></a>    <span class="kt">logical </span><span class="n">xfinite</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2433"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">)</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">h</span>
<a name="ln-2434"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f1</span><span class="p">,</span> <span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2435"></a>    <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a name="ln-2436"></a>    <span class="n">xfinite</span> <span class="o">=</span> <span class="n">x</span> <span class="o">==</span> <span class="n">x</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="c">! neither NaN, Inf nor -Inf</span>
<a name="ln-2437"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2438"></a><span class="k">      </span><span class="n">w</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-2439"></a>    <span class="k">else</span>
<a name="ln-2440"></a><span class="k">      </span><span class="n">xmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-2441"></a>      <span class="n">xmin</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-2442"></a>      <span class="n">f1</span> <span class="o">=</span> <span class="s1">&#39;(SS,ES9.0E4)&#39;</span>
<a name="ln-2443"></a>      <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span>
<a name="ln-2444"></a>      <span class="k">read</span><span class="p">(</span><span class="n">s</span><span class="p">(:)(</span><span class="mi">5</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;(I5)&#39;</span><span class="p">)</span> <span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span>
<a name="ln-2445"></a>      <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-2446"></a>    <span class="k">endif</span>
<a name="ln-2447"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="k">all</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-2448"></a>  <span class="k">end function </span><span class="n">maxw_sngl</span>
<a name="ln-2449"></a>
<a name="ln-2450"></a>  <span class="k">subroutine </span><span class="n">find_editdesc_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2451"></a>    <span class="c">! Determine SE % ed, SE % w (unless specified) and wid.</span>
<a name="ln-2452"></a>    <span class="c">! The if-block (*) is for safety: make f wider in case xm is written ok with the</span>
<a name="ln-2453"></a>    <span class="c">! ES format in fmt but overflows with F format (the feature has been tested through</span>
<a name="ln-2454"></a>    <span class="c">! manual changes to the program).</span>
<a name="ln-2455"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>         <span class="c">! Item to be written</span>
<a name="ln-2456"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>             <span class="c">! Settings</span>
<a name="ln-2457"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c">! Widths of individual columns</span>
<a name="ln-2458"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c">! Blanks to trim from left of individual columns</span>
<a name="ln-2459"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">dmx</span>
<a name="ln-2460"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">)</span> <span class="n">xmaxv</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xminv</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xp</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">h</span>
<a name="ln-2461"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f1</span> <span class="o">=</span> <span class="s1">&#39;(SS,ESxx.xxE4)&#39;</span>  <span class="c">! could be ES99.89E4; default is ES14.05E4</span>
<a name="ln-2462"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span> <span class="n">s</span>
<a name="ln-2463"></a>    <span class="kt">logical </span><span class="n">xzero</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xallz</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xfinite</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xnonn</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xalln</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2464"></a>    <span class="c">!</span>
<a name="ln-2465"></a>    <span class="n">dmx</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">dmx</span>
<a name="ln-2466"></a>    <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a name="ln-2467"></a>    <span class="n">xfinite</span> <span class="o">=</span> <span class="n">x</span> <span class="o">==</span> <span class="n">x</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="c">! neither NaN, Inf nor -Inf</span>
<a name="ln-2468"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! Edit descriptor &#39;F0.d&#39; specified</span>
<a name="ln-2469"></a>      <span class="n">ww</span> <span class="o">=</span> <span class="n">maxw_sngl</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2470"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._sngl</span><span class="p">))</span>  <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">)</span>
<a name="ln-2471"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2472"></a>      <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ww</span>
<a name="ln-2473"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! No edit descriptor specified</span>
<a name="ln-2474"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2475"></a><span class="k">        </span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2476"></a>        <span class="n">wid</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2477"></a>        <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2478"></a>        <span class="k">return</span>
<a name="ln-2479"></a><span class="k">      endif</span>
<a name="ln-2480"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2481"></a><span class="k">        </span><span class="n">xp</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-2482"></a>        <span class="n">xm</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-2483"></a>        <span class="k">write</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">11</span><span class="p">),</span> <span class="s1">&#39;(SS,I2,&quot;.&quot;,I2.2)&#39;</span><span class="p">)</span> <span class="n">dmx</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">dmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2484"></a>        <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span> <span class="n">xp</span><span class="p">;</span> <span class="k">read</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">dmx</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">dmx</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="s1">&#39;(I5)&#39;</span><span class="p">)</span> <span class="n">expmax</span>
<a name="ln-2485"></a>        <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span> <span class="n">xm</span><span class="p">;</span> <span class="k">read</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">dmx</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">dmx</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="s1">&#39;(I5)&#39;</span><span class="p">)</span> <span class="n">expmin</span>
<a name="ln-2486"></a>        <span class="k">call </span><span class="n">find_editdesc_real</span><span class="p">(</span><span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">,</span> <span class="n">dmx</span><span class="p">,</span>  <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">xm</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-2487"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="k">all</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span>                     <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-2488"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._sngl</span><span class="p">))</span>  <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">)</span>
<a name="ln-2489"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! (*)</span>
<a name="ln-2490"></a>          <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xp</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-2491"></a>          <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xm</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-2492"></a>          <span class="k">write</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;(SS,I2,&quot;.&quot;,I2)&#39;</span><span class="p">)</span> <span class="n">ww</span><span class="p">,</span> <span class="n">dd</span>
<a name="ln-2493"></a>        <span class="k">endif</span>
<a name="ln-2494"></a><span class="k">      else</span>
<a name="ln-2495"></a><span class="k">        </span><span class="n">ww</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-2496"></a>        <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;(F4.0)&#39;</span>
<a name="ln-2497"></a>      <span class="k">endif</span>
<a name="ln-2498"></a><span class="k">      </span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ww</span>
<a name="ln-2499"></a>    <span class="k">endif</span>
<a name="ln-2500"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">trm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2501"></a><span class="k">      </span><span class="n">xmaxv</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>  <span class="c">! max in each column</span>
<a name="ln-2502"></a>      <span class="n">xminv</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>  <span class="c">! min</span>
<a name="ln-2503"></a>      <span class="n">xzero</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._sngl</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! true where column has some zeros</span>
<a name="ln-2504"></a>      <span class="n">xallz</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._sngl</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! true where column has only zeros</span>
<a name="ln-2505"></a>      <span class="n">xnonn</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">/=</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c">! true where column has some nonnormals (inf, -inf, nan)</span>
<a name="ln-2506"></a>      <span class="n">xalln</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">/=</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c">! true where column has only nonnormals (inf, -inf, nan)</span>
<a name="ln-2507"></a>      <span class="k">call </span><span class="n">getwid_sngl</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">,</span> <span class="n">xminv</span><span class="p">,</span> <span class="n">xzero</span><span class="p">,</span> <span class="n">xallz</span><span class="p">,</span> <span class="n">xnonn</span><span class="p">,</span> <span class="n">xalln</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span>  <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2508"></a>    <span class="k">else</span>
<a name="ln-2509"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-2510"></a>      <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2511"></a>    <span class="k">endif</span>
<a name="ln-2512"></a><span class="k">  end subroutine </span><span class="n">find_editdesc_sngl</span>
<a name="ln-2513"></a>
<a name="ln-2514"></a>  <span class="k">subroutine </span><span class="n">getwid_sngl</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">,</span> <span class="n">xminv</span><span class="p">,</span> <span class="n">xzero</span><span class="p">,</span> <span class="n">xallz</span><span class="p">,</span> <span class="n">xnonn</span><span class="p">,</span> <span class="n">xalln</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span>  <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2515"></a>    <span class="c">! determine length of the strings that result when writing with edit descriptor SE%ed a</span>
<a name="ln-2516"></a>    <span class="c">! vector v where v(i) is xmaxv(i) or xminv(i) depending on which gives longer output</span>
<a name="ln-2517"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xmaxv</span><span class="p">(:),</span> <span class="n">xminv</span><span class="p">(:)</span> <span class="c">! max and min values in each column</span>
<a name="ln-2518"></a>    <span class="kt">logical</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xzero</span><span class="p">(:),</span> <span class="n">xallz</span><span class="p">(:)</span> <span class="c">! true for columns with some/all zeros</span>
<a name="ln-2519"></a>    <span class="kt">logical</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xnonn</span><span class="p">(:),</span> <span class="n">xalln</span><span class="p">(:)</span> <span class="c">! true for columns with some/all nonnormals</span>
<a name="ln-2520"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">SE</span>                 <span class="c">! settings</span>
<a name="ln-2521"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>             <span class="c">! widths of columns</span>
<a name="ln-2522"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>             <span class="c">! number of blanks to peel from left (w-wid)</span>
<a name="ln-2523"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span> <span class="kd">::</span> <span class="n">stmax</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">)),</span> <span class="n">stmin</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">))</span>
<a name="ln-2524"></a>    <span class="kt">integer </span><span class="n">w</span>
<a name="ln-2525"></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-2526"></a>    <span class="k">write</span><span class="p">(</span><span class="n">stmin</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xminv</span>
<a name="ln-2527"></a>    <span class="k">write</span><span class="p">(</span><span class="n">stmax</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xmaxv</span>
<a name="ln-2528"></a>    <span class="n">nbl</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">stmin</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! loc. of first nonblank</span>
<a name="ln-2529"></a>    <span class="n">nbl</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbl</span><span class="p">,</span> <span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">stmax</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-2530"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">gedit</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2531"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="n">w</span>
<a name="ln-2532"></a>    <span class="k">else</span>
<a name="ln-2533"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">stmin</span><span class="p">))</span>
<a name="ln-2534"></a>      <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">stmax</span><span class="p">)))</span>
<a name="ln-2535"></a>    <span class="k">endif</span>
<a name="ln-2536"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2537"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">merge</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">xallz</span><span class="p">)</span>
<a name="ln-2538"></a>      <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">merge</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xzero</span><span class="p">))</span>
<a name="ln-2539"></a>    <span class="k">endif</span>
<a name="ln-2540"></a><span class="k">    </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">merge</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">xalln</span><span class="p">)</span>
<a name="ln-2541"></a>    <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">merge</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xnonn</span><span class="p">))</span>
<a name="ln-2542"></a>    <span class="n">nbl</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">wid</span>
<a name="ln-2543"></a>  <span class="k">end subroutine </span><span class="n">getwid_sngl</span>
<a name="ln-2544"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2545"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2546"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2547"></a>  <span class="c">! ******** TOSTRING SINGLE PRECISION PROCEDURES ***********</span>
<a name="ln-2548"></a>  <span class="k">function </span><span class="n">tostring_s_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2549"></a>    <span class="c">! Scalar to string</span>
<a name="ln-2550"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2551"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_sngl</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2552"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_sngl</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-2553"></a>  <span class="k">end function </span><span class="n">tostring_s_sngl</span>
<a name="ln-2554"></a>
<a name="ln-2555"></a>  <span class="k">function </span><span class="n">tostring_sf_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2556"></a>    <span class="c">! Scalar with specified format to string</span>
<a name="ln-2557"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2558"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2559"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_sngl</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2560"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_sngl</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
<a name="ln-2561"></a>  <span class="k">end function </span><span class="n">tostring_sf_sngl</span>
<a name="ln-2562"></a>
<a name="ln-2563"></a>  <span class="k">function </span><span class="n">tostring_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2564"></a>    <span class="c">! Vector to string</span>
<a name="ln-2565"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2566"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2567"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-2568"></a>  <span class="k">end function </span><span class="n">tostring_sngl</span>
<a name="ln-2569"></a>
<a name="ln-2570"></a>  <span class="k">function </span><span class="n">tostring_f_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2571"></a>    <span class="c">! Vector with specified format to string</span>
<a name="ln-2572"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">)</span>    <span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2573"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>         <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2574"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span>    <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2575"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2576"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt1</span>  <span class="c">!(5 for readfmt and 3 for replace_w)</span>
<a name="ln-2577"></a>    <span class="kt">integer</span>                          <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ww</span>
<a name="ln-2578"></a>    <span class="kt">logical</span>                          <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2579"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2580"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2581"></a><span class="k">      </span><span class="n">st</span> <span class="o">=</span> <span class="n">errormsg</span>
<a name="ln-2582"></a>      <span class="k">return</span>
<a name="ln-2583"></a><span class="k">    </span><span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2584"></a><span class="k">      </span><span class="n">ww</span> <span class="o">=</span> <span class="n">maxw_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2585"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2586"></a>    <span class="k">endif</span>
<a name="ln-2587"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-2588"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-2589"></a>    <span class="k">call </span><span class="n">tostring_get</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-2590"></a>  <span class="k">end function </span><span class="n">tostring_f_sngl</span>
<a name="ln-2591"></a>
<a name="ln-2592"></a>  <span class="k">pure function </span><span class="n">len_f_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-2593"></a>    <span class="c">! Total length of returned string, vector s</span>
<a name="ln-2594"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2595"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2596"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2597"></a>    <span class="kt">integer</span>                          <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ww</span>
<a name="ln-2598"></a>    <span class="kt">logical</span>                          <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2599"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt1</span>  <span class="c">!(5 for readfmt and 3 for replace_w)</span>
<a name="ln-2600"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2601"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-2602"></a><span class="k">    if</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2603"></a><span class="k">      </span><span class="n">ww</span> <span class="o">=</span> <span class="n">maxw_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2604"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2605"></a>    <span class="k">endif</span>
<a name="ln-2606"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-2607"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-2608"></a>    <span class="n">wtot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sa</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">)</span>
<a name="ln-2609"></a>  <span class="k">end function </span><span class="n">len_f_sngl</span>
<a name="ln-2610"></a>
<a name="ln-2611"></a>  <span class="k">pure function </span><span class="n">widthmax_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a name="ln-2612"></a>    <span class="c">! Maximum width of an element of x</span>
<a name="ln-2613"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2614"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2615"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-2616"></a>    <span class="kt">integer </span><span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-2617"></a>    <span class="kt">logical </span><span class="n">gedit</span>
<a name="ln-2618"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2619"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! illegal format, use 1</span>
<a name="ln-2620"></a>      <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2621"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2622"></a><span class="k">      </span><span class="n">w</span> <span class="o">=</span> <span class="n">maxw_sngl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2623"></a>    <span class="k">endif</span>
<a name="ln-2624"></a><span class="k">  end function </span><span class="n">widthmax_sngl</span>
<a name="ln-2625"></a>  <span class="c">! *************************************** END OF SINGLE PRECISION PROCEDURES ***************************************</span>
<a name="ln-2626"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2627"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2628"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2629"></a>  <span class="c">! *************************************** SINGLE PRECISION COMPLEX PROCEDURES **************************************</span>
<a name="ln-2630"></a>  <span class="k">subroutine </span><span class="n">disp_s_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-2631"></a>    <span class="c">! single precision complex scalar without title</span>
<a name="ln-2632"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-2633"></a><span class="nb">    </span><span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2634"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-2635"></a>    <span class="k">call </span><span class="n">disp_ts_cplx</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-2636"></a>  <span class="k">end subroutine </span><span class="n">disp_s_cplx</span>
<a name="ln-2637"></a>
<a name="ln-2638"></a>  <span class="k">subroutine </span><span class="n">disp_v_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-2639"></a>    <span class="c">! single precision complex vector without title</span>
<a name="ln-2640"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2641"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2642"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-2643"></a>    <span class="k">call </span><span class="n">disp_tv_cplx</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-2644"></a>  <span class="k">end subroutine </span><span class="n">disp_v_cplx</span>
<a name="ln-2645"></a>
<a name="ln-2646"></a>  <span class="k">subroutine </span><span class="n">disp_m_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-2647"></a>    <span class="c">! single precision complex matrix without title</span>
<a name="ln-2648"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-2649"></a><span class="nb">    </span><span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2650"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-2651"></a>    <span class="k">call </span><span class="n">disp_tm_cplx</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-2652"></a>  <span class="k">end subroutine </span><span class="n">disp_m_cplx</span>
<a name="ln-2653"></a>
<a name="ln-2654"></a>  <span class="k">subroutine </span><span class="n">disp_ts_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-2655"></a>    <span class="c">! single precision complex scalar with title</span>
<a name="ln-2656"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2657"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-2658"></a><span class="nb">    </span><span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2659"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-2660"></a>    <span class="k">call </span><span class="n">disp_tm_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2661"></a>                                                       <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-2662"></a>  <span class="k">end subroutine </span><span class="n">disp_ts_cplx</span>
<a name="ln-2663"></a>
<a name="ln-2664"></a>  <span class="k">subroutine </span><span class="n">disp_tv_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-2665"></a>    <span class="c">! single precision complex vector with title</span>
<a name="ln-2666"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2667"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2668"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2669"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-2670"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-2671"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">digmax</span><span class="o">=</span><span class="n">digmax</span><span class="p">)</span>
<a name="ln-2672"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt_imag</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2673"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2674"></a><span class="k">        call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, FMT must be present if FMT_IMAG is present&#39;</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span>
<a name="ln-2675"></a>      <span class="k">endif</span>
<a name="ln-2676"></a><span class="k">      call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SEim</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt_imag</span><span class="p">)</span>
<a name="ln-2677"></a>    <span class="k">else</span>
<a name="ln-2678"></a><span class="k">      </span><span class="n">SEim</span> <span class="o">=</span> <span class="n">SE</span>
<a name="ln-2679"></a>    <span class="k">endif</span>
<a name="ln-2680"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2681"></a><span class="k">      call </span><span class="n">disp_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2682"></a>    <span class="k">else</span>
<a name="ln-2683"></a><span class="k">      call </span><span class="n">disp_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-2684"></a>    <span class="k">endif</span>
<a name="ln-2685"></a><span class="k">  end subroutine </span><span class="n">disp_tv_cplx</span>
<a name="ln-2686"></a>
<a name="ln-2687"></a>  <span class="k">subroutine </span><span class="n">disp_tm_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-2688"></a>    <span class="c">! single precision complex matrix with title</span>
<a name="ln-2689"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>      <span class="c">! The title to use for the matrix</span>
<a name="ln-2690"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>     <span class="c">! The matrix to be written</span>
<a name="ln-2691"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>        <span class="c">! Edit descriptor for each element (real element when fmt_imag &amp;</span>
<a name="ln-2692"></a>    <span class="c">!                                                ! is present)</span>
<a name="ln-2693"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt_imag</span>   <span class="c">! Edit descriptor for each imaginary element</span>
<a name="ln-2694"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>       <span class="c">! Unit to display on</span>
<a name="ln-2695"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">digmax</span>     <span class="c">! Nbr of significant digits for largest abs value in real(x) &amp;</span>
<a name="ln-2696"></a>    <span class="c">!                                                ! and aimag(x)</span>
<a name="ln-2697"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>    <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-2698"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>        <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-2699"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>      <span class="c">! Style(s): See NOTE 1 below</span>
<a name="ln-2700"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>       <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no</span>
<a name="ln-2701"></a>    <span class="c">!                                                ! trimming, &#39;yes&#39; for trimming</span>
<a name="ln-2702"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span>  <span class="c">! Lower bounds of x</span>
<a name="ln-2703"></a>    <span class="c">!</span>
<a name="ln-2704"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-2705"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="o">=</span><span class="n">digmax</span><span class="p">)</span>
<a name="ln-2706"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt_imag</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2707"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2708"></a><span class="k">        call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, FMT must be present if FMT_IMAG is present&#39;</span><span class="p">);</span> <span class="k">return</span>
<a name="ln-2709"></a><span class="k">      endif</span>
<a name="ln-2710"></a><span class="k">      call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SEim</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt_imag</span><span class="p">)</span>
<a name="ln-2711"></a>    <span class="k">else</span>
<a name="ln-2712"></a><span class="k">      </span><span class="n">SEim</span> <span class="o">=</span> <span class="n">SE</span>
<a name="ln-2713"></a>    <span class="k">endif</span>
<a name="ln-2714"></a><span class="k">    call </span><span class="n">disp_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2715"></a>  <span class="k">end subroutine </span><span class="n">disp_tm_cplx</span>
<a name="ln-2716"></a>
<a name="ln-2717"></a>  <span class="k">subroutine </span><span class="n">disp_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-2718"></a>    <span class="c">! Single precision item</span>
<a name="ln-2719"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2720"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2721"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-2722"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">n</span>
<a name="ln-2723"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="kd">::</span> <span class="n">widre</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">widim</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">nblre</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">nblim</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-2724"></a>    <span class="k">call </span><span class="n">find_editdesc_sngl</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">SE</span><span class="p">,</span> <span class="n">widre</span><span class="p">,</span> <span class="n">nblre</span><span class="p">)</span>         <span class="c">! determine also SE % w</span>
<a name="ln-2725"></a>    <span class="k">call </span><span class="n">find_editdesc_sngl</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">widim</span><span class="p">,</span> <span class="n">nblim</span><span class="p">)</span> <span class="c">! determine also SEim % w</span>
<a name="ln-2726"></a>    <span class="k">call </span><span class="n">tobox_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">widre</span><span class="p">,</span> <span class="n">widim</span><span class="p">,</span> <span class="n">nblre</span><span class="p">,</span> <span class="n">nblim</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2727"></a>  <span class="k">end subroutine </span><span class="n">disp_cplx</span>
<a name="ln-2728"></a>
<a name="ln-2729"></a>  <span class="k">subroutine </span><span class="n">tobox_cplx</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">widre</span><span class="p">,</span> <span class="n">widim</span><span class="p">,</span> <span class="n">nblre</span><span class="p">,</span> <span class="n">nblim</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-2730"></a>    <span class="c">! Write single precision complex matrix to box</span>
<a name="ln-2731"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2732"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2733"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">widre</span><span class="p">(:),</span> <span class="n">widim</span><span class="p">(:),</span> <span class="n">nblre</span><span class="p">(:),</span> <span class="n">nblim</span><span class="p">(:)</span>
<a name="ln-2734"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-2735"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">s</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a name="ln-2736"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SEim</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a name="ln-2737"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">sgn</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a name="ln-2738"></a>    <span class="kt">integer</span>             <span class="kd">::</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-2739"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span>  <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-2740"></a>    <span class="n">SE</span> <span class="p">%</span> <span class="n">zas</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-2741"></a>    <span class="n">SEim</span> <span class="p">%</span> <span class="n">zas</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-2742"></a>    <span class="n">wid</span> <span class="o">=</span> <span class="n">widre</span> <span class="o">+</span> <span class="n">widim</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-2743"></a>    <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2744"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-2745"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a name="ln-2746"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">widre</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">widim</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nblre</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2747"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span>
<a name="ln-2748"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-2749"></a><span class="k">        enddo</span>
<a name="ln-2750"></a><span class="k">      call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">sgn</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2751"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">SEim</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a name="ln-2752"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">widim</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widim</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nblim</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2753"></a>      <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span> <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2754"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2755"></a>    <span class="k">enddo</span>
<a name="ln-2756"></a><span class="k">    call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2757"></a>  <span class="k">end subroutine </span><span class="n">tobox_cplx</span>
<a name="ln-2758"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2759"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2760"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2761"></a>
<a name="ln-2762"></a>  <span class="c">! ******* TOSTRING SINGLE PRECISION COMPLEX PROCEDURES ********</span>
<a name="ln-2763"></a>
<a name="ln-2764"></a>  <span class="k">function </span><span class="n">tostring_s_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2765"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2766"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_s_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2767"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_cplx</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-2768"></a>  <span class="k">end function </span><span class="n">tostring_s_cplx</span>
<a name="ln-2769"></a>
<a name="ln-2770"></a>  <span class="k">function </span><span class="n">tostring_sf_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2771"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2772"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2773"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_s_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2774"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_cplx</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
<a name="ln-2775"></a>  <span class="k">end function </span><span class="n">tostring_sf_cplx</span>
<a name="ln-2776"></a>
<a name="ln-2777"></a>  <span class="k">function </span><span class="n">tostring_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2778"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2779"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2780"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-2781"></a>  <span class="k">end function </span><span class="n">tostring_cplx</span>
<a name="ln-2782"></a>
<a name="ln-2783"></a>  <span class="k">function </span><span class="n">tostring_f_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-2784"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2785"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2786"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span>                 <span class="kd">::</span> <span class="n">st</span>
<a name="ln-2787"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_sngl</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">))</span>        <span class="kd">::</span> <span class="n">sar</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2788"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_sngl</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sai</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c">! x-real(x) instead of aimag(x) to enable the function</span>
<a name="ln-2789"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">sgn</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c">! to pass -stand:f95 switch of the ifort compiler.</span>
<a name="ln-2790"></a>    <span class="kt">integer</span>                                       <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">i</span>
<a name="ln-2791"></a>    <span class="kt">logical</span>                                       <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2792"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">fmt1</span>  <span class="c">!(5 for readfmt and 3 for replace_w)</span>
<a name="ln-2793"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">sngl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">xre</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">xim</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">h</span>
<a name="ln-2794"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2795"></a>    <span class="n">xre</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2796"></a>    <span class="n">xim</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2797"></a>    <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a name="ln-2798"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2799"></a><span class="k">      </span><span class="n">st</span> <span class="o">=</span> <span class="n">errormsg</span>
<a name="ln-2800"></a>      <span class="k">return</span>
<a name="ln-2801"></a><span class="k">    </span><span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2802"></a><span class="k">      </span><span class="n">wr</span> <span class="o">=</span> <span class="n">maxw_sngl</span><span class="p">(</span><span class="n">xre</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2803"></a>      <span class="n">wi</span> <span class="o">=</span> <span class="n">maxw_sngl</span><span class="p">(</span><span class="n">xim</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2804"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">wr</span><span class="p">,</span> <span class="n">wi</span><span class="p">))</span>
<a name="ln-2805"></a>    <span class="k">endif</span>
<a name="ln-2806"></a><span class="k">    write</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2807"></a>    <span class="k">write</span><span class="p">(</span><span class="n">sai</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2808"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-2809"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sai</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-2810"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">;</span> <span class="k">endif</span><span class="p">;</span> <span class="k">enddo</span>
<a name="ln-2811"></a><span class="k">    call </span><span class="n">tostring_get_complex</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">sgn</span><span class="p">,</span> <span class="n">sai</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-2812"></a>  <span class="k">end function </span><span class="n">tostring_f_cplx</span>
<a name="ln-2813"></a>
<a name="ln-2814"></a>  <span class="k">pure function </span><span class="n">len_s_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-2815"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2816"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2817"></a>    <span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-2818"></a>    <span class="kt">logical</span>                   <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2819"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-2820"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2821"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-2822"></a><span class="k">    </span><span class="n">wtot</span> <span class="o">=</span> <span class="n">len_f_sngl</span><span class="p">([</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">len_f_sngl</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">))],</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-2823"></a>  <span class="k">end function </span><span class="n">len_s_cplx</span>
<a name="ln-2824"></a>
<a name="ln-2825"></a>  <span class="k">pure function </span><span class="n">len_f_cplx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-2826"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">sngl</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2827"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-2828"></a>    <span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-2829"></a>    <span class="kt">logical</span>                   <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-2830"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-2831"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-2832"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-2833"></a><span class="k">    </span><span class="n">wtot</span> <span class="o">=</span> <span class="n">len_f_sngl</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">len_f_sngl</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">)</span>
<a name="ln-2834"></a>    <span class="c">! subtract seplen because it has been added twice in len_f_sngl</span>
<a name="ln-2835"></a>  <span class="k">end function </span><span class="n">len_f_cplx</span>
<a name="ln-2836"></a>  <span class="c">! *************************************** END OF SINGLE PRECISION COMPLEX PROCEDURES ********************************</span>
<a name="ln-2837"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2838"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2839"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2840"></a>
<a name="ln-2841"></a>  <span class="c">! ************************************* DOUBLE PRECISION PROCEDURES (SEE NOTE 2 BELOW) ******************************</span>
<a name="ln-2842"></a>  <span class="k">subroutine </span><span class="n">disp_s_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2843"></a>    <span class="c">! Double precision scalar without title</span>
<a name="ln-2844"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2845"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2846"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-2847"></a>    <span class="k">call </span><span class="n">disp_ts_dble</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2848"></a>  <span class="k">end subroutine </span><span class="n">disp_s_dble</span>
<a name="ln-2849"></a>
<a name="ln-2850"></a>  <span class="k">subroutine </span><span class="n">disp_v_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2851"></a>    <span class="c">! Double precision vector without title</span>
<a name="ln-2852"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2853"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2854"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-2855"></a>    <span class="k">call </span><span class="n">disp_tv_dble</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2856"></a>  <span class="k">end subroutine </span><span class="n">disp_v_dble</span>
<a name="ln-2857"></a>
<a name="ln-2858"></a>  <span class="k">subroutine </span><span class="n">disp_m_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2859"></a>    <span class="c">! Double precision matrix without title</span>
<a name="ln-2860"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2861"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2862"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-2863"></a>    <span class="k">call </span><span class="n">disp_tm_dble</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2864"></a>  <span class="k">end subroutine </span><span class="n">disp_m_dble</span>
<a name="ln-2865"></a>
<a name="ln-2866"></a>  <span class="k">subroutine </span><span class="n">disp_ts_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2867"></a>    <span class="c">! Double precision scalar with title</span>
<a name="ln-2868"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2869"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span>
<a name="ln-2870"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-2871"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-2872"></a>    <span class="k">call </span><span class="n">disp_tm_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2873"></a>         <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="o">=</span><span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2874"></a>  <span class="k">end subroutine </span><span class="n">disp_ts_dble</span>
<a name="ln-2875"></a>
<a name="ln-2876"></a>  <span class="k">subroutine </span><span class="n">disp_tv_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2877"></a>    <span class="c">! Double precision vector with title</span>
<a name="ln-2878"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2879"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-2880"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2881"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-2882"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2883"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">,</span> <span class="n">digmax</span><span class="p">)</span>
<a name="ln-2884"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2885"></a><span class="k">      call </span><span class="n">disp_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2886"></a>    <span class="k">else</span>
<a name="ln-2887"></a><span class="k">      call </span><span class="n">disp_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2888"></a>    <span class="k">endif</span>
<a name="ln-2889"></a><span class="k">  end subroutine </span><span class="n">disp_tv_dble</span>
<a name="ln-2890"></a>
<a name="ln-2891"></a>  <span class="k">subroutine </span><span class="n">disp_tm_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="p">)</span>
<a name="ln-2892"></a>    <span class="c">! Double precision matrix with title</span>
<a name="ln-2893"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>      <span class="c">! The title to use for the matrix</span>
<a name="ln-2894"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>     <span class="c">! The matrix to be written</span>
<a name="ln-2895"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>        <span class="c">! Editdit descriptor to use for each matrix element (e.g. &#39;F5.2&#39;)</span>
<a name="ln-2896"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>       <span class="c">! Unit to display on</span>
<a name="ln-2897"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">digmax</span>     <span class="c">! Nbr of significant digits for largest abs value in x</span>
<a name="ln-2898"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>    <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-2899"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>        <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-2900"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">zeroas</span>     <span class="c">! Zeros are replaced with this string if it is not empty</span>
<a name="ln-2901"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>      <span class="c">! Style(s): See NOTE 1 below</span>
<a name="ln-2902"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>       <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no</span>
<a name="ln-2903"></a>    <span class="c">!                                                ! trimming, &#39;yes&#39; for trimming</span>
<a name="ln-2904"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span>  <span class="c">! Lower bounds of x</span>
<a name="ln-2905"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2906"></a>    <span class="c">!</span>
<a name="ln-2907"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">zeroas</span><span class="o">=</span><span class="n">zeroas</span><span class="p">,</span> <span class="n">digmax</span><span class="o">=</span><span class="n">digmax</span><span class="p">)</span>
<a name="ln-2908"></a>    <span class="k">call </span><span class="n">disp_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2909"></a>  <span class="k">end subroutine </span><span class="n">disp_tm_dble</span>
<a name="ln-2910"></a>
<a name="ln-2911"></a>  <span class="k">subroutine </span><span class="n">disp_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-2912"></a>    <span class="c">! Double precision item</span>
<a name="ln-2913"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-2914"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-2915"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-2916"></a>    <span class="kt">integer </span><span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2917"></a>    <span class="k">call </span><span class="n">find_editdesc_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span> <span class="c">! determine also SE % w</span>
<a name="ln-2918"></a>    <span class="k">call </span><span class="n">tobox_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2919"></a>  <span class="k">end subroutine </span><span class="n">disp_dble</span>
<a name="ln-2920"></a>
<a name="ln-2921"></a>  <span class="k">subroutine </span><span class="n">tobox_dble</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2922"></a>    <span class="c">! Write double precision matrix to box</span>
<a name="ln-2923"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>   <span class="c">! title</span>
<a name="ln-2924"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>  <span class="c">! item</span>
<a name="ln-2925"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>      <span class="c">! settings</span>
<a name="ln-2926"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>  <span class="c">! widths of columns</span>
<a name="ln-2927"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>  <span class="c">! number of blanks to trim from left</span>
<a name="ln-2928"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">s</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2929"></a>    <span class="kt">integer</span>            <span class="kd">::</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">widp</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<a name="ln-2930"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-2931"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">xj</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">h</span>
<a name="ln-2932"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2933"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2934"></a>    <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2935"></a>    <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2936"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-2937"></a>      <span class="n">xj</span> <span class="o">=</span> <span class="n">x</span><span class="p">(:,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-2938"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xj</span>
<a name="ln-2939"></a>      <span class="k">call </span><span class="n">replace_zeronaninf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">zas</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">),</span> <span class="n">xj</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xj</span> <span class="o">/=</span> <span class="n">xj</span><span class="p">,</span> <span class="n">xj</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">xj</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">)</span>
<a name="ln-2940"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2941"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-2942"></a>    <span class="k">enddo</span>
<a name="ln-2943"></a><span class="k">    call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-2944"></a>  <span class="k">end subroutine </span><span class="n">tobox_dble</span>
<a name="ln-2945"></a>
<a name="ln-2946"></a>  <span class="k">pure function </span><span class="n">maxw_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a name="ln-2947"></a>    <span class="c">! Find max field width needed (F0.d editing is specified)</span>
<a name="ln-2948"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-2949"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>
<a name="ln-2950"></a>    <span class="kt">integer </span><span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">,</span> <span class="n">w</span>
<a name="ln-2951"></a>    <span class="kt">logical </span><span class="n">xfinite</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-2952"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">)</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">h</span>
<a name="ln-2953"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f1</span><span class="p">,</span> <span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2954"></a>    <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a name="ln-2955"></a>    <span class="n">xfinite</span> <span class="o">=</span> <span class="n">x</span> <span class="o">==</span> <span class="n">x</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="c">! neither NaN, Inf nor -Inf</span>
<a name="ln-2956"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2957"></a><span class="k">      </span><span class="n">w</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-2958"></a>    <span class="k">else</span>
<a name="ln-2959"></a><span class="k">      </span><span class="n">xmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-2960"></a>      <span class="n">xmin</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-2961"></a>      <span class="n">f1</span> <span class="o">=</span> <span class="s1">&#39;(SS,ES9.0E4)&#39;</span>
<a name="ln-2962"></a>      <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span>
<a name="ln-2963"></a>      <span class="k">read</span><span class="p">(</span><span class="n">s</span><span class="p">(:)(</span><span class="mi">5</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;(I5)&#39;</span><span class="p">)</span> <span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span>
<a name="ln-2964"></a>      <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-2965"></a>    <span class="k">endif</span>
<a name="ln-2966"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="k">all</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-2967"></a>  <span class="k">end function </span><span class="n">maxw_dble</span>
<a name="ln-2968"></a>
<a name="ln-2969"></a>  <span class="k">subroutine </span><span class="n">find_editdesc_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-2970"></a>    <span class="c">! Determine SE % ed, SE % w (unless specified) and wid.</span>
<a name="ln-2971"></a>    <span class="c">! The if-block (*) is for safety: make f wider in case xm is written ok with the</span>
<a name="ln-2972"></a>    <span class="c">! ES format in fmt but overflows with F format (the feature has been tested through</span>
<a name="ln-2973"></a>    <span class="c">! manual changes to the program).</span>
<a name="ln-2974"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>         <span class="c">! Item to be written</span>
<a name="ln-2975"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>             <span class="c">! Settings</span>
<a name="ln-2976"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c">! Widths of individual columns</span>
<a name="ln-2977"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c">! Blanks to trim from left of individual columns</span>
<a name="ln-2978"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">dmx</span>
<a name="ln-2979"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">)</span> <span class="n">xmaxv</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xminv</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xp</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">h</span>
<a name="ln-2980"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f1</span> <span class="o">=</span> <span class="s1">&#39;(SS,ESxx.xxE4)&#39;</span>  <span class="c">! could be ES99.89E4; default is ES14.05E4</span>
<a name="ln-2981"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span> <span class="n">s</span>
<a name="ln-2982"></a>    <span class="kt">logical </span><span class="n">xzero</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xallz</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xfinite</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xnonn</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">xalln</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-2983"></a>    <span class="c">!</span>
<a name="ln-2984"></a>    <span class="n">dmx</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">dmx</span>
<a name="ln-2985"></a>    <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a name="ln-2986"></a>    <span class="n">xfinite</span> <span class="o">=</span> <span class="n">x</span> <span class="o">==</span> <span class="n">x</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="c">! neither NaN, Inf nor -Inf</span>
<a name="ln-2987"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! Edit descriptor &#39;F0.d&#39; specified</span>
<a name="ln-2988"></a>      <span class="n">ww</span> <span class="o">=</span> <span class="n">maxw_dble</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-2989"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._dble</span><span class="p">))</span>  <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">)</span>
<a name="ln-2990"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-2991"></a>      <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ww</span>
<a name="ln-2992"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! No edit descriptor specified</span>
<a name="ln-2993"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2994"></a><span class="k">        </span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2995"></a>        <span class="n">wid</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2996"></a>        <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2997"></a>        <span class="k">return</span>
<a name="ln-2998"></a><span class="k">      endif</span>
<a name="ln-2999"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3000"></a><span class="k">        </span><span class="n">xp</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-3001"></a>        <span class="n">xm</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>
<a name="ln-3002"></a>        <span class="k">write</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">11</span><span class="p">),</span> <span class="s1">&#39;(SS,I2,&quot;.&quot;,I2.2)&#39;</span><span class="p">)</span> <span class="n">dmx</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">dmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3003"></a>        <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span> <span class="n">xp</span><span class="p">;</span> <span class="k">read</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">dmx</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">dmx</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="s1">&#39;(I5)&#39;</span><span class="p">)</span> <span class="n">expmax</span>
<a name="ln-3004"></a>        <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span> <span class="n">xm</span><span class="p">;</span> <span class="k">read</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">dmx</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">dmx</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="s1">&#39;(I5)&#39;</span><span class="p">)</span> <span class="n">expmin</span>
<a name="ln-3005"></a>        <span class="k">call </span><span class="n">find_editdesc_real</span><span class="p">(</span><span class="n">expmax</span><span class="p">,</span> <span class="n">expmin</span><span class="p">,</span> <span class="n">dmx</span><span class="p">,</span>  <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">xm</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3006"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="k">all</span><span class="p">(</span><span class="n">xfinite</span><span class="p">))</span>                     <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-3007"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._dble</span><span class="p">))</span>  <span class="n">ww</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">)</span>
<a name="ln-3008"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! (*)</span>
<a name="ln-3009"></a>          <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xp</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3010"></a>          <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xm</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3011"></a>          <span class="k">write</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;(SS,I2,&quot;.&quot;,I2)&#39;</span><span class="p">)</span> <span class="n">ww</span><span class="p">,</span> <span class="n">dd</span>
<a name="ln-3012"></a>        <span class="k">endif</span>
<a name="ln-3013"></a><span class="k">      else</span>
<a name="ln-3014"></a><span class="k">        </span><span class="n">ww</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-3015"></a>        <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;(F4.0)&#39;</span>
<a name="ln-3016"></a>      <span class="k">endif</span>
<a name="ln-3017"></a><span class="k">      </span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ww</span>
<a name="ln-3018"></a>    <span class="k">endif</span>
<a name="ln-3019"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">trm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3020"></a><span class="k">      </span><span class="n">xmaxv</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>  <span class="c">! max in each column</span>
<a name="ln-3021"></a>      <span class="n">xminv</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">xfinite</span><span class="p">)</span>  <span class="c">! min</span>
<a name="ln-3022"></a>      <span class="n">xzero</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._dble</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! true where column has some zeros</span>
<a name="ln-3023"></a>      <span class="n">xallz</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0._dble</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! true where column has only zeros</span>
<a name="ln-3024"></a>      <span class="n">xnonn</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">/=</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c">! true where column has some nonnormals (inf, -inf, nan)</span>
<a name="ln-3025"></a>      <span class="n">xalln</span> <span class="o">=</span> <span class="k">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">h</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">x</span> <span class="o">/=</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c">! true where column has only nonnormals (inf, -inf, nan)</span>
<a name="ln-3026"></a>      <span class="k">call </span><span class="n">getwid_dble</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">,</span> <span class="n">xminv</span><span class="p">,</span> <span class="n">xzero</span><span class="p">,</span> <span class="n">xallz</span><span class="p">,</span> <span class="n">xnonn</span><span class="p">,</span> <span class="n">xalln</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span>  <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-3027"></a>    <span class="k">else</span>
<a name="ln-3028"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-3029"></a>      <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3030"></a>    <span class="k">endif</span>
<a name="ln-3031"></a><span class="k">  end subroutine </span><span class="n">find_editdesc_dble</span>
<a name="ln-3032"></a>
<a name="ln-3033"></a>  <span class="k">subroutine </span><span class="n">getwid_dble</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">,</span> <span class="n">xminv</span><span class="p">,</span> <span class="n">xzero</span><span class="p">,</span> <span class="n">xallz</span><span class="p">,</span> <span class="n">xnonn</span><span class="p">,</span> <span class="n">xalln</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span>  <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-3034"></a>    <span class="c">! determine length of the strings that result when writing with edit descriptor SE%ed a</span>
<a name="ln-3035"></a>    <span class="c">! vector v where v(i) is xmaxv(i) or xminv(i) depending on which gives longer output</span>
<a name="ln-3036"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xmaxv</span><span class="p">(:),</span> <span class="n">xminv</span><span class="p">(:)</span> <span class="c">! max and min values in each column</span>
<a name="ln-3037"></a>    <span class="kt">logical</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xzero</span><span class="p">(:),</span> <span class="n">xallz</span><span class="p">(:)</span> <span class="c">! true for columns with some/all zeros</span>
<a name="ln-3038"></a>    <span class="kt">logical</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xnonn</span><span class="p">(:),</span> <span class="n">xalln</span><span class="p">(:)</span> <span class="c">! true for columns with some/all nonnormals</span>
<a name="ln-3039"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">SE</span>                 <span class="c">! settings</span>
<a name="ln-3040"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>             <span class="c">! widths of columns</span>
<a name="ln-3041"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>             <span class="c">! number of blanks to peel from left (w-wid)</span>
<a name="ln-3042"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span> <span class="kd">::</span> <span class="n">stmax</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">)),</span> <span class="n">stmin</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">xmaxv</span><span class="p">))</span>
<a name="ln-3043"></a>    <span class="kt">integer </span><span class="n">w</span>
<a name="ln-3044"></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-3045"></a>    <span class="k">write</span><span class="p">(</span><span class="n">stmin</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xminv</span>
<a name="ln-3046"></a>    <span class="k">write</span><span class="p">(</span><span class="n">stmax</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="n">xmaxv</span>
<a name="ln-3047"></a>    <span class="n">nbl</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">stmin</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! loc. of first nonblank</span>
<a name="ln-3048"></a>    <span class="n">nbl</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbl</span><span class="p">,</span> <span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">stmax</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-3049"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">gedit</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3050"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="n">w</span>
<a name="ln-3051"></a>    <span class="k">else</span>
<a name="ln-3052"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">stmin</span><span class="p">))</span>
<a name="ln-3053"></a>      <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">stmax</span><span class="p">)))</span>
<a name="ln-3054"></a>    <span class="k">endif</span>
<a name="ln-3055"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3056"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">merge</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">xallz</span><span class="p">)</span>
<a name="ln-3057"></a>      <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">merge</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lzas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xzero</span><span class="p">))</span>
<a name="ln-3058"></a>    <span class="k">endif</span>
<a name="ln-3059"></a><span class="k">    </span><span class="n">wid</span> <span class="o">=</span> <span class="nb">merge</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">xalln</span><span class="p">)</span>
<a name="ln-3060"></a>    <span class="n">wid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="nb">merge</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xnonn</span><span class="p">))</span>
<a name="ln-3061"></a>    <span class="n">nbl</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">wid</span>
<a name="ln-3062"></a>  <span class="k">end subroutine </span><span class="n">getwid_dble</span>
<a name="ln-3063"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3064"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3065"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3066"></a>
<a name="ln-3067"></a>  <span class="c">! ******** TOSTRING DOUBLE PRECISION PROCEDURES ***********</span>
<a name="ln-3068"></a>  <span class="k">function </span><span class="n">tostring_s_dble</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3069"></a>    <span class="c">! Scalar to string</span>
<a name="ln-3070"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3071"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dble</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3072"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dble</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-3073"></a>  <span class="k">end function </span><span class="n">tostring_s_dble</span>
<a name="ln-3074"></a>
<a name="ln-3075"></a>  <span class="k">function </span><span class="n">tostring_sf_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3076"></a>    <span class="c">! Scalar with specified format to string</span>
<a name="ln-3077"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3078"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3079"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dble</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3080"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dble</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
<a name="ln-3081"></a>  <span class="k">end function </span><span class="n">tostring_sf_dble</span>
<a name="ln-3082"></a>
<a name="ln-3083"></a>  <span class="k">function </span><span class="n">tostring_dble</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3084"></a>    <span class="c">! Vector to string</span>
<a name="ln-3085"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3086"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3087"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-3088"></a>  <span class="k">end function </span><span class="n">tostring_dble</span>
<a name="ln-3089"></a>
<a name="ln-3090"></a>  <span class="k">function </span><span class="n">tostring_f_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3091"></a>    <span class="c">! Vector with specified format to string</span>
<a name="ln-3092"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">)</span>    <span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3093"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>         <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3094"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span>    <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3095"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-3096"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt1</span>  <span class="c">!(5 for readfmt and 3 for replace_w)</span>
<a name="ln-3097"></a>    <span class="kt">integer</span>                          <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ww</span>
<a name="ln-3098"></a>    <span class="kt">logical</span>                          <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3099"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3100"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3101"></a><span class="k">      </span><span class="n">st</span> <span class="o">=</span> <span class="n">errormsg</span>
<a name="ln-3102"></a>      <span class="k">return</span>
<a name="ln-3103"></a><span class="k">    </span><span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3104"></a><span class="k">      </span><span class="n">ww</span> <span class="o">=</span> <span class="n">maxw_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-3105"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-3106"></a>    <span class="k">endif</span>
<a name="ln-3107"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-3108"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-3109"></a>    <span class="k">call </span><span class="n">tostring_get</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-3110"></a>  <span class="k">end function </span><span class="n">tostring_f_dble</span>
<a name="ln-3111"></a>
<a name="ln-3112"></a>  <span class="k">pure function </span><span class="n">len_f_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-3113"></a>    <span class="c">! Total length of returned string, vector s</span>
<a name="ln-3114"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3115"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3116"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-3117"></a>    <span class="kt">integer</span>                          <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ww</span>
<a name="ln-3118"></a>    <span class="kt">logical</span>                          <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3119"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt1</span>  <span class="c">!(5 for readfmt and 3 for replace_w)</span>
<a name="ln-3120"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3121"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-3122"></a><span class="k">    if</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3123"></a><span class="k">      </span><span class="n">ww</span> <span class="o">=</span> <span class="n">maxw_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-3124"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">ww</span><span class="p">)</span>
<a name="ln-3125"></a>    <span class="k">endif</span>
<a name="ln-3126"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-3127"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-3128"></a>    <span class="n">wtot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sa</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">)</span>
<a name="ln-3129"></a>  <span class="k">end function </span><span class="n">len_f_dble</span>
<a name="ln-3130"></a>
<a name="ln-3131"></a>  <span class="k">pure function </span><span class="n">widthmax_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a name="ln-3132"></a>    <span class="c">! Maximum width of an element of x</span>
<a name="ln-3133"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3134"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3135"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-3136"></a>    <span class="kt">integer </span><span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-3137"></a>    <span class="kt">logical </span><span class="n">gedit</span>
<a name="ln-3138"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3139"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! illegal format, use 1</span>
<a name="ln-3140"></a>      <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3141"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3142"></a><span class="k">      </span><span class="n">w</span> <span class="o">=</span> <span class="n">maxw_dble</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-3143"></a>    <span class="k">endif</span>
<a name="ln-3144"></a><span class="k">  end function </span><span class="n">widthmax_dble</span>
<a name="ln-3145"></a>
<a name="ln-3146"></a>  <span class="c">! *************************************** END OF DOUBLE PRECISION PROCEDURES ***************************************</span>
<a name="ln-3147"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3148"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3149"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3150"></a>
<a name="ln-3151"></a>  <span class="c">! *************************************** DOUBLE PRECISION COMPLEX PROCEDURES **************************************</span>
<a name="ln-3152"></a>  <span class="k">subroutine </span><span class="n">disp_s_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3153"></a>    <span class="c">! double precision complex scalar without title</span>
<a name="ln-3154"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3155"></a><span class="nb">    </span><span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3156"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-3157"></a>    <span class="k">call </span><span class="n">disp_ts_cpld</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3158"></a>  <span class="k">end subroutine </span><span class="n">disp_s_cpld</span>
<a name="ln-3159"></a>
<a name="ln-3160"></a>  <span class="k">subroutine </span><span class="n">disp_v_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3161"></a>    <span class="c">! double precision complex vector without title</span>
<a name="ln-3162"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-3163"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3164"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-3165"></a>    <span class="k">call </span><span class="n">disp_tv_cpld</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3166"></a>  <span class="k">end subroutine </span><span class="n">disp_v_cpld</span>
<a name="ln-3167"></a>
<a name="ln-3168"></a>  <span class="k">subroutine </span><span class="n">disp_m_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3169"></a>    <span class="c">! double precision complex matrix without title</span>
<a name="ln-3170"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3171"></a><span class="nb">    </span><span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3172"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3173"></a>    <span class="k">call </span><span class="n">disp_tm_cpld</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3174"></a>  <span class="k">end subroutine </span><span class="n">disp_m_cpld</span>
<a name="ln-3175"></a>
<a name="ln-3176"></a>  <span class="k">subroutine </span><span class="n">disp_ts_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3177"></a>    <span class="c">! double precision complex scalar with title</span>
<a name="ln-3178"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3179"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3180"></a><span class="nb">    </span><span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3181"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span>
<a name="ln-3182"></a>    <span class="k">call </span><span class="n">disp_tm_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3183"></a>                                                       <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3184"></a>  <span class="k">end subroutine </span><span class="n">disp_ts_cpld</span>
<a name="ln-3185"></a>
<a name="ln-3186"></a>  <span class="k">subroutine </span><span class="n">disp_tv_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3187"></a>    <span class="c">! double precision complex vector with title</span>
<a name="ln-3188"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3189"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-3190"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3191"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:),</span> <span class="n">digmax</span>
<a name="ln-3192"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-3193"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">digmax</span><span class="o">=</span><span class="n">digmax</span><span class="p">)</span>
<a name="ln-3194"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt_imag</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3195"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3196"></a><span class="k">        call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, FMT must be present if FMT_IMAG is present&#39;</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span>
<a name="ln-3197"></a>      <span class="k">endif</span>
<a name="ln-3198"></a><span class="k">      call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SEim</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt_imag</span><span class="p">)</span>
<a name="ln-3199"></a>    <span class="k">else</span>
<a name="ln-3200"></a><span class="k">      </span><span class="n">SEim</span> <span class="o">=</span> <span class="n">SE</span>
<a name="ln-3201"></a>    <span class="k">endif</span>
<a name="ln-3202"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3203"></a><span class="k">      call </span><span class="n">disp_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-3204"></a>    <span class="k">else</span>
<a name="ln-3205"></a><span class="k">      call </span><span class="n">disp_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3206"></a>    <span class="k">endif</span>
<a name="ln-3207"></a><span class="k">  end subroutine </span><span class="n">disp_tv_cpld</span>
<a name="ln-3208"></a>
<a name="ln-3209"></a>  <span class="k">subroutine </span><span class="n">disp_tm_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_imag</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">digmax</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3210"></a>    <span class="c">! double precision complex matrix with title</span>
<a name="ln-3211"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>      <span class="c">! The title to use for the matrix</span>
<a name="ln-3212"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>     <span class="c">! The matrix to be written</span>
<a name="ln-3213"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>        <span class="c">! Edit descriptor for each element (real element when fmt_imag &amp;</span>
<a name="ln-3214"></a>    <span class="c">!                                                ! is present)</span>
<a name="ln-3215"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt_imag</span>   <span class="c">! Edit descriptor for each imaginary element</span>
<a name="ln-3216"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>       <span class="c">! Unit to display on</span>
<a name="ln-3217"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">digmax</span>     <span class="c">! Nbr of significant digits for largest abs value in real(x) &amp;</span>
<a name="ln-3218"></a>    <span class="c">!                                                ! and aimag(x)</span>
<a name="ln-3219"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>    <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-3220"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>        <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-3221"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>      <span class="c">! Style(s): See NOTE 1 below</span>
<a name="ln-3222"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>       <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no</span>
<a name="ln-3223"></a>    <span class="c">!                                                ! trimming, &#39;yes&#39; for trimming</span>
<a name="ln-3224"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span>  <span class="c">! Lower bounds of x</span>
<a name="ln-3225"></a>    <span class="c">!</span>
<a name="ln-3226"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-3227"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">digmax</span><span class="o">=</span><span class="n">digmax</span><span class="p">)</span>
<a name="ln-3228"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt_imag</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3229"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3230"></a><span class="k">        call </span><span class="n">disp_errmsg</span><span class="p">(</span><span class="s1">&#39;DISP: error, FMT must be present if FMT_IMAG is present&#39;</span><span class="p">);</span> <span class="k">return</span>
<a name="ln-3231"></a><span class="k">      endif</span>
<a name="ln-3232"></a><span class="k">      call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SEim</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt_imag</span><span class="p">)</span>
<a name="ln-3233"></a>    <span class="k">else</span>
<a name="ln-3234"></a><span class="k">      </span><span class="n">SEim</span> <span class="o">=</span> <span class="n">SE</span>
<a name="ln-3235"></a>    <span class="k">endif</span>
<a name="ln-3236"></a><span class="k">    call </span><span class="n">disp_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-3237"></a>  <span class="k">end subroutine </span><span class="n">disp_tm_cpld</span>
<a name="ln-3238"></a>
<a name="ln-3239"></a>  <span class="k">subroutine </span><span class="n">disp_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-3240"></a>    <span class="c">! Double precision item</span>
<a name="ln-3241"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3242"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3243"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-3244"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">n</span>
<a name="ln-3245"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="kd">::</span> <span class="n">widre</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">widim</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">nblre</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">nblim</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-3246"></a>    <span class="k">call </span><span class="n">find_editdesc_dble</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">SE</span><span class="p">,</span> <span class="n">widre</span><span class="p">,</span> <span class="n">nblre</span><span class="p">)</span>         <span class="c">! determine also SE % w</span>
<a name="ln-3247"></a>    <span class="k">call </span><span class="n">find_editdesc_dble</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">widim</span><span class="p">,</span> <span class="n">nblim</span><span class="p">)</span> <span class="c">! determine also SEim % w</span>
<a name="ln-3248"></a>    <span class="k">call </span><span class="n">tobox_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">widre</span><span class="p">,</span> <span class="n">widim</span><span class="p">,</span> <span class="n">nblre</span><span class="p">,</span> <span class="n">nblim</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-3249"></a>  <span class="k">end subroutine </span><span class="n">disp_cpld</span>
<a name="ln-3250"></a>
<a name="ln-3251"></a>  <span class="k">subroutine </span><span class="n">tobox_cpld</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span><span class="p">,</span> <span class="n">widre</span><span class="p">,</span> <span class="n">widim</span><span class="p">,</span> <span class="n">nblre</span><span class="p">,</span> <span class="n">nblim</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-3252"></a>    <span class="c">! Write double precision complex matrix to box</span>
<a name="ln-3253"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3254"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3255"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">widre</span><span class="p">(:),</span> <span class="n">widim</span><span class="p">(:),</span> <span class="n">nblre</span><span class="p">(:),</span> <span class="n">nblim</span><span class="p">(:)</span>
<a name="ln-3256"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span><span class="p">,</span> <span class="n">SEim</span>
<a name="ln-3257"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">s</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a name="ln-3258"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SEim</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a name="ln-3259"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">sgn</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a name="ln-3260"></a>    <span class="kt">integer</span>             <span class="kd">::</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-3261"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span>  <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-3262"></a>    <span class="n">SE</span> <span class="p">%</span> <span class="n">zas</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-3263"></a>    <span class="n">SEim</span> <span class="p">%</span> <span class="n">zas</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-3264"></a>    <span class="n">wid</span> <span class="o">=</span> <span class="n">widre</span> <span class="o">+</span> <span class="n">widim</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-3265"></a>    <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-3266"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-3267"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a name="ln-3268"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">widre</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">widim</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nblre</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3269"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span>
<a name="ln-3270"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-3271"></a><span class="k">        enddo</span>
<a name="ln-3272"></a><span class="k">      call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">sgn</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3273"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">SEim</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a name="ln-3274"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">widim</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widim</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nblim</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3275"></a>      <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span> <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3276"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3277"></a>    <span class="k">enddo</span>
<a name="ln-3278"></a><span class="k">    call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-3279"></a>  <span class="k">end subroutine </span><span class="n">tobox_cpld</span>
<a name="ln-3280"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3281"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3282"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3283"></a>
<a name="ln-3284"></a>  <span class="c">! ******* TOSTRING DOUBLE PRECISION COMPLEX PROCEDURES ********</span>
<a name="ln-3285"></a>
<a name="ln-3286"></a>  <span class="k">function </span><span class="n">tostring_s_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3287"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3288"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_s_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3289"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_cpld</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-3290"></a>  <span class="k">end function </span><span class="n">tostring_s_cpld</span>
<a name="ln-3291"></a>
<a name="ln-3292"></a>  <span class="k">function </span><span class="n">tostring_sf_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3293"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3294"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3295"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_s_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3296"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_cpld</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
<a name="ln-3297"></a>  <span class="k">end function </span><span class="n">tostring_sf_cpld</span>
<a name="ln-3298"></a>
<a name="ln-3299"></a>  <span class="k">function </span><span class="n">tostring_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3300"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3301"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3302"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">rfmt</span><span class="p">)</span>
<a name="ln-3303"></a>  <span class="k">end function </span><span class="n">tostring_cpld</span>
<a name="ln-3304"></a>
<a name="ln-3305"></a>  <span class="k">function </span><span class="n">tostring_f_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3306"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3307"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3308"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span>                 <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3309"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dble</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">))</span>        <span class="kd">::</span> <span class="n">sar</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-3310"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dble</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sai</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c">! x-real(x) instead of aimag(x) to enable the function</span>
<a name="ln-3311"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">sgn</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c">! to pass -stand:f95 switch of the ifort compiler.</span>
<a name="ln-3312"></a>    <span class="kt">integer</span>                                       <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">i</span>
<a name="ln-3313"></a>    <span class="kt">logical</span>                                       <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3314"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">fmt1</span>  <span class="c">!(5 for readfmt and 3 for replace_w)</span>
<a name="ln-3315"></a>    <span class="kt">real</span><span class="p">(</span><span class="nb">dble</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">xre</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">xim</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">h</span>
<a name="ln-3316"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3317"></a>    <span class="n">xre</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-3318"></a>    <span class="n">xim</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-3319"></a>    <span class="n">h</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a name="ln-3320"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3321"></a><span class="k">      </span><span class="n">st</span> <span class="o">=</span> <span class="n">errormsg</span>
<a name="ln-3322"></a>      <span class="k">return</span>
<a name="ln-3323"></a><span class="k">    </span><span class="n">elseif</span> <span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3324"></a><span class="k">      </span><span class="n">wr</span> <span class="o">=</span> <span class="n">maxw_dble</span><span class="p">(</span><span class="n">xre</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-3325"></a>      <span class="n">wi</span> <span class="o">=</span> <span class="n">maxw_dble</span><span class="p">(</span><span class="n">xim</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a name="ln-3326"></a>      <span class="k">call </span><span class="n">replace_w</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">wr</span><span class="p">,</span> <span class="n">wi</span><span class="p">))</span>
<a name="ln-3327"></a>    <span class="k">endif</span>
<a name="ln-3328"></a><span class="k">    write</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-3329"></a>    <span class="k">write</span><span class="p">(</span><span class="n">sai</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-3330"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-3331"></a>    <span class="k">call </span><span class="n">trim_real</span><span class="p">(</span><span class="n">sai</span><span class="p">,</span> <span class="n">gedit</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a name="ln-3332"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">;</span> <span class="k">endif</span><span class="p">;</span> <span class="k">enddo</span>
<a name="ln-3333"></a><span class="k">    call </span><span class="n">tostring_get_complex</span><span class="p">(</span><span class="n">sar</span><span class="p">,</span> <span class="n">sgn</span><span class="p">,</span> <span class="n">sai</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-3334"></a>  <span class="k">end function </span><span class="n">tostring_f_cpld</span>
<a name="ln-3335"></a>
<a name="ln-3336"></a>  <span class="k">pure function </span><span class="n">len_s_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-3337"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3338"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3339"></a>    <span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-3340"></a>    <span class="kt">logical</span>                   <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3341"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-3342"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3343"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-3344"></a><span class="k">    </span><span class="n">wtot</span> <span class="o">=</span> <span class="n">len_f_dble</span><span class="p">([</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">len_f_dble</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">))],</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-3345"></a>  <span class="k">end function </span><span class="n">len_s_cpld</span>
<a name="ln-3346"></a>
<a name="ln-3347"></a>  <span class="k">pure function </span><span class="n">len_f_cpld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-3348"></a>    <span class="kt">complex</span><span class="p">(</span><span class="nb">dble</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3349"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3350"></a>    <span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-3351"></a>    <span class="kt">logical</span>                   <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3352"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-3353"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3354"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-3355"></a><span class="k">    </span><span class="n">wtot</span> <span class="o">=</span> <span class="n">len_f_dble</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">len_f_dble</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">)</span>
<a name="ln-3356"></a>    <span class="c">! subtract seplen because it has been added twice in len_f_dble</span>
<a name="ln-3357"></a>  <span class="k">end function </span><span class="n">len_f_cpld</span>
<a name="ln-3358"></a>  <span class="c">! *************************************** END OF DOUBLE PRECISION COMPLEX PROCEDURES ********************************</span>
<a name="ln-3359"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3360"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3361"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3362"></a>
<a name="ln-3363"></a>  <span class="c">! ********************************************** DEFAULT LOGICAL PROCEDURES *****************************************</span>
<a name="ln-3364"></a>  <span class="k">subroutine </span><span class="n">disp_s_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3365"></a>    <span class="c">! Default logical scalar without title</span>
<a name="ln-3366"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3367"></a><span class="nb">    </span><span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3368"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-3369"></a>    <span class="k">call </span><span class="n">disp_ts_dlog</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3370"></a>  <span class="k">end subroutine </span><span class="n">disp_s_dlog</span>
<a name="ln-3371"></a>
<a name="ln-3372"></a>  <span class="k">subroutine </span><span class="n">disp_v_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3373"></a>    <span class="c">! Default logical vector without title</span>
<a name="ln-3374"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-3375"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3376"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3377"></a>    <span class="k">call </span><span class="n">disp_tv_dlog</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3378"></a>  <span class="k">end subroutine </span><span class="n">disp_v_dlog</span>
<a name="ln-3379"></a>
<a name="ln-3380"></a>  <span class="k">subroutine </span><span class="n">disp_m_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3381"></a>    <span class="c">! Default logical matrix without title</span>
<a name="ln-3382"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3383"></a><span class="nb">    </span><span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3384"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3385"></a>    <span class="k">call </span><span class="n">disp_tm_dlog</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3386"></a>  <span class="k">end subroutine </span><span class="n">disp_m_dlog</span>
<a name="ln-3387"></a>
<a name="ln-3388"></a>  <span class="k">subroutine </span><span class="n">disp_ts_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3389"></a>    <span class="c">! Default logical scalar with title</span>
<a name="ln-3390"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3391"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3392"></a><span class="nb">    </span><span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3393"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-3394"></a>    <span class="k">call </span><span class="n">disp_tm_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3395"></a>  <span class="k">end subroutine </span><span class="n">disp_ts_dlog</span>
<a name="ln-3396"></a>
<a name="ln-3397"></a>  <span class="k">subroutine </span><span class="n">disp_tv_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3398"></a>    <span class="c">! Default logical vector with title</span>
<a name="ln-3399"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3400"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-3401"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3402"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3403"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3404"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3405"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3406"></a><span class="k">      call </span><span class="n">disp_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3407"></a>    <span class="k">else</span>
<a name="ln-3408"></a><span class="k">      call </span><span class="n">disp_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3409"></a>    <span class="k">endif</span>
<a name="ln-3410"></a><span class="k">  end subroutine </span><span class="n">disp_tv_dlog</span>
<a name="ln-3411"></a>
<a name="ln-3412"></a>  <span class="k">subroutine </span><span class="n">disp_tm_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3413"></a>    <span class="c">! Default logical matrix with title</span>
<a name="ln-3414"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>     <span class="c">! The title to use for the matrix</span>
<a name="ln-3415"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>    <span class="c">! The matrix to be written</span>
<a name="ln-3416"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>       <span class="c">! Format edit descriptor to use for each matrix element (e.g. &#39;L1&#39;)</span>
<a name="ln-3417"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>      <span class="c">! Unit to display on</span>
<a name="ln-3418"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>   <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-3419"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>       <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-3420"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>     <span class="c">! Style(s): See NOTE 1 below</span>
<a name="ln-3421"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>      <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no trimming,</span>
<a name="ln-3422"></a>    <span class="c">!                                               ! &#39;yes&#39; for trimming</span>
<a name="ln-3423"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span> <span class="c">! Lower bounds of x</span>
<a name="ln-3424"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3425"></a>    <span class="c">!</span>
<a name="ln-3426"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3427"></a>    <span class="k">call </span><span class="n">disp_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3428"></a>  <span class="k">end subroutine </span><span class="n">disp_tm_dlog</span>
<a name="ln-3429"></a>
<a name="ln-3430"></a>  <span class="k">subroutine </span><span class="n">disp_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3431"></a>    <span class="c">! Write default logical to box or unit</span>
<a name="ln-3432"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3433"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3434"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3435"></a>    <span class="kt">integer </span><span class="n">wid</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-3436"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">trm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3437"></a><span class="k">      </span><span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;(L1)&#39;</span>
<a name="ln-3438"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3439"></a><span class="k">        </span><span class="n">wid</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3440"></a>      <span class="k">else</span>
<a name="ln-3441"></a><span class="k">        </span><span class="n">wid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3442"></a>      <span class="k">endif</span>
<a name="ln-3443"></a><span class="k">      </span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3444"></a>      <span class="n">nbl</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">-</span> <span class="n">wid</span>
<a name="ln-3445"></a>    <span class="k">else</span>
<a name="ln-3446"></a><span class="k">      </span><span class="n">wid</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-3447"></a>      <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3448"></a>    <span class="k">endif</span>
<a name="ln-3449"></a><span class="k">    call </span><span class="n">tobox_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-3450"></a>  <span class="k">end subroutine </span><span class="n">disp_dlog</span>
<a name="ln-3451"></a>
<a name="ln-3452"></a>  <span class="k">subroutine </span><span class="n">tobox_dlog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">)</span>
<a name="ln-3453"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">title</span>
<a name="ln-3454"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3455"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3456"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">(:)</span>
<a name="ln-3457"></a>    <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nbl</span><span class="p">(:)</span>
<a name="ln-3458"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">w</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">s</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-3459"></a>    <span class="kt">integer</span>            <span class="kd">::</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">widp</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<a name="ln-3460"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-3461"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3462"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3463"></a>    <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-3464"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-3465"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a name="ln-3466"></a>      <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3467"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3468"></a>    <span class="k">enddo</span>
<a name="ln-3469"></a><span class="k">    call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-3470"></a>  <span class="k">end subroutine </span><span class="n">tobox_dlog</span>
<a name="ln-3471"></a>
<a name="ln-3472"></a>  <span class="c">! ********** DEFAULT LOGICAL TOSTRING PROCEDURES *********</span>
<a name="ln-3473"></a>  <span class="k">function </span><span class="n">tostring_s_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3474"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3475"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3476"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dlog</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="s1">&#39;L1&#39;</span><span class="p">)</span>
<a name="ln-3477"></a>  <span class="k">end function </span><span class="n">tostring_s_dlog</span>
<a name="ln-3478"></a>
<a name="ln-3479"></a>  <span class="k">function </span><span class="n">tostring_sf_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3480"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">x</span>
<a name="ln-3481"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3482"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dlog</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3483"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dlog</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
<a name="ln-3484"></a>  <span class="k">end function </span><span class="n">tostring_sf_dlog</span>
<a name="ln-3485"></a>
<a name="ln-3486"></a>  <span class="k">function </span><span class="n">tostring_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3487"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3488"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3489"></a>    <span class="n">st</span> <span class="o">=</span> <span class="n">tostring_f_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;L1&#39;</span><span class="p">)</span>
<a name="ln-3490"></a>  <span class="k">end function </span><span class="n">tostring_dlog</span>
<a name="ln-3491"></a>
<a name="ln-3492"></a>  <span class="k">function </span><span class="n">tostring_f_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<a name="ln-3493"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3494"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3495"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">len_f_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">st</span>
<a name="ln-3496"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">widthmax_dlog</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="kd">::</span> <span class="n">sa</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="ln-3497"></a>    <span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-3498"></a>    <span class="kt">logical</span>                       <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3499"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-3500"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3501"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">st</span> <span class="o">=</span> <span class="n">errormsg</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-3502"></a><span class="k">    write</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-3503"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span><span class="p">)</span> <span class="n">sa</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<a name="ln-3504"></a>    <span class="k">call </span><span class="n">tostring_get</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<a name="ln-3505"></a>  <span class="k">end function </span><span class="n">tostring_f_dlog</span>
<a name="ln-3506"></a>
<a name="ln-3507"></a>  <span class="k">pure function </span><span class="n">len_f_dlog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">wtot</span><span class="p">)</span>
<a name="ln-3508"></a>    <span class="kt">logical</span><span class="p">(</span><span class="nb">dlog</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3509"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3510"></a>    <span class="kt">integer</span>                    <span class="kd">::</span> <span class="n">wtot</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-3511"></a>    <span class="kt">logical</span>                    <span class="kd">::</span> <span class="n">gedit</span>
<a name="ln-3512"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-3513"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3514"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span><span class="p">;</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errormsg</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-3515"></a><span class="k">    if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span><span class="p">)</span> <span class="n">wtot</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-3516"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">trimb</span> <span class="o">==</span> <span class="s1">&#39;NO&#39;</span> <span class="p">)</span> <span class="n">wtot</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-3517"></a>    <span class="n">wtot</span> <span class="o">=</span> <span class="n">wtot</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tosset</span> <span class="p">%</span> <span class="n">seplen</span><span class="p">)</span>
<a name="ln-3518"></a>  <span class="k">end function </span><span class="n">len_f_dlog</span>
<a name="ln-3519"></a>
<a name="ln-3520"></a>  <span class="k">pure function </span><span class="n">widthmax_dlog</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a name="ln-3521"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt</span>
<a name="ln-3522"></a>    <span class="kt">integer </span><span class="n">w</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-3523"></a>    <span class="kt">logical </span><span class="n">gedit</span>
<a name="ln-3524"></a>    <span class="kt">character</span><span class="p">(</span><span class="n">nnblk</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fmt1</span>
<a name="ln-3525"></a>    <span class="k">call </span><span class="n">readfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmt1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gedit</span><span class="p">)</span>
<a name="ln-3526"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3527"></a>  <span class="k">end function </span><span class="n">widthmax_dlog</span>
<a name="ln-3528"></a>  <span class="c">! ****************************** END OF DEFAULT LOGICAL PROCEDURES *******************************</span>
<a name="ln-3529"></a>
<a name="ln-3530"></a>  <span class="c">! ******************************* DEFAULT CHARACTER PROCEDURES **********************************</span>
<a name="ln-3531"></a>  <span class="k">subroutine </span><span class="n">disp_v_dchr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3532"></a>    <span class="c">! Default character vector without title</span>
<a name="ln-3533"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-3534"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3535"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3536"></a>    <span class="k">call </span><span class="n">disp_tv_dchr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3537"></a>  <span class="k">end subroutine </span><span class="n">disp_v_dchr</span>
<a name="ln-3538"></a>
<a name="ln-3539"></a>  <span class="k">subroutine </span><span class="n">disp_m_dchr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3540"></a>    <span class="c">! Default character matrix without title</span>
<a name="ln-3541"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3542"></a><span class="nb">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3543"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3544"></a>    <span class="k">call </span><span class="n">disp_tm_dchr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3545"></a>  <span class="k">end subroutine </span><span class="n">disp_m_dchr</span>
<a name="ln-3546"></a>
<a name="ln-3547"></a>  <span class="k">subroutine </span><span class="n">disp_ts_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3548"></a>    <span class="c">! Default character scalar with title</span>
<a name="ln-3549"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3550"></a><span class="nb">    </span><span class="kt">character</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-3551"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-3552"></a>    <span class="n">empty</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-3553"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">title</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3554"></a><span class="k">      call </span><span class="n">disp_nonopt_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3555"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3556"></a><span class="k">      call </span><span class="n">disp_nonopt_dchr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3557"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">title</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3558"></a><span class="k">      call </span><span class="n">disp_nonopt_dchr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3559"></a>    <span class="k">else</span>
<a name="ln-3560"></a><span class="k">      call </span><span class="n">disp_tm_dchr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3561"></a>    <span class="k">endif</span>
<a name="ln-3562"></a><span class="k">  end subroutine </span><span class="n">disp_ts_dchr</span>
<a name="ln-3563"></a>
<a name="ln-3564"></a>  <span class="k">subroutine </span><span class="n">disp_nonopt_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3565"></a>    <span class="c">! This routine exists to circumvent bug in gfortran, that made it not possible to change scalar strings</span>
<a name="ln-3566"></a>    <span class="c">! to matrices with reshape in calls of disp_tm_dchr. This intermediate routine provides work-around.</span>
<a name="ln-3567"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3568"></a><span class="nb">    </span><span class="k">optional </span><span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span>
<a name="ln-3569"></a><span class="nb">    </span><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>
<a name="ln-3570"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="kd">::</span> <span class="n">xm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3571"></a>    <span class="n">xm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
<a name="ln-3572"></a>    <span class="k">call </span><span class="n">disp_tm_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="o">=</span><span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
<a name="ln-3573"></a>  <span class="k">end subroutine </span><span class="n">disp_nonopt_dchr</span>
<a name="ln-3574"></a>
<a name="ln-3575"></a>  <span class="k">subroutine </span><span class="n">disp_tv_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3576"></a>    <span class="c">! Default character vector with title</span>
<a name="ln-3577"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">(:)</span>
<a name="ln-3578"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">orient</span>
<a name="ln-3579"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">(:)</span>
<a name="ln-3580"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3581"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>
<a name="ln-3582"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">row</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3583"></a><span class="k">      call </span><span class="n">disp_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3584"></a>    <span class="k">else</span>
<a name="ln-3585"></a><span class="k">      call </span><span class="n">disp_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3586"></a>    <span class="k">endif</span>
<a name="ln-3587"></a><span class="k">  end subroutine </span><span class="n">disp_tv_dchr</span>
<a name="ln-3588"></a>
<a name="ln-3589"></a>  <span class="k">subroutine </span><span class="n">disp_tm_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3590"></a>    <span class="c">! Default character matrix with title</span>
<a name="ln-3591"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">title</span>      <span class="c">! The title to use for the matrix</span>
<a name="ln-3592"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">x</span><span class="p">(:,:)</span>     <span class="c">! The matrix to be written</span>
<a name="ln-3593"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">fmt</span>        <span class="c">! Format edit descriptor to use for each matrix element (e.g.&#39;A4&#39;)</span>
<a name="ln-3594"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">unit</span>       <span class="c">! Unit to display on</span>
<a name="ln-3595"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>    <span class="c">! &#39;No&#39; to print next matrix to right of current, otherwise &#39;Yes&#39;</span>
<a name="ln-3596"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">sep</span>        <span class="c">! Separator between matrix columns (e.g. &quot;, &quot;)</span>
<a name="ln-3597"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="n">style</span>      <span class="c">! Style(s): see NOTE 1 below</span>
<a name="ln-3598"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">trim</span>       <span class="c">! &#39;Auto&#39; (the default) to trim if fmt absent, &#39;no&#39; for no</span>
<a name="ln-3599"></a>    <span class="c">!                                                ! trimming, &#39;yes&#39; for trimming</span>
<a name="ln-3600"></a>    <span class="kt">integer</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span> <span class="nb">lbound</span><span class="p">(:)</span>  <span class="c">! Lower bounds of x</span>
<a name="ln-3601"></a>    <span class="c">!</span>
<a name="ln-3602"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3603"></a>    <span class="k">call </span><span class="n">get_SE</span><span class="p">(</span><span class="n">SE</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">shape</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">advance</span><span class="p">,</span> <span class="nb">lbound</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="nb">trim</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-3604"></a>    <span class="k">call </span><span class="n">disp_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3605"></a>  <span class="k">end subroutine </span><span class="n">disp_tm_dchr</span>
<a name="ln-3606"></a>
<a name="ln-3607"></a>  <span class="k">subroutine </span><span class="n">disp_dchr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">SE</span><span class="p">)</span>
<a name="ln-3608"></a>    <span class="c">! Default character item to box</span>
<a name="ln-3609"></a>    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="p">(:,:)</span>
<a name="ln-3610"></a>    <span class="k">type</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SE</span>
<a name="ln-3611"></a>    <span class="kt">character</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">edesc</span>
<a name="ln-3612"></a>    <span class="kt">character</span><span class="p">,</span> <span class="k">pointer</span>            <span class="kd">::</span> <span class="n">boxp</span><span class="p">(:,:)</span>
<a name="ln-3613"></a>    <span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">w</span>
<a name="ln-3614"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="kd">::</span> <span class="n">wid</span><span class="p">,</span> <span class="n">nbl</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">widp</span>
<a name="ln-3615"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3616"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3617"></a>    <span class="n">lx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-3618"></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span>
<a name="ln-3619"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3620"></a><span class="k">      </span><span class="n">w</span> <span class="o">=</span> <span class="n">lx</span>
<a name="ln-3621"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3622"></a><span class="k">        </span><span class="n">edesc</span> <span class="o">=</span> <span class="s1">&#39;(A__________)&#39;</span>
<a name="ln-3623"></a>        <span class="k">write</span><span class="p">(</span><span class="n">edesc</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">12</span><span class="p">),</span> <span class="s1">&#39;(SS,I10)&#39;</span><span class="p">)</span> <span class="n">w</span>
<a name="ln-3624"></a>        <span class="n">SE</span> <span class="p">%</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">edesc</span>
<a name="ln-3625"></a>      <span class="k">endif</span>
<a name="ln-3626"></a><span class="k">    endif</span>
<a name="ln-3627"></a><span class="k">    if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">trm</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3628"></a><span class="k">      </span><span class="n">n1</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3629"></a>      <span class="n">n2</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="nb">verify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">back</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.),</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3630"></a>      <span class="n">wid</span> <span class="o">=</span> <span class="n">n2</span> <span class="o">-</span> <span class="n">n1</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3631"></a>      <span class="n">nbl</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">wid</span>
<a name="ln-3632"></a>    <span class="k">else</span>
<a name="ln-3633"></a><span class="k">      </span><span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3634"></a>      <span class="n">n2</span> <span class="o">=</span> <span class="n">w</span>
<a name="ln-3635"></a>      <span class="n">wid</span> <span class="o">=</span> <span class="n">w</span>
<a name="ln-3636"></a>      <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3637"></a>    <span class="k">endif</span>
<a name="ln-3638"></a><span class="k">    if</span> <span class="p">(</span><span class="k">all</span><span class="p">(</span><span class="n">wid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3639"></a>    <span class="n">SE</span> <span class="p">%</span> <span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
<a name="ln-3640"></a>    <span class="k">call </span><span class="n">preparebox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">widp</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wleft</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-3641"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-3642"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">trm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3643"></a><span class="k">        call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">x</span><span class="p">(:,</span><span class="n">j</span><span class="p">)(</span><span class="n">n1</span><span class="p">(</span><span class="n">j</span><span class="p">):</span><span class="n">n2</span><span class="p">(</span><span class="n">j</span><span class="p">)),</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">wid</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">nbl</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3644"></a>      <span class="k">else</span>
<a name="ln-3645"></a><span class="k">        if</span> <span class="p">(</span><span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lx</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">widp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">lx</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3646"></a>        <span class="k">call </span><span class="n">copytobox</span><span class="p">(</span><span class="n">x</span><span class="p">(:,</span><span class="n">j</span><span class="p">),</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3647"></a>      <span class="k">endif</span>
<a name="ln-3648"></a><span class="k">      if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">call </span><span class="n">copyseptobox</span><span class="p">(</span><span class="n">SE</span> <span class="p">%</span> <span class="n">sep</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">SE</span> <span class="p">%</span> <span class="n">lsep</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">lin1</span><span class="p">,</span> <span class="n">boxp</span><span class="p">,</span>  <span class="n">wleft</span><span class="p">)</span>
<a name="ln-3649"></a>    <span class="k">enddo</span>
<a name="ln-3650"></a><span class="k">    call </span><span class="n">finishbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">SE</span><span class="p">,</span> <span class="n">boxp</span><span class="p">)</span>
<a name="ln-3651"></a>  <span class="k">end subroutine </span><span class="n">disp_dchr</span>
<a name="ln-3652"></a>
<a name="ln-3653"></a>  <span class="c">! ************************* END OF DEFAULT CHARACTER PROCEDURES ********************************</span>
<a name="ln-3654"></a>
<a name="ln-3655"></a>  <span class="c">! NOTE 1: STYLES</span>
<a name="ln-3656"></a>  <span class="c">!   Styles can be LEFT, ABOVE, PAD, UNDERLINE or NUMBER. Padding is by default done with hyphen</span>
<a name="ln-3657"></a>  <span class="c">!   characters (e.g. ---title---), but can be changed for example to asterisks with style=&#39;*PAD&#39;.</span>
<a name="ln-3658"></a>  <span class="c">!   Underlining is also with hyphens and can also be changed, e.g. with style=&#39;*UNDERLINE&#39;. Lower</span>
<a name="ln-3659"></a>  <span class="c">!   or mixed case is acceptable: style=&#39;above&#39; or style=&#39;Above&#39;. It is also possible to specify</span>
<a name="ln-3660"></a>  <span class="c">!   both NUMBER and one of the other styles, with e.g. style=&#39;ABOVE &amp; NUMBER&#39;.</span>
<a name="ln-3661"></a>  <span class="c">!</span>
<a name="ln-3662"></a>  <span class="c">! NOTE 2: DOUBLE PRECISION</span>
<a name="ln-3663"></a>  <span class="c">!   The double precision functions and subroutines above (the sections marked DOUBLE PRECISION</span>
<a name="ln-3664"></a>  <span class="c">!   PROCEDURES and DOUBLE PRECISION COMPLEX PROCEDURES) are copies of the sections marked SINGLE</span>
<a name="ln-3665"></a>  <span class="c">!   PRECISION PROCEDURES and SINGLE PRECISION COMPLEX PROCEDURES, with the kind parameter sngl</span>
<a name="ln-3666"></a>  <span class="c">!   changed to dble, the procedure name suffixes _sngl and _cplx changed to _dble and _cpld, and</span>
<a name="ln-3667"></a>  <span class="c">!   single changed to double (only appears in comments). The add-on module DISP_R16MOD is another</span>
<a name="ln-3668"></a>  <span class="c">!   copy of these procedures (for quad precision).</span>
<a name="ln-3669"></a>
<a name="ln-3670"></a>  <span class="c">! Something to do an HTML table</span>
<a name="ln-3671"></a>  <span class="c">!   &lt;table BORDER=&quot;1&quot;&gt;</span>
<a name="ln-3672"></a>  <span class="c">!     &lt;tr&gt;&lt;td&gt;</span>
<a name="ln-3673"></a>  <span class="c">!     AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA&lt;/td&gt;&lt;td&gt; AAA</span>
<a name="ln-3674"></a>  <span class="c">!     &lt;/td&gt;&lt;/tr&gt;</span>
<a name="ln-3675"></a>  <span class="c">!   &lt;/table&gt;</span>
<a name="ln-3676"></a>
<a name="ln-3677"></a>  <span class="c">! option for row suffix and prefix, maybe as elements of SEP=[ &quot;,&quot;, &quot;[&quot;, &quot;]&quot; ]</span>
<a name="ln-3678"></a>  <span class="c">! [ 1,2,3 ]</span>
<a name="ln-3679"></a>  <span class="c">! [ 4,5,6 ]</span>
<a name="ln-3680"></a>
<a name="ln-3681"></a>  <span class="c">! output negative values as (val) instead of -val, which is common in financial tables</span>
<a name="ln-3682"></a>
<a name="ln-3683"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3684"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()=</span>
<a name="ln-3685"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3686"></a><span class="k">subroutine </span><span class="n">test_suite_M_display</span><span class="p">()</span>
<a name="ln-3687"></a><span class="k">use </span><span class="n">M_verify</span><span class="p">,</span> <span class="k">only</span> <span class="p">:</span> <span class="n">unit_check_start</span><span class="p">,</span><span class="n">unit_check</span><span class="p">,</span><span class="n">unit_check_done</span><span class="p">,</span><span class="n">unit_check_good</span><span class="p">,</span><span class="n">unit_check_bad</span><span class="p">,</span><span class="n">unit_check_msg</span>
<a name="ln-3688"></a><span class="k">use </span><span class="n">M_verify</span><span class="p">,</span> <span class="k">only</span> <span class="p">:</span> <span class="n">unit_check_level</span>
<a name="ln-3689"></a><span class="k">implicit none</span>
<a name="ln-3690"></a><span class="c">!! setup</span>
<a name="ln-3691"></a>   <span class="k">call </span><span class="n">test_disp_get</span><span class="p">()</span>
<a name="ln-3692"></a>   <span class="k">call </span><span class="n">test_disp_m_cpld</span><span class="p">()</span>
<a name="ln-3693"></a>   <span class="k">call </span><span class="n">test_disp_m_cplx</span><span class="p">()</span>
<a name="ln-3694"></a>   <span class="k">call </span><span class="n">test_disp_m_dble</span><span class="p">()</span>
<a name="ln-3695"></a>   <span class="k">call </span><span class="n">test_disp_m_dchr</span><span class="p">()</span>
<a name="ln-3696"></a>   <span class="k">call </span><span class="n">test_disp_m_dlog</span><span class="p">()</span>
<a name="ln-3697"></a>   <span class="k">call </span><span class="n">test_disp_m_sngl</span><span class="p">()</span>
<a name="ln-3698"></a>   <span class="k">call </span><span class="n">test_disp_matrix_int</span><span class="p">()</span>
<a name="ln-3699"></a>   <span class="k">call </span><span class="n">test_disp_s_cpld</span><span class="p">()</span>
<a name="ln-3700"></a>   <span class="k">call </span><span class="n">test_disp_s_cplx</span><span class="p">()</span>
<a name="ln-3701"></a>   <span class="k">call </span><span class="n">test_disp_s_dble</span><span class="p">()</span>
<a name="ln-3702"></a>   <span class="k">call </span><span class="n">test_disp_s_dlog</span><span class="p">()</span>
<a name="ln-3703"></a>   <span class="k">call </span><span class="n">test_disp_s_sngl</span><span class="p">()</span>
<a name="ln-3704"></a>   <span class="k">call </span><span class="n">test_disp_scalar_int</span><span class="p">()</span>
<a name="ln-3705"></a>   <span class="k">call </span><span class="n">test_disp_set</span><span class="p">()</span>
<a name="ln-3706"></a>   <span class="k">call </span><span class="n">test_disp_set_ds</span><span class="p">()</span>
<a name="ln-3707"></a>   <span class="k">call </span><span class="n">test_disp_set_factory</span><span class="p">()</span>
<a name="ln-3708"></a>   <span class="k">call </span><span class="n">test_disp_title_matrix_int</span><span class="p">()</span>
<a name="ln-3709"></a>   <span class="k">call </span><span class="n">test_disp_title_scalar_int</span><span class="p">()</span>
<a name="ln-3710"></a>   <span class="k">call </span><span class="n">test_disp_title_vector_int</span><span class="p">()</span>
<a name="ln-3711"></a>   <span class="k">call </span><span class="n">test_disp_tm_cpld</span><span class="p">()</span>
<a name="ln-3712"></a>   <span class="k">call </span><span class="n">test_disp_tm_cplx</span><span class="p">()</span>
<a name="ln-3713"></a>   <span class="k">call </span><span class="n">test_disp_tm_dble</span><span class="p">()</span>
<a name="ln-3714"></a>   <span class="k">call </span><span class="n">test_disp_tm_dchr</span><span class="p">()</span>
<a name="ln-3715"></a>   <span class="k">call </span><span class="n">test_disp_tm_dlog</span><span class="p">()</span>
<a name="ln-3716"></a>   <span class="k">call </span><span class="n">test_disp_tm_sngl</span><span class="p">()</span>
<a name="ln-3717"></a>   <span class="k">call </span><span class="n">test_disp_ts_cpld</span><span class="p">()</span>
<a name="ln-3718"></a>   <span class="k">call </span><span class="n">test_disp_ts_cplx</span><span class="p">()</span>
<a name="ln-3719"></a>   <span class="k">call </span><span class="n">test_disp_ts_dble</span><span class="p">()</span>
<a name="ln-3720"></a>   <span class="k">call </span><span class="n">test_disp_ts_dchr</span><span class="p">()</span>
<a name="ln-3721"></a>   <span class="k">call </span><span class="n">test_disp_ts_dlog</span><span class="p">()</span>
<a name="ln-3722"></a>   <span class="k">call </span><span class="n">test_disp_ts_sngl</span><span class="p">()</span>
<a name="ln-3723"></a>   <span class="k">call </span><span class="n">test_disp_tv_cpld</span><span class="p">()</span>
<a name="ln-3724"></a>   <span class="k">call </span><span class="n">test_disp_tv_cplx</span><span class="p">()</span>
<a name="ln-3725"></a>   <span class="k">call </span><span class="n">test_disp_tv_dble</span><span class="p">()</span>
<a name="ln-3726"></a>   <span class="k">call </span><span class="n">test_disp_tv_dchr</span><span class="p">()</span>
<a name="ln-3727"></a>   <span class="k">call </span><span class="n">test_disp_tv_dlog</span><span class="p">()</span>
<a name="ln-3728"></a>   <span class="k">call </span><span class="n">test_disp_tv_sngl</span><span class="p">()</span>
<a name="ln-3729"></a>   <span class="k">call </span><span class="n">test_disp_v_cpld</span><span class="p">()</span>
<a name="ln-3730"></a>   <span class="k">call </span><span class="n">test_disp_v_cplx</span><span class="p">()</span>
<a name="ln-3731"></a>   <span class="k">call </span><span class="n">test_disp_v_dble</span><span class="p">()</span>
<a name="ln-3732"></a>   <span class="k">call </span><span class="n">test_disp_v_dchr</span><span class="p">()</span>
<a name="ln-3733"></a>   <span class="k">call </span><span class="n">test_disp_v_dlog</span><span class="p">()</span>
<a name="ln-3734"></a>   <span class="k">call </span><span class="n">test_disp_v_sngl</span><span class="p">()</span>
<a name="ln-3735"></a>   <span class="k">call </span><span class="n">test_disp_vector_int</span><span class="p">()</span>
<a name="ln-3736"></a>   <span class="k">call </span><span class="n">test_len_f_cpld</span><span class="p">()</span>
<a name="ln-3737"></a>   <span class="k">call </span><span class="n">test_len_f_cplx</span><span class="p">()</span>
<a name="ln-3738"></a>   <span class="k">call </span><span class="n">test_len_f_dble</span><span class="p">()</span>
<a name="ln-3739"></a>   <span class="k">call </span><span class="n">test_len_f_dint</span><span class="p">()</span>
<a name="ln-3740"></a>   <span class="k">call </span><span class="n">test_len_f_dlog</span><span class="p">()</span>
<a name="ln-3741"></a>   <span class="k">call </span><span class="n">test_len_f_sngl</span><span class="p">()</span>
<a name="ln-3742"></a>   <span class="k">call </span><span class="n">test_len_s_cpld</span><span class="p">()</span>
<a name="ln-3743"></a>   <span class="k">call </span><span class="n">test_len_s_cplx</span><span class="p">()</span>
<a name="ln-3744"></a>   <span class="k">call </span><span class="n">test_tostring_cpld</span><span class="p">()</span>
<a name="ln-3745"></a>   <span class="k">call </span><span class="n">test_tostring_cplx</span><span class="p">()</span>
<a name="ln-3746"></a>   <span class="k">call </span><span class="n">test_tostring_dble</span><span class="p">()</span>
<a name="ln-3747"></a>   <span class="k">call </span><span class="n">test_tostring_dint</span><span class="p">()</span>
<a name="ln-3748"></a>   <span class="k">call </span><span class="n">test_tostring_dlog</span><span class="p">()</span>
<a name="ln-3749"></a>   <span class="k">call </span><span class="n">test_tostring_f_cpld</span><span class="p">()</span>
<a name="ln-3750"></a>   <span class="k">call </span><span class="n">test_tostring_f_cplx</span><span class="p">()</span>
<a name="ln-3751"></a>   <span class="k">call </span><span class="n">test_tostring_f_dble</span><span class="p">()</span>
<a name="ln-3752"></a>   <span class="k">call </span><span class="n">test_tostring_f_dint</span><span class="p">()</span>
<a name="ln-3753"></a>   <span class="k">call </span><span class="n">test_tostring_f_dlog</span><span class="p">()</span>
<a name="ln-3754"></a>   <span class="k">call </span><span class="n">test_tostring_f_sngl</span><span class="p">()</span>
<a name="ln-3755"></a>   <span class="k">call </span><span class="n">test_tostring_s_cpld</span><span class="p">()</span>
<a name="ln-3756"></a>   <span class="k">call </span><span class="n">test_tostring_s_cplx</span><span class="p">()</span>
<a name="ln-3757"></a>   <span class="k">call </span><span class="n">test_tostring_s_dble</span><span class="p">()</span>
<a name="ln-3758"></a>   <span class="k">call </span><span class="n">test_tostring_s_dint</span><span class="p">()</span>
<a name="ln-3759"></a>   <span class="k">call </span><span class="n">test_tostring_s_dlog</span><span class="p">()</span>
<a name="ln-3760"></a>   <span class="k">call </span><span class="n">test_tostring_s_sngl</span><span class="p">()</span>
<a name="ln-3761"></a>   <span class="k">call </span><span class="n">test_tostring_set</span><span class="p">()</span>
<a name="ln-3762"></a>   <span class="k">call </span><span class="n">test_tostring_set_factory</span><span class="p">()</span>
<a name="ln-3763"></a>   <span class="k">call </span><span class="n">test_tostring_sf_cpld</span><span class="p">()</span>
<a name="ln-3764"></a>   <span class="k">call </span><span class="n">test_tostring_sf_cplx</span><span class="p">()</span>
<a name="ln-3765"></a>   <span class="k">call </span><span class="n">test_tostring_sf_dble</span><span class="p">()</span>
<a name="ln-3766"></a>   <span class="k">call </span><span class="n">test_tostring_sf_dint</span><span class="p">()</span>
<a name="ln-3767"></a>   <span class="k">call </span><span class="n">test_tostring_sf_dlog</span><span class="p">()</span>
<a name="ln-3768"></a>   <span class="k">call </span><span class="n">test_tostring_sf_sngl</span><span class="p">()</span>
<a name="ln-3769"></a>   <span class="k">call </span><span class="n">test_tostring_sngl</span><span class="p">()</span>
<a name="ln-3770"></a>   <span class="k">call </span><span class="n">test_check_settings</span><span class="p">()</span>
<a name="ln-3771"></a>   <span class="k">call </span><span class="n">test_copyseptobox</span><span class="p">()</span>
<a name="ln-3772"></a>   <span class="k">call </span><span class="n">test_copytobox</span><span class="p">()</span>
<a name="ln-3773"></a>   <span class="k">call </span><span class="n">test_disp_errmsg</span><span class="p">()</span>
<a name="ln-3774"></a>   <span class="k">call </span><span class="n">test_find_editdesc_real</span><span class="p">()</span>
<a name="ln-3775"></a>   <span class="k">call </span><span class="n">test_finishbox</span><span class="p">()</span>
<a name="ln-3776"></a>   <span class="k">call </span><span class="n">test_get_se</span><span class="p">()</span>
<a name="ln-3777"></a>   <span class="k">call </span><span class="n">test_nnblk</span><span class="p">()</span>
<a name="ln-3778"></a>   <span class="k">call </span><span class="n">test_preparebox</span><span class="p">()</span>
<a name="ln-3779"></a>   <span class="k">call </span><span class="n">test_readfmt</span><span class="p">()</span>
<a name="ln-3780"></a>   <span class="k">call </span><span class="n">test_replace_w</span><span class="p">()</span>
<a name="ln-3781"></a>   <span class="k">call </span><span class="n">test_replace_zeronaninf</span><span class="p">()</span>
<a name="ln-3782"></a>   <span class="k">call </span><span class="n">test_tostring_check_settings</span><span class="p">()</span>
<a name="ln-3783"></a>   <span class="k">call </span><span class="n">test_tostring_get</span><span class="p">()</span>
<a name="ln-3784"></a>   <span class="k">call </span><span class="n">test_tostring_get_complex</span><span class="p">()</span>
<a name="ln-3785"></a>   <span class="k">call </span><span class="n">test_trim_real</span><span class="p">()</span>
<a name="ln-3786"></a>   <span class="k">call </span><span class="n">test_trim_s_real</span><span class="p">()</span>
<a name="ln-3787"></a>   <span class="k">call </span><span class="n">test_upper</span><span class="p">()</span>
<a name="ln-3788"></a>   <span class="k">call </span><span class="n">test_putnl</span><span class="p">()</span>
<a name="ln-3789"></a>   <span class="k">call </span><span class="n">test_putstr</span><span class="p">()</span>
<a name="ln-3790"></a><span class="c">!! teardown</span>
<a name="ln-3791"></a><span class="k">contains</span>
<a name="ln-3792"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3793"></a><span class="k">subroutine </span><span class="n">test_disp_get</span><span class="p">()</span>
<a name="ln-3794"></a>
<a name="ln-3795"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_get&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3796"></a>   <span class="c">!!call unit_check(&#39;disp_get&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3797"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_get&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3798"></a><span class="k">end subroutine </span><span class="n">test_disp_get</span>
<a name="ln-3799"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3800"></a><span class="k">subroutine </span><span class="n">test_disp_m_cpld</span><span class="p">()</span>
<a name="ln-3801"></a>
<a name="ln-3802"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_m_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3803"></a>   <span class="c">!!call unit_check(&#39;disp_m_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3804"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_m_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3805"></a><span class="k">end subroutine </span><span class="n">test_disp_m_cpld</span>
<a name="ln-3806"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3807"></a><span class="k">subroutine </span><span class="n">test_disp_m_cplx</span><span class="p">()</span>
<a name="ln-3808"></a>
<a name="ln-3809"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_m_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3810"></a>   <span class="c">!!call unit_check(&#39;disp_m_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3811"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_m_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3812"></a><span class="k">end subroutine </span><span class="n">test_disp_m_cplx</span>
<a name="ln-3813"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3814"></a><span class="k">subroutine </span><span class="n">test_disp_m_dble</span><span class="p">()</span>
<a name="ln-3815"></a>
<a name="ln-3816"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_m_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3817"></a>   <span class="c">!!call unit_check(&#39;disp_m_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3818"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_m_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3819"></a><span class="k">end subroutine </span><span class="n">test_disp_m_dble</span>
<a name="ln-3820"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3821"></a><span class="k">subroutine </span><span class="n">test_disp_m_dchr</span><span class="p">()</span>
<a name="ln-3822"></a>
<a name="ln-3823"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_m_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3824"></a>   <span class="c">!!call unit_check(&#39;disp_m_dchr&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3825"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_m_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3826"></a><span class="k">end subroutine </span><span class="n">test_disp_m_dchr</span>
<a name="ln-3827"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3828"></a><span class="k">subroutine </span><span class="n">test_disp_m_dlog</span><span class="p">()</span>
<a name="ln-3829"></a>
<a name="ln-3830"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_m_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3831"></a>   <span class="c">!!call unit_check(&#39;disp_m_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3832"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_m_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3833"></a><span class="k">end subroutine </span><span class="n">test_disp_m_dlog</span>
<a name="ln-3834"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3835"></a><span class="k">subroutine </span><span class="n">test_disp_m_sngl</span><span class="p">()</span>
<a name="ln-3836"></a>
<a name="ln-3837"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_m_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3838"></a>   <span class="c">!!call unit_check(&#39;disp_m_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3839"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_m_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3840"></a><span class="k">end subroutine </span><span class="n">test_disp_m_sngl</span>
<a name="ln-3841"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3842"></a><span class="k">subroutine </span><span class="n">test_disp_matrix_int</span><span class="p">()</span>
<a name="ln-3843"></a>
<a name="ln-3844"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_matrix_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3845"></a>   <span class="c">!!call unit_check(&#39;disp_matrix_int&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3846"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_matrix_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3847"></a><span class="k">end subroutine </span><span class="n">test_disp_matrix_int</span>
<a name="ln-3848"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3849"></a><span class="k">subroutine </span><span class="n">test_disp_s_cpld</span><span class="p">()</span>
<a name="ln-3850"></a>
<a name="ln-3851"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_s_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3852"></a>   <span class="c">!!call unit_check(&#39;disp_s_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3853"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_s_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3854"></a><span class="k">end subroutine </span><span class="n">test_disp_s_cpld</span>
<a name="ln-3855"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3856"></a><span class="k">subroutine </span><span class="n">test_disp_s_cplx</span><span class="p">()</span>
<a name="ln-3857"></a>
<a name="ln-3858"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_s_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3859"></a>   <span class="c">!!call unit_check(&#39;disp_s_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3860"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_s_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3861"></a><span class="k">end subroutine </span><span class="n">test_disp_s_cplx</span>
<a name="ln-3862"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3863"></a><span class="k">subroutine </span><span class="n">test_disp_s_dble</span><span class="p">()</span>
<a name="ln-3864"></a>
<a name="ln-3865"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_s_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3866"></a>   <span class="c">!!call unit_check(&#39;disp_s_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3867"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_s_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3868"></a><span class="k">end subroutine </span><span class="n">test_disp_s_dble</span>
<a name="ln-3869"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3870"></a><span class="k">subroutine </span><span class="n">test_disp_s_dlog</span><span class="p">()</span>
<a name="ln-3871"></a>
<a name="ln-3872"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_s_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3873"></a>   <span class="c">!!call unit_check(&#39;disp_s_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3874"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_s_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3875"></a><span class="k">end subroutine </span><span class="n">test_disp_s_dlog</span>
<a name="ln-3876"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3877"></a><span class="k">subroutine </span><span class="n">test_disp_s_sngl</span><span class="p">()</span>
<a name="ln-3878"></a>
<a name="ln-3879"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_s_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3880"></a>   <span class="c">!!call unit_check(&#39;disp_s_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3881"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_s_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3882"></a><span class="k">end subroutine </span><span class="n">test_disp_s_sngl</span>
<a name="ln-3883"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3884"></a><span class="k">subroutine </span><span class="n">test_disp_scalar_int</span><span class="p">()</span>
<a name="ln-3885"></a>
<a name="ln-3886"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_scalar_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3887"></a>   <span class="c">!!call unit_check(&#39;disp_scalar_int&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3888"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_scalar_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3889"></a><span class="k">end subroutine </span><span class="n">test_disp_scalar_int</span>
<a name="ln-3890"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3891"></a><span class="k">subroutine </span><span class="n">test_disp_set</span><span class="p">()</span>
<a name="ln-3892"></a>
<a name="ln-3893"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_set&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3894"></a>   <span class="c">!!call unit_check(&#39;disp_set&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3895"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_set&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3896"></a><span class="k">end subroutine </span><span class="n">test_disp_set</span>
<a name="ln-3897"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3898"></a><span class="k">subroutine </span><span class="n">test_disp_set_ds</span><span class="p">()</span>
<a name="ln-3899"></a>
<a name="ln-3900"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_set_ds&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3901"></a>   <span class="c">!!call unit_check(&#39;disp_set_ds&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3902"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_set_ds&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3903"></a><span class="k">end subroutine </span><span class="n">test_disp_set_ds</span>
<a name="ln-3904"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3905"></a><span class="k">subroutine </span><span class="n">test_disp_set_factory</span><span class="p">()</span>
<a name="ln-3906"></a>
<a name="ln-3907"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_set_factory&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3908"></a>   <span class="c">!!call unit_check(&#39;disp_set_factory&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3909"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_set_factory&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3910"></a><span class="k">end subroutine </span><span class="n">test_disp_set_factory</span>
<a name="ln-3911"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3912"></a><span class="k">subroutine </span><span class="n">test_disp_title_matrix_int</span><span class="p">()</span>
<a name="ln-3913"></a>
<a name="ln-3914"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_title_matrix_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3915"></a>   <span class="c">!!call unit_check(&#39;disp_title_matrix_int&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3916"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_title_matrix_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3917"></a><span class="k">end subroutine </span><span class="n">test_disp_title_matrix_int</span>
<a name="ln-3918"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3919"></a><span class="k">subroutine </span><span class="n">test_disp_title_scalar_int</span><span class="p">()</span>
<a name="ln-3920"></a>
<a name="ln-3921"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_title_scalar_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3922"></a>   <span class="c">!!call unit_check(&#39;disp_title_scalar_int&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3923"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_title_scalar_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3924"></a><span class="k">end subroutine </span><span class="n">test_disp_title_scalar_int</span>
<a name="ln-3925"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3926"></a><span class="k">subroutine </span><span class="n">test_disp_title_vector_int</span><span class="p">()</span>
<a name="ln-3927"></a>
<a name="ln-3928"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_title_vector_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3929"></a>   <span class="c">!!call unit_check(&#39;disp_title_vector_int&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3930"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_title_vector_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3931"></a><span class="k">end subroutine </span><span class="n">test_disp_title_vector_int</span>
<a name="ln-3932"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3933"></a><span class="k">subroutine </span><span class="n">test_disp_tm_cpld</span><span class="p">()</span>
<a name="ln-3934"></a>
<a name="ln-3935"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tm_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3936"></a>   <span class="c">!!call unit_check(&#39;disp_tm_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3937"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tm_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3938"></a><span class="k">end subroutine </span><span class="n">test_disp_tm_cpld</span>
<a name="ln-3939"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3940"></a><span class="k">subroutine </span><span class="n">test_disp_tm_cplx</span><span class="p">()</span>
<a name="ln-3941"></a>
<a name="ln-3942"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tm_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3943"></a>   <span class="c">!!call unit_check(&#39;disp_tm_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3944"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tm_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3945"></a><span class="k">end subroutine </span><span class="n">test_disp_tm_cplx</span>
<a name="ln-3946"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3947"></a><span class="k">subroutine </span><span class="n">test_disp_tm_dble</span><span class="p">()</span>
<a name="ln-3948"></a>
<a name="ln-3949"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tm_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3950"></a>   <span class="c">!!call unit_check(&#39;disp_tm_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3951"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tm_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3952"></a><span class="k">end subroutine </span><span class="n">test_disp_tm_dble</span>
<a name="ln-3953"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3954"></a><span class="k">subroutine </span><span class="n">test_disp_tm_dchr</span><span class="p">()</span>
<a name="ln-3955"></a>
<a name="ln-3956"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tm_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3957"></a>   <span class="c">!!call unit_check(&#39;disp_tm_dchr&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3958"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tm_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3959"></a><span class="k">end subroutine </span><span class="n">test_disp_tm_dchr</span>
<a name="ln-3960"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3961"></a><span class="k">subroutine </span><span class="n">test_disp_tm_dlog</span><span class="p">()</span>
<a name="ln-3962"></a>
<a name="ln-3963"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tm_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3964"></a>   <span class="c">!!call unit_check(&#39;disp_tm_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3965"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tm_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3966"></a><span class="k">end subroutine </span><span class="n">test_disp_tm_dlog</span>
<a name="ln-3967"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3968"></a><span class="k">subroutine </span><span class="n">test_disp_tm_sngl</span><span class="p">()</span>
<a name="ln-3969"></a>
<a name="ln-3970"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tm_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3971"></a>   <span class="c">!!call unit_check(&#39;disp_tm_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3972"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tm_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3973"></a><span class="k">end subroutine </span><span class="n">test_disp_tm_sngl</span>
<a name="ln-3974"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3975"></a><span class="k">subroutine </span><span class="n">test_disp_ts_cpld</span><span class="p">()</span>
<a name="ln-3976"></a>
<a name="ln-3977"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_ts_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3978"></a>   <span class="c">!!call unit_check(&#39;disp_ts_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3979"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_ts_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3980"></a><span class="k">end subroutine </span><span class="n">test_disp_ts_cpld</span>
<a name="ln-3981"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3982"></a><span class="k">subroutine </span><span class="n">test_disp_ts_cplx</span><span class="p">()</span>
<a name="ln-3983"></a>
<a name="ln-3984"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_ts_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3985"></a>   <span class="c">!!call unit_check(&#39;disp_ts_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3986"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_ts_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3987"></a><span class="k">end subroutine </span><span class="n">test_disp_ts_cplx</span>
<a name="ln-3988"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3989"></a><span class="k">subroutine </span><span class="n">test_disp_ts_dble</span><span class="p">()</span>
<a name="ln-3990"></a>
<a name="ln-3991"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_ts_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3992"></a>   <span class="c">!!call unit_check(&#39;disp_ts_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-3993"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_ts_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3994"></a><span class="k">end subroutine </span><span class="n">test_disp_ts_dble</span>
<a name="ln-3995"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-3996"></a><span class="k">subroutine </span><span class="n">test_disp_ts_dchr</span><span class="p">()</span>
<a name="ln-3997"></a>
<a name="ln-3998"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_ts_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-3999"></a>   <span class="c">!!call unit_check(&#39;disp_ts_dchr&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4000"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_ts_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4001"></a><span class="k">end subroutine </span><span class="n">test_disp_ts_dchr</span>
<a name="ln-4002"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4003"></a><span class="k">subroutine </span><span class="n">test_disp_ts_dlog</span><span class="p">()</span>
<a name="ln-4004"></a>
<a name="ln-4005"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_ts_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4006"></a>   <span class="c">!!call unit_check(&#39;disp_ts_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4007"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_ts_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4008"></a><span class="k">end subroutine </span><span class="n">test_disp_ts_dlog</span>
<a name="ln-4009"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4010"></a><span class="k">subroutine </span><span class="n">test_disp_ts_sngl</span><span class="p">()</span>
<a name="ln-4011"></a>
<a name="ln-4012"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_ts_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4013"></a>   <span class="c">!!call unit_check(&#39;disp_ts_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4014"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_ts_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4015"></a><span class="k">end subroutine </span><span class="n">test_disp_ts_sngl</span>
<a name="ln-4016"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4017"></a><span class="k">subroutine </span><span class="n">test_disp_tv_cpld</span><span class="p">()</span>
<a name="ln-4018"></a>
<a name="ln-4019"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tv_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4020"></a>   <span class="c">!!call unit_check(&#39;disp_tv_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4021"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tv_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4022"></a><span class="k">end subroutine </span><span class="n">test_disp_tv_cpld</span>
<a name="ln-4023"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4024"></a><span class="k">subroutine </span><span class="n">test_disp_tv_cplx</span><span class="p">()</span>
<a name="ln-4025"></a>
<a name="ln-4026"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tv_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4027"></a>   <span class="c">!!call unit_check(&#39;disp_tv_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4028"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tv_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4029"></a><span class="k">end subroutine </span><span class="n">test_disp_tv_cplx</span>
<a name="ln-4030"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4031"></a><span class="k">subroutine </span><span class="n">test_disp_tv_dble</span><span class="p">()</span>
<a name="ln-4032"></a>
<a name="ln-4033"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tv_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4034"></a>   <span class="c">!!call unit_check(&#39;disp_tv_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4035"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tv_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4036"></a><span class="k">end subroutine </span><span class="n">test_disp_tv_dble</span>
<a name="ln-4037"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4038"></a><span class="k">subroutine </span><span class="n">test_disp_tv_dchr</span><span class="p">()</span>
<a name="ln-4039"></a>
<a name="ln-4040"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tv_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4041"></a>   <span class="c">!!call unit_check(&#39;disp_tv_dchr&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4042"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tv_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4043"></a><span class="k">end subroutine </span><span class="n">test_disp_tv_dchr</span>
<a name="ln-4044"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4045"></a><span class="k">subroutine </span><span class="n">test_disp_tv_dlog</span><span class="p">()</span>
<a name="ln-4046"></a>
<a name="ln-4047"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tv_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4048"></a>   <span class="c">!!call unit_check(&#39;disp_tv_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4049"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tv_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4050"></a><span class="k">end subroutine </span><span class="n">test_disp_tv_dlog</span>
<a name="ln-4051"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4052"></a><span class="k">subroutine </span><span class="n">test_disp_tv_sngl</span><span class="p">()</span>
<a name="ln-4053"></a>
<a name="ln-4054"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_tv_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4055"></a>   <span class="c">!!call unit_check(&#39;disp_tv_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4056"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_tv_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4057"></a><span class="k">end subroutine </span><span class="n">test_disp_tv_sngl</span>
<a name="ln-4058"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4059"></a><span class="k">subroutine </span><span class="n">test_disp_v_cpld</span><span class="p">()</span>
<a name="ln-4060"></a>
<a name="ln-4061"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_v_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4062"></a>   <span class="c">!!call unit_check(&#39;disp_v_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4063"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_v_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4064"></a><span class="k">end subroutine </span><span class="n">test_disp_v_cpld</span>
<a name="ln-4065"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4066"></a><span class="k">subroutine </span><span class="n">test_disp_v_cplx</span><span class="p">()</span>
<a name="ln-4067"></a>
<a name="ln-4068"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_v_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4069"></a>   <span class="c">!!call unit_check(&#39;disp_v_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4070"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_v_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4071"></a><span class="k">end subroutine </span><span class="n">test_disp_v_cplx</span>
<a name="ln-4072"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4073"></a><span class="k">subroutine </span><span class="n">test_disp_v_dble</span><span class="p">()</span>
<a name="ln-4074"></a>
<a name="ln-4075"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_v_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4076"></a>   <span class="c">!!call unit_check(&#39;disp_v_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4077"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_v_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4078"></a><span class="k">end subroutine </span><span class="n">test_disp_v_dble</span>
<a name="ln-4079"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4080"></a><span class="k">subroutine </span><span class="n">test_disp_v_dchr</span><span class="p">()</span>
<a name="ln-4081"></a>
<a name="ln-4082"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_v_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4083"></a>   <span class="c">!!call unit_check(&#39;disp_v_dchr&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4084"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_v_dchr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4085"></a><span class="k">end subroutine </span><span class="n">test_disp_v_dchr</span>
<a name="ln-4086"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4087"></a><span class="k">subroutine </span><span class="n">test_disp_v_dlog</span><span class="p">()</span>
<a name="ln-4088"></a>
<a name="ln-4089"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_v_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4090"></a>   <span class="c">!!call unit_check(&#39;disp_v_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4091"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_v_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4092"></a><span class="k">end subroutine </span><span class="n">test_disp_v_dlog</span>
<a name="ln-4093"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4094"></a><span class="k">subroutine </span><span class="n">test_disp_v_sngl</span><span class="p">()</span>
<a name="ln-4095"></a>
<a name="ln-4096"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_v_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4097"></a>   <span class="c">!!call unit_check(&#39;disp_v_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4098"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_v_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4099"></a><span class="k">end subroutine </span><span class="n">test_disp_v_sngl</span>
<a name="ln-4100"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4101"></a><span class="k">subroutine </span><span class="n">test_disp_vector_int</span><span class="p">()</span>
<a name="ln-4102"></a>
<a name="ln-4103"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_vector_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4104"></a>   <span class="c">!!call unit_check(&#39;disp_vector_int&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4105"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_vector_int&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4106"></a><span class="k">end subroutine </span><span class="n">test_disp_vector_int</span>
<a name="ln-4107"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4108"></a><span class="k">subroutine </span><span class="n">test_len_f_cpld</span><span class="p">()</span>
<a name="ln-4109"></a>
<a name="ln-4110"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_f_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4111"></a>   <span class="c">!!call unit_check(&#39;len_f_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4112"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_f_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4113"></a><span class="k">end subroutine </span><span class="n">test_len_f_cpld</span>
<a name="ln-4114"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4115"></a><span class="k">subroutine </span><span class="n">test_len_f_cplx</span><span class="p">()</span>
<a name="ln-4116"></a>
<a name="ln-4117"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_f_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4118"></a>   <span class="c">!!call unit_check(&#39;len_f_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4119"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_f_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4120"></a><span class="k">end subroutine </span><span class="n">test_len_f_cplx</span>
<a name="ln-4121"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4122"></a><span class="k">subroutine </span><span class="n">test_len_f_dble</span><span class="p">()</span>
<a name="ln-4123"></a>
<a name="ln-4124"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_f_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4125"></a>   <span class="c">!!call unit_check(&#39;len_f_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4126"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_f_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4127"></a><span class="k">end subroutine </span><span class="n">test_len_f_dble</span>
<a name="ln-4128"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4129"></a><span class="k">subroutine </span><span class="n">test_len_f_dint</span><span class="p">()</span>
<a name="ln-4130"></a>
<a name="ln-4131"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_f_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4132"></a>   <span class="c">!!call unit_check(&#39;len_f_dint&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4133"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_f_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4134"></a><span class="k">end subroutine </span><span class="n">test_len_f_dint</span>
<a name="ln-4135"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4136"></a><span class="k">subroutine </span><span class="n">test_len_f_dlog</span><span class="p">()</span>
<a name="ln-4137"></a>
<a name="ln-4138"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_f_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4139"></a>   <span class="c">!!call unit_check(&#39;len_f_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4140"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_f_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4141"></a><span class="k">end subroutine </span><span class="n">test_len_f_dlog</span>
<a name="ln-4142"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4143"></a><span class="k">subroutine </span><span class="n">test_len_f_sngl</span><span class="p">()</span>
<a name="ln-4144"></a>
<a name="ln-4145"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_f_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4146"></a>   <span class="c">!!call unit_check(&#39;len_f_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4147"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_f_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4148"></a><span class="k">end subroutine </span><span class="n">test_len_f_sngl</span>
<a name="ln-4149"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4150"></a><span class="k">subroutine </span><span class="n">test_len_s_cpld</span><span class="p">()</span>
<a name="ln-4151"></a>
<a name="ln-4152"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_s_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4153"></a>   <span class="c">!!call unit_check(&#39;len_s_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4154"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_s_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4155"></a><span class="k">end subroutine </span><span class="n">test_len_s_cpld</span>
<a name="ln-4156"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4157"></a><span class="k">subroutine </span><span class="n">test_len_s_cplx</span><span class="p">()</span>
<a name="ln-4158"></a>
<a name="ln-4159"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;len_s_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4160"></a>   <span class="c">!!call unit_check(&#39;len_s_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4161"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;len_s_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4162"></a><span class="k">end subroutine </span><span class="n">test_len_s_cplx</span>
<a name="ln-4163"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4164"></a><span class="k">subroutine </span><span class="n">test_tostring_cpld</span><span class="p">()</span>
<a name="ln-4165"></a>
<a name="ln-4166"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4167"></a>   <span class="c">!!call unit_check(&#39;tostring_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4168"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4169"></a><span class="k">end subroutine </span><span class="n">test_tostring_cpld</span>
<a name="ln-4170"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4171"></a><span class="k">subroutine </span><span class="n">test_tostring_cplx</span><span class="p">()</span>
<a name="ln-4172"></a>
<a name="ln-4173"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4174"></a>   <span class="c">!!call unit_check(&#39;tostring_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4175"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4176"></a><span class="k">end subroutine </span><span class="n">test_tostring_cplx</span>
<a name="ln-4177"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4178"></a><span class="k">subroutine </span><span class="n">test_tostring_dble</span><span class="p">()</span>
<a name="ln-4179"></a>
<a name="ln-4180"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4181"></a>   <span class="c">!!call unit_check(&#39;tostring_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4182"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4183"></a><span class="k">end subroutine </span><span class="n">test_tostring_dble</span>
<a name="ln-4184"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4185"></a><span class="k">subroutine </span><span class="n">test_tostring_dint</span><span class="p">()</span>
<a name="ln-4186"></a>
<a name="ln-4187"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4188"></a>   <span class="c">!!call unit_check(&#39;tostring_dint&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4189"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4190"></a><span class="k">end subroutine </span><span class="n">test_tostring_dint</span>
<a name="ln-4191"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4192"></a><span class="k">subroutine </span><span class="n">test_tostring_dlog</span><span class="p">()</span>
<a name="ln-4193"></a>
<a name="ln-4194"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4195"></a>   <span class="c">!!call unit_check(&#39;tostring_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4196"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4197"></a><span class="k">end subroutine </span><span class="n">test_tostring_dlog</span>
<a name="ln-4198"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4199"></a><span class="k">subroutine </span><span class="n">test_tostring_f_cpld</span><span class="p">()</span>
<a name="ln-4200"></a>
<a name="ln-4201"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_f_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4202"></a>   <span class="c">!!call unit_check(&#39;tostring_f_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4203"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_f_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4204"></a><span class="k">end subroutine </span><span class="n">test_tostring_f_cpld</span>
<a name="ln-4205"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4206"></a><span class="k">subroutine </span><span class="n">test_tostring_f_cplx</span><span class="p">()</span>
<a name="ln-4207"></a>
<a name="ln-4208"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_f_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4209"></a>   <span class="c">!!call unit_check(&#39;tostring_f_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4210"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_f_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4211"></a><span class="k">end subroutine </span><span class="n">test_tostring_f_cplx</span>
<a name="ln-4212"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4213"></a><span class="k">subroutine </span><span class="n">test_tostring_f_dble</span><span class="p">()</span>
<a name="ln-4214"></a>
<a name="ln-4215"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_f_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4216"></a>   <span class="c">!!call unit_check(&#39;tostring_f_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4217"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_f_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4218"></a><span class="k">end subroutine </span><span class="n">test_tostring_f_dble</span>
<a name="ln-4219"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4220"></a><span class="k">subroutine </span><span class="n">test_tostring_f_dint</span><span class="p">()</span>
<a name="ln-4221"></a>
<a name="ln-4222"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_f_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4223"></a>   <span class="c">!!call unit_check(&#39;tostring_f_dint&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4224"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_f_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4225"></a><span class="k">end subroutine </span><span class="n">test_tostring_f_dint</span>
<a name="ln-4226"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4227"></a><span class="k">subroutine </span><span class="n">test_tostring_f_dlog</span><span class="p">()</span>
<a name="ln-4228"></a>
<a name="ln-4229"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_f_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4230"></a>   <span class="c">!!call unit_check(&#39;tostring_f_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4231"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_f_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4232"></a><span class="k">end subroutine </span><span class="n">test_tostring_f_dlog</span>
<a name="ln-4233"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4234"></a><span class="k">subroutine </span><span class="n">test_tostring_f_sngl</span><span class="p">()</span>
<a name="ln-4235"></a>
<a name="ln-4236"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_f_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4237"></a>   <span class="c">!!call unit_check(&#39;tostring_f_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4238"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_f_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4239"></a><span class="k">end subroutine </span><span class="n">test_tostring_f_sngl</span>
<a name="ln-4240"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4241"></a><span class="k">subroutine </span><span class="n">test_tostring_s_cpld</span><span class="p">()</span>
<a name="ln-4242"></a>
<a name="ln-4243"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_s_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4244"></a>   <span class="c">!!call unit_check(&#39;tostring_s_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4245"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_s_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4246"></a><span class="k">end subroutine </span><span class="n">test_tostring_s_cpld</span>
<a name="ln-4247"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4248"></a><span class="k">subroutine </span><span class="n">test_tostring_s_cplx</span><span class="p">()</span>
<a name="ln-4249"></a>
<a name="ln-4250"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_s_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4251"></a>   <span class="c">!!call unit_check(&#39;tostring_s_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4252"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_s_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4253"></a><span class="k">end subroutine </span><span class="n">test_tostring_s_cplx</span>
<a name="ln-4254"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4255"></a><span class="k">subroutine </span><span class="n">test_tostring_s_dble</span><span class="p">()</span>
<a name="ln-4256"></a>
<a name="ln-4257"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_s_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4258"></a>   <span class="c">!!call unit_check(&#39;tostring_s_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4259"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_s_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4260"></a><span class="k">end subroutine </span><span class="n">test_tostring_s_dble</span>
<a name="ln-4261"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4262"></a><span class="k">subroutine </span><span class="n">test_tostring_s_dint</span><span class="p">()</span>
<a name="ln-4263"></a>
<a name="ln-4264"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_s_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4265"></a>   <span class="c">!!call unit_check(&#39;tostring_s_dint&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4266"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_s_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4267"></a><span class="k">end subroutine </span><span class="n">test_tostring_s_dint</span>
<a name="ln-4268"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4269"></a><span class="k">subroutine </span><span class="n">test_tostring_s_dlog</span><span class="p">()</span>
<a name="ln-4270"></a>
<a name="ln-4271"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_s_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4272"></a>   <span class="c">!!call unit_check(&#39;tostring_s_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4273"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_s_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4274"></a><span class="k">end subroutine </span><span class="n">test_tostring_s_dlog</span>
<a name="ln-4275"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4276"></a><span class="k">subroutine </span><span class="n">test_tostring_s_sngl</span><span class="p">()</span>
<a name="ln-4277"></a>
<a name="ln-4278"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_s_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4279"></a>   <span class="c">!!call unit_check(&#39;tostring_s_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4280"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_s_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4281"></a><span class="k">end subroutine </span><span class="n">test_tostring_s_sngl</span>
<a name="ln-4282"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4283"></a><span class="k">subroutine </span><span class="n">test_tostring_set</span><span class="p">()</span>
<a name="ln-4284"></a>
<a name="ln-4285"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_set&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4286"></a>   <span class="c">!!call unit_check(&#39;tostring_set&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4287"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_set&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4288"></a><span class="k">end subroutine </span><span class="n">test_tostring_set</span>
<a name="ln-4289"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4290"></a><span class="k">subroutine </span><span class="n">test_tostring_set_factory</span><span class="p">()</span>
<a name="ln-4291"></a>
<a name="ln-4292"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_set_factory&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4293"></a>   <span class="c">!!call unit_check(&#39;tostring_set_factory&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4294"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_set_factory&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4295"></a><span class="k">end subroutine </span><span class="n">test_tostring_set_factory</span>
<a name="ln-4296"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4297"></a><span class="k">subroutine </span><span class="n">test_tostring_sf_cpld</span><span class="p">()</span>
<a name="ln-4298"></a>
<a name="ln-4299"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sf_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4300"></a>   <span class="c">!!call unit_check(&#39;tostring_sf_cpld&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4301"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sf_cpld&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4302"></a><span class="k">end subroutine </span><span class="n">test_tostring_sf_cpld</span>
<a name="ln-4303"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4304"></a><span class="k">subroutine </span><span class="n">test_tostring_sf_cplx</span><span class="p">()</span>
<a name="ln-4305"></a>
<a name="ln-4306"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sf_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4307"></a>   <span class="c">!!call unit_check(&#39;tostring_sf_cplx&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4308"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sf_cplx&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4309"></a><span class="k">end subroutine </span><span class="n">test_tostring_sf_cplx</span>
<a name="ln-4310"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4311"></a><span class="k">subroutine </span><span class="n">test_tostring_sf_dble</span><span class="p">()</span>
<a name="ln-4312"></a>
<a name="ln-4313"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sf_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4314"></a>   <span class="c">!!call unit_check(&#39;tostring_sf_dble&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4315"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sf_dble&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4316"></a><span class="k">end subroutine </span><span class="n">test_tostring_sf_dble</span>
<a name="ln-4317"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4318"></a><span class="k">subroutine </span><span class="n">test_tostring_sf_dint</span><span class="p">()</span>
<a name="ln-4319"></a>
<a name="ln-4320"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sf_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4321"></a>   <span class="c">!!call unit_check(&#39;tostring_sf_dint&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4322"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sf_dint&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4323"></a><span class="k">end subroutine </span><span class="n">test_tostring_sf_dint</span>
<a name="ln-4324"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4325"></a><span class="k">subroutine </span><span class="n">test_tostring_sf_dlog</span><span class="p">()</span>
<a name="ln-4326"></a>
<a name="ln-4327"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sf_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4328"></a>   <span class="c">!!call unit_check(&#39;tostring_sf_dlog&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4329"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sf_dlog&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4330"></a><span class="k">end subroutine </span><span class="n">test_tostring_sf_dlog</span>
<a name="ln-4331"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4332"></a><span class="k">subroutine </span><span class="n">test_tostring_sf_sngl</span><span class="p">()</span>
<a name="ln-4333"></a>
<a name="ln-4334"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sf_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4335"></a>   <span class="c">!!call unit_check(&#39;tostring_sf_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4336"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sf_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4337"></a><span class="k">end subroutine </span><span class="n">test_tostring_sf_sngl</span>
<a name="ln-4338"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4339"></a><span class="k">subroutine </span><span class="n">test_tostring_sngl</span><span class="p">()</span>
<a name="ln-4340"></a>
<a name="ln-4341"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4342"></a>   <span class="c">!!call unit_check(&#39;tostring_sngl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4343"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_sngl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4344"></a><span class="k">end subroutine </span><span class="n">test_tostring_sngl</span>
<a name="ln-4345"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4346"></a><span class="k">subroutine </span><span class="n">test_check_settings</span><span class="p">()</span>
<a name="ln-4347"></a>
<a name="ln-4348"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;check_settings&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4349"></a>   <span class="c">!!call unit_check(&#39;check_settings&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4350"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;check_settings&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4351"></a><span class="k">end subroutine </span><span class="n">test_check_settings</span>
<a name="ln-4352"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4353"></a><span class="k">subroutine </span><span class="n">test_copyseptobox</span><span class="p">()</span>
<a name="ln-4354"></a>
<a name="ln-4355"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;copyseptobox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4356"></a>   <span class="c">!!call unit_check(&#39;copyseptobox&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4357"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;copyseptobox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4358"></a><span class="k">end subroutine </span><span class="n">test_copyseptobox</span>
<a name="ln-4359"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4360"></a><span class="k">subroutine </span><span class="n">test_copytobox</span><span class="p">()</span>
<a name="ln-4361"></a>
<a name="ln-4362"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;copytobox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4363"></a>   <span class="c">!!call unit_check(&#39;copytobox&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4364"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;copytobox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4365"></a><span class="k">end subroutine </span><span class="n">test_copytobox</span>
<a name="ln-4366"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4367"></a><span class="k">subroutine </span><span class="n">test_disp_errmsg</span><span class="p">()</span>
<a name="ln-4368"></a>
<a name="ln-4369"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;disp_errmsg&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4370"></a>   <span class="c">!!call unit_check(&#39;disp_errmsg&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4371"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;disp_errmsg&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4372"></a><span class="k">end subroutine </span><span class="n">test_disp_errmsg</span>
<a name="ln-4373"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4374"></a><span class="k">subroutine </span><span class="n">test_find_editdesc_real</span><span class="p">()</span>
<a name="ln-4375"></a>
<a name="ln-4376"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;find_editdesc_real&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4377"></a>   <span class="c">!!call unit_check(&#39;find_editdesc_real&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4378"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;find_editdesc_real&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4379"></a><span class="k">end subroutine </span><span class="n">test_find_editdesc_real</span>
<a name="ln-4380"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4381"></a><span class="k">subroutine </span><span class="n">test_finishbox</span><span class="p">()</span>
<a name="ln-4382"></a>
<a name="ln-4383"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;finishbox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4384"></a>   <span class="c">!!call unit_check(&#39;finishbox&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4385"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;finishbox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4386"></a><span class="k">end subroutine </span><span class="n">test_finishbox</span>
<a name="ln-4387"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4388"></a><span class="k">subroutine </span><span class="n">test_get_se</span><span class="p">()</span>
<a name="ln-4389"></a>
<a name="ln-4390"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;get_se&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4391"></a>   <span class="c">!!call unit_check(&#39;get_se&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4392"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;get_se&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4393"></a><span class="k">end subroutine </span><span class="n">test_get_se</span>
<a name="ln-4394"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4395"></a><span class="k">subroutine </span><span class="n">test_nnblk</span><span class="p">()</span>
<a name="ln-4396"></a>
<a name="ln-4397"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;nnblk&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4398"></a>   <span class="c">!!call unit_check(&#39;nnblk&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4399"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;nnblk&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4400"></a><span class="k">end subroutine </span><span class="n">test_nnblk</span>
<a name="ln-4401"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4402"></a><span class="k">subroutine </span><span class="n">test_preparebox</span><span class="p">()</span>
<a name="ln-4403"></a>
<a name="ln-4404"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;preparebox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4405"></a>   <span class="c">!!call unit_check(&#39;preparebox&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4406"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;preparebox&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4407"></a><span class="k">end subroutine </span><span class="n">test_preparebox</span>
<a name="ln-4408"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4409"></a><span class="k">subroutine </span><span class="n">test_readfmt</span><span class="p">()</span>
<a name="ln-4410"></a>
<a name="ln-4411"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;readfmt&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4412"></a>   <span class="c">!!call unit_check(&#39;readfmt&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4413"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;readfmt&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4414"></a><span class="k">end subroutine </span><span class="n">test_readfmt</span>
<a name="ln-4415"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4416"></a><span class="k">subroutine </span><span class="n">test_replace_w</span><span class="p">()</span>
<a name="ln-4417"></a>
<a name="ln-4418"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;replace_w&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4419"></a>   <span class="c">!!call unit_check(&#39;replace_w&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4420"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;replace_w&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4421"></a><span class="k">end subroutine </span><span class="n">test_replace_w</span>
<a name="ln-4422"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4423"></a><span class="k">subroutine </span><span class="n">test_replace_zeronaninf</span><span class="p">()</span>
<a name="ln-4424"></a>
<a name="ln-4425"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;replace_zeronaninf&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4426"></a>   <span class="c">!!call unit_check(&#39;replace_zeronaninf&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4427"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;replace_zeronaninf&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4428"></a><span class="k">end subroutine </span><span class="n">test_replace_zeronaninf</span>
<a name="ln-4429"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4430"></a><span class="k">subroutine </span><span class="n">test_tostring_check_settings</span><span class="p">()</span>
<a name="ln-4431"></a>
<a name="ln-4432"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_check_settings&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4433"></a>   <span class="c">!!call unit_check(&#39;tostring_check_settings&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4434"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_check_settings&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4435"></a><span class="k">end subroutine </span><span class="n">test_tostring_check_settings</span>
<a name="ln-4436"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4437"></a><span class="k">subroutine </span><span class="n">test_tostring_get</span><span class="p">()</span>
<a name="ln-4438"></a>
<a name="ln-4439"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_get&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4440"></a>   <span class="c">!!call unit_check(&#39;tostring_get&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4441"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_get&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4442"></a><span class="k">end subroutine </span><span class="n">test_tostring_get</span>
<a name="ln-4443"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4444"></a><span class="k">subroutine </span><span class="n">test_tostring_get_complex</span><span class="p">()</span>
<a name="ln-4445"></a>
<a name="ln-4446"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;tostring_get_complex&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4447"></a>   <span class="c">!!call unit_check(&#39;tostring_get_complex&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4448"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;tostring_get_complex&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4449"></a><span class="k">end subroutine </span><span class="n">test_tostring_get_complex</span>
<a name="ln-4450"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4451"></a><span class="k">subroutine </span><span class="n">test_trim_real</span><span class="p">()</span>
<a name="ln-4452"></a>
<a name="ln-4453"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;trim_real&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4454"></a>   <span class="c">!!call unit_check(&#39;trim_real&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4455"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;trim_real&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4456"></a><span class="k">end subroutine </span><span class="n">test_trim_real</span>
<a name="ln-4457"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4458"></a><span class="k">subroutine </span><span class="n">test_trim_s_real</span><span class="p">()</span>
<a name="ln-4459"></a>
<a name="ln-4460"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;trim_s_real&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4461"></a>   <span class="c">!!call unit_check(&#39;trim_s_real&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4462"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;trim_s_real&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4463"></a><span class="k">end subroutine </span><span class="n">test_trim_s_real</span>
<a name="ln-4464"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4465"></a><span class="k">subroutine </span><span class="n">test_upper</span><span class="p">()</span>
<a name="ln-4466"></a>
<a name="ln-4467"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4468"></a>   <span class="c">!!call unit_check(&#39;upper&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4469"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4470"></a><span class="k">end subroutine </span><span class="n">test_upper</span>
<a name="ln-4471"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4472"></a><span class="k">subroutine </span><span class="n">test_putnl</span><span class="p">()</span>
<a name="ln-4473"></a>
<a name="ln-4474"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;putnl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4475"></a>   <span class="c">!!call unit_check(&#39;putnl&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4476"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;putnl&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4477"></a><span class="k">end subroutine </span><span class="n">test_putnl</span>
<a name="ln-4478"></a><span class="c">!TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span>
<a name="ln-4479"></a><span class="k">subroutine </span><span class="n">test_putstr</span><span class="p">()</span>
<a name="ln-4480"></a>
<a name="ln-4481"></a>   <span class="k">call </span><span class="n">unit_check_start</span><span class="p">(</span><span class="s1">&#39;putstr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4482"></a>   <span class="c">!!call unit_check(&#39;putstr&#39;, 0.eq.0, &#39;checking&#39;,100)</span>
<a name="ln-4483"></a>   <span class="k">call </span><span class="n">unit_check_done</span><span class="p">(</span><span class="s1">&#39;putstr&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-4484"></a><span class="k">end subroutine </span><span class="n">test_putstr</span>
<a name="ln-4485"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-4486"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()=</span>
<a name="ln-4487"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-4488"></a><span class="k">end subroutine </span><span class="n">test_suite_M_display</span>
<a name="ln-4489"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-4490"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()=</span>
<a name="ln-4491"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-4492"></a><span class="k">END MODULE </span><span class="n">M_display</span>
<a name="ln-4493"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-4494"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()=</span>
<a name="ln-4495"></a><span class="c">!===================================================================================================================================</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2021-10-02 11:12  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> M_display was developed by John S. Urban</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>